(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Ra="/terragem/assets/build_admin-BnmWnIY_.png",Oa=Object.freeze(Object.defineProperty({__proto__:null,default:Ra},Symbol.toStringTag,{value:"Module"})),ha="/terragem/assets/build_forge_oryon-BVY_ZtQO.png",Ca=Object.freeze(Object.defineProperty({__proto__:null,default:ha},Symbol.toStringTag,{value:"Module"})),Ya="/terragem/assets/build_forge_vulkan-DJCkuNJO.png",Ua=Object.freeze(Object.defineProperty({__proto__:null,default:Ya},Symbol.toStringTag,{value:"Module"})),Da="/terragem/assets/gem_carry-F1nfp5po.png",va=Object.freeze(Object.defineProperty({__proto__:null,default:Da},Symbol.toStringTag,{value:"Module"})),Pa="/terragem/assets/gem_carry_error-Ce_A6ijy.png",wa=Object.freeze(Object.defineProperty({__proto__:null,default:Pa},Symbol.toStringTag,{value:"Module"})),$a="/terragem/assets/gem_carry_mk1-7_aAwpl4.png",ka=Object.freeze(Object.defineProperty({__proto__:null,default:$a},Symbol.toStringTag,{value:"Module"})),Fa="/terragem/assets/gem_carry_mk1_error-BUeJVLmQ.png",Qa=Object.freeze(Object.defineProperty({__proto__:null,default:Fa},Symbol.toStringTag,{value:"Module"})),Ba="/terragem/assets/gem_floor-osGEz_Xz.png",qa=Object.freeze(Object.defineProperty({__proto__:null,default:Ba},Symbol.toStringTag,{value:"Module"})),ja="/terragem/assets/gem_floor_error-T9QrzMFJ.png",Va=Object.freeze(Object.defineProperty({__proto__:null,default:ja},Symbol.toStringTag,{value:"Module"})),Xa="/terragem/assets/gem_lift-BueQgplt.png",za=Object.freeze(Object.defineProperty({__proto__:null,default:Xa},Symbol.toStringTag,{value:"Module"})),Ha="/terragem/assets/gem_lift_error-CVK329iM.png",Wa=Object.freeze(Object.defineProperty({__proto__:null,default:Ha},Symbol.toStringTag,{value:"Module"})),Ka="/terragem/assets/gem_mine-yOTobddk.png",Ja=Object.freeze(Object.defineProperty({__proto__:null,default:Ka},Symbol.toStringTag,{value:"Module"})),Za="/terragem/assets/gem_mine_error-R_18F2pp.png",eo=Object.freeze(Object.defineProperty({__proto__:null,default:Za},Symbol.toStringTag,{value:"Module"})),to="/terragem/assets/gem_mine_mk1-DmyNFa90.png",no=Object.freeze(Object.defineProperty({__proto__:null,default:to},Symbol.toStringTag,{value:"Module"})),ao="/terragem/assets/gem_mine_mk1_error-DQzir5iO.png",oo=Object.freeze(Object.defineProperty({__proto__:null,default:ao},Symbol.toStringTag,{value:"Module"})),so="/terragem/assets/gem_shaft-C0DX-v3n.png",ro=Object.freeze(Object.defineProperty({__proto__:null,default:so},Symbol.toStringTag,{value:"Module"})),io="/terragem/assets/gem_shaft_error-DuJ9NOKQ.png",_o=Object.freeze(Object.defineProperty({__proto__:null,default:io},Symbol.toStringTag,{value:"Module"})),mo="/terragem/assets/gem_tunnel-BM7JDYKo.png",lo=Object.freeze(Object.defineProperty({__proto__:null,default:mo},Symbol.toStringTag,{value:"Module"})),co="/terragem/assets/gem_tunnel_error-Z5Nh8Cca.png",uo=Object.freeze(Object.defineProperty({__proto__:null,default:co},Symbol.toStringTag,{value:"Module"})),po="/terragem/assets/gem_tunnel_mk1-WLNM7Tyj.png",go=Object.freeze(Object.defineProperty({__proto__:null,default:po},Symbol.toStringTag,{value:"Module"})),yo="/terragem/assets/gem_tunnel_mk1_error-CnY5HzRV.png",Eo=Object.freeze(Object.defineProperty({__proto__:null,default:yo},Symbol.toStringTag,{value:"Module"})),fo="/terragem/assets/lab_forge_oryon-CFGRTvnT.png",Mo=Object.freeze(Object.defineProperty({__proto__:null,default:fo},Symbol.toStringTag,{value:"Module"})),Ao="/terragem/assets/lab_forge_oryon_speed-X-Pkf-Eg.png",To=Object.freeze(Object.defineProperty({__proto__:null,default:Ao},Symbol.toStringTag,{value:"Module"})),bo="/terragem/assets/lab_forge_vulkan-CnlMFtM1.png",So=Object.freeze(Object.defineProperty({__proto__:null,default:bo},Symbol.toStringTag,{value:"Module"})),Io="/terragem/assets/lab_forge_vulkan_speed-aJqp-Xkj.png",No=Object.freeze(Object.defineProperty({__proto__:null,default:Io},Symbol.toStringTag,{value:"Module"})),Go="/terragem/assets/lab_gem_carry-DNQrxtBh.png",Lo=Object.freeze(Object.defineProperty({__proto__:null,default:Go},Symbol.toStringTag,{value:"Module"})),xo="/terragem/assets/lab_gem_carry_item_amount-DJeL--2K.png",Ro=Object.freeze(Object.defineProperty({__proto__:null,default:xo},Symbol.toStringTag,{value:"Module"})),Oo="/terragem/assets/lab_gem_carry_item_capacity-CZxd5cYZ.png",ho=Object.freeze(Object.defineProperty({__proto__:null,default:Oo},Symbol.toStringTag,{value:"Module"})),Co="/terragem/assets/lab_gem_carry_item_speed-KSjqEsiC.png",Yo=Object.freeze(Object.defineProperty({__proto__:null,default:Co},Symbol.toStringTag,{value:"Module"})),Uo="/terragem/assets/lab_gem_count-BHFGgucG.png",Do=Object.freeze(Object.defineProperty({__proto__:null,default:Uo},Symbol.toStringTag,{value:"Module"})),vo="/terragem/assets/lab_gem_floor-Bd7sGV_u.png",Po=Object.freeze(Object.defineProperty({__proto__:null,default:vo},Symbol.toStringTag,{value:"Module"})),wo="/terragem/assets/lab_gem_lift-DWZuvDsy.png",$o=Object.freeze(Object.defineProperty({__proto__:null,default:wo},Symbol.toStringTag,{value:"Module"})),ko="/terragem/assets/lab_gem_lift_item_capacity-Bq5aohXt.png",Fo=Object.freeze(Object.defineProperty({__proto__:null,default:ko},Symbol.toStringTag,{value:"Module"})),Qo="/terragem/assets/lab_gem_max-DjLYWvc7.png",Bo=Object.freeze(Object.defineProperty({__proto__:null,default:Qo},Symbol.toStringTag,{value:"Module"})),qo="/terragem/assets/lab_gem_mine_dig_amount-DEPLC4qv.png",jo=Object.freeze(Object.defineProperty({__proto__:null,default:qo},Symbol.toStringTag,{value:"Module"})),Vo="/terragem/assets/lab_gem_mine_dig_speed-CZ_TdUIr.png",Xo=Object.freeze(Object.defineProperty({__proto__:null,default:Vo},Symbol.toStringTag,{value:"Module"})),zo="/terragem/assets/lab_gem_mine_dig_strength-StY-Usdp.png",Ho=Object.freeze(Object.defineProperty({__proto__:null,default:zo},Symbol.toStringTag,{value:"Module"})),Wo="/terragem/assets/lab_gem_mine_item_capacity-irwERTwB.png",Ko=Object.freeze(Object.defineProperty({__proto__:null,default:Wo},Symbol.toStringTag,{value:"Module"})),Jo="/terragem/assets/lab_gem_move_speed-CyGJqgWA.png",Zo=Object.freeze(Object.defineProperty({__proto__:null,default:Jo},Symbol.toStringTag,{value:"Module"})),es="/terragem/assets/lab_gem_shaft-C7h52MfS.png",ts=Object.freeze(Object.defineProperty({__proto__:null,default:es},Symbol.toStringTag,{value:"Module"})),ns="/terragem/assets/lab_gem_tunnel-Ur6T1Zvt.png",as=Object.freeze(Object.defineProperty({__proto__:null,default:ns},Symbol.toStringTag,{value:"Module"})),os="/terragem/assets/lab_mk1_carry-UzBIPQj6.png",ss=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"})),rs="/terragem/assets/lab_mk1_mine-BftYI4aA.png",is=Object.freeze(Object.defineProperty({__proto__:null,default:rs},Symbol.toStringTag,{value:"Module"})),_s="/terragem/assets/lab_mk1_tunnel-2590lOHD.png",ms=Object.freeze(Object.defineProperty({__proto__:null,default:_s},Symbol.toStringTag,{value:"Module"})),ls="/terragem/assets/lab_points-CzV-O5CW.png",cs=Object.freeze(Object.defineProperty({__proto__:null,default:ls},Symbol.toStringTag,{value:"Module"})),us="/terragem/assets/lab_run-DXjvR345.png",ps=Object.freeze(Object.defineProperty({__proto__:null,default:us},Symbol.toStringTag,{value:"Module"})),ds="/terragem/assets/map_map1-BHu4pest.png",gs=Object.freeze(Object.defineProperty({__proto__:null,default:ds},Symbol.toStringTag,{value:"Module"})),ys="/terragem/assets/mech_mk1_carry-CAtZ4tgK.png",Es=Object.freeze(Object.defineProperty({__proto__:null,default:ys},Symbol.toStringTag,{value:"Module"})),fs="/terragem/assets/mech_mk1_mine-C_MppVmu.png",Ms=Object.freeze(Object.defineProperty({__proto__:null,default:fs},Symbol.toStringTag,{value:"Module"})),As="/terragem/assets/mech_mk1_tunnel-Cy63csJw.png",Ts=Object.freeze(Object.defineProperty({__proto__:null,default:As},Symbol.toStringTag,{value:"Module"})),bs="/terragem/assets/menu_close-D3FMKtTY.png",Ss=Object.freeze(Object.defineProperty({__proto__:null,default:bs},Symbol.toStringTag,{value:"Module"})),Is="/terragem/assets/menu_destroy-D0Bkn3hP.png",Ns=Object.freeze(Object.defineProperty({__proto__:null,default:Is},Symbol.toStringTag,{value:"Module"})),Gs="/terragem/assets/menu_gems-Mx6Bym9D.png",Ls=Object.freeze(Object.defineProperty({__proto__:null,default:Gs},Symbol.toStringTag,{value:"Module"})),xs="/terragem/assets/menu_home-BonTF8GI.png",Rs=Object.freeze(Object.defineProperty({__proto__:null,default:xs},Symbol.toStringTag,{value:"Module"})),Os="/terragem/assets/menu_labs-B2R_k6NG.png",hs=Object.freeze(Object.defineProperty({__proto__:null,default:Os},Symbol.toStringTag,{value:"Module"})),Cs="/terragem/assets/menu_save-CQDFmJ45.png",Ys=Object.freeze(Object.defineProperty({__proto__:null,default:Cs},Symbol.toStringTag,{value:"Module"})),Us="/terragem/assets/menu_storage-C8d996wJ.png",Ds=Object.freeze(Object.defineProperty({__proto__:null,default:Us},Symbol.toStringTag,{value:"Module"})),vs="/terragem/assets/menu_workshop-C_5z8Aqw.png",Ps=Object.freeze(Object.defineProperty({__proto__:null,default:vs},Symbol.toStringTag,{value:"Module"})),ws="/terragem/assets/resource_cerulyn-m67ZlcVE.png",$s=Object.freeze(Object.defineProperty({__proto__:null,default:ws},Symbol.toStringTag,{value:"Module"})),ks="/terragem/assets/resource_claryn-C122i5SG.png",Fs=Object.freeze(Object.defineProperty({__proto__:null,default:ks},Symbol.toStringTag,{value:"Module"})),Qs="/terragem/assets/resource_damsyn-DD3_DOGa.png",Bs=Object.freeze(Object.defineProperty({__proto__:null,default:Qs},Symbol.toStringTag,{value:"Module"})),qs="/terragem/assets/resource_firmyn-B1KKTx1E.png",js=Object.freeze(Object.defineProperty({__proto__:null,default:qs},Symbol.toStringTag,{value:"Module"})),Vs="/terragem/assets/resource_forge_oryon-FTo-uxz1.png",Xs=Object.freeze(Object.defineProperty({__proto__:null,default:Vs},Symbol.toStringTag,{value:"Module"})),zs="/terragem/assets/resource_forge_vulkan-CzupOozM.png",Hs=Object.freeze(Object.defineProperty({__proto__:null,default:zs},Symbol.toStringTag,{value:"Module"})),Ws="/terragem/assets/resource_geolyn-tHmURsnc.png",Ks=Object.freeze(Object.defineProperty({__proto__:null,default:Ws},Symbol.toStringTag,{value:"Module"})),Js="/terragem/assets/resource_lumyn-bOXIe4M3.png",Zs=Object.freeze(Object.defineProperty({__proto__:null,default:Js},Symbol.toStringTag,{value:"Module"})),er="/terragem/assets/mech_mk1_carry-CAtZ4tgK.png",tr=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"})),nr="/terragem/assets/mech_mk1_mine-C_MppVmu.png",ar=Object.freeze(Object.defineProperty({__proto__:null,default:nr},Symbol.toStringTag,{value:"Module"})),or="/terragem/assets/mech_mk1_tunnel-Cy63csJw.png",sr=Object.freeze(Object.defineProperty({__proto__:null,default:or},Symbol.toStringTag,{value:"Module"})),rr="/terragem/assets/resource_stone-BeuOIW3d.png",ir=Object.freeze(Object.defineProperty({__proto__:null,default:rr},Symbol.toStringTag,{value:"Module"})),_r="/terragem/assets/resource_viridyn-sqEXtNRn.png",mr=Object.freeze(Object.defineProperty({__proto__:null,default:_r},Symbol.toStringTag,{value:"Module"})),lr="/terragem/assets/tile_cerulyn1-BAWNyObl.png",cr=Object.freeze(Object.defineProperty({__proto__:null,default:lr},Symbol.toStringTag,{value:"Module"})),ur="/terragem/assets/tile_cerulyn2-BKvvAZyR.png",pr=Object.freeze(Object.defineProperty({__proto__:null,default:ur},Symbol.toStringTag,{value:"Module"})),dr="/terragem/assets/tile_claryn2-Xx376ww_.png",gr=Object.freeze(Object.defineProperty({__proto__:null,default:dr},Symbol.toStringTag,{value:"Module"})),yr="/terragem/assets/tile_damsyn2-CnBeQ7id.png",Er=Object.freeze(Object.defineProperty({__proto__:null,default:yr},Symbol.toStringTag,{value:"Module"})),fr="/terragem/assets/tile_floor-Dm0yJHW_.png",Mr=Object.freeze(Object.defineProperty({__proto__:null,default:fr},Symbol.toStringTag,{value:"Module"})),Ar="/terragem/assets/tile_geolyn1-B4Mw2Ew0.png",Tr=Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"})),br="/terragem/assets/tile_geolyn2-CAxPCi-q.png",Sr=Object.freeze(Object.defineProperty({__proto__:null,default:br},Symbol.toStringTag,{value:"Module"})),Ir="/terragem/assets/tile_ground0_destroy-DMQb2T-k.png",Nr=Object.freeze(Object.defineProperty({__proto__:null,default:Ir},Symbol.toStringTag,{value:"Module"})),Gr="/terragem/assets/tile_ground1-DNGikeWH.png",Lr=Object.freeze(Object.defineProperty({__proto__:null,default:Gr},Symbol.toStringTag,{value:"Module"})),xr="/terragem/assets/tile_ground1_destroy-CPN322ep.png",Rr=Object.freeze(Object.defineProperty({__proto__:null,default:xr},Symbol.toStringTag,{value:"Module"})),Or="/terragem/assets/tile_ground2-ffB4YzeT.png",hr=Object.freeze(Object.defineProperty({__proto__:null,default:Or},Symbol.toStringTag,{value:"Module"})),Cr="/terragem/assets/tile_ground2_destroy-DI20OQoc.png",Yr=Object.freeze(Object.defineProperty({__proto__:null,default:Cr},Symbol.toStringTag,{value:"Module"})),Ur="/terragem/assets/tile_lock-xvm0yfW-.png",Dr=Object.freeze(Object.defineProperty({__proto__:null,default:Ur},Symbol.toStringTag,{value:"Module"})),vr="/terragem/assets/ui_admin_placeholder-C9DmPQNW.png",Pr=Object.freeze(Object.defineProperty({__proto__:null,default:vr},Symbol.toStringTag,{value:"Module"})),wr="/terragem/assets/ui_close-B1TuXVLn.png",$r=Object.freeze(Object.defineProperty({__proto__:null,default:wr},Symbol.toStringTag,{value:"Module"})),kr="/terragem/assets/ui_gem_placeholder-DvrEY3RI.png",Fr=Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"})),Qr="/terragem/assets/ui_gems_placeholder-WawWBddW.png",Br=Object.freeze(Object.defineProperty({__proto__:null,default:Qr},Symbol.toStringTag,{value:"Module"})),qr="/terragem/assets/ui_quests_placeholder-CGmDuFSC.png",jr=Object.freeze(Object.defineProperty({__proto__:null,default:qr},Symbol.toStringTag,{value:"Module"})),Vr="/terragem/assets/ui_scroll_bottom-DLdnqp2_.png",Xr=Object.freeze(Object.defineProperty({__proto__:null,default:Vr},Symbol.toStringTag,{value:"Module"})),zr="/terragem/assets/ui_scroll_left-CE6OhAs3.png",Hr=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"})),Wr="/terragem/assets/ui_scroll_right-BXZfb4Wl.png",Kr=Object.freeze(Object.defineProperty({__proto__:null,default:Wr},Symbol.toStringTag,{value:"Module"})),Jr="/terragem/assets/ui_scroll_top-BrnHPOid.png",Zr=Object.freeze(Object.defineProperty({__proto__:null,default:Jr},Symbol.toStringTag,{value:"Module"})),ei="/terragem/assets/bgm_game1-ylpRiDm3.mp3",ti=Object.freeze(Object.defineProperty({__proto__:null,default:ei},Symbol.toStringTag,{value:"Module"})),ni="/terragem/assets/bgm_game2-DJwsUdjO.mp3",ai=Object.freeze(Object.defineProperty({__proto__:null,default:ni},Symbol.toStringTag,{value:"Module"})),oi="/terragem/assets/bgm_game3-q9WETr7Q.mp3",si=Object.freeze(Object.defineProperty({__proto__:null,default:oi},Symbol.toStringTag,{value:"Module"})),ri="/terragem/assets/bgm_game4-epCXv-FH.mp3",ii=Object.freeze(Object.defineProperty({__proto__:null,default:ri},Symbol.toStringTag,{value:"Module"})),_i="/terragem/assets/bgm_game5-KpKkx2i3.mp3",mi=Object.freeze(Object.defineProperty({__proto__:null,default:_i},Symbol.toStringTag,{value:"Module"})),li="/terragem/assets/bgm_game6-D1pkgEUc.mp3",ci=Object.freeze(Object.defineProperty({__proto__:null,default:li},Symbol.toStringTag,{value:"Module"})),ui="/terragem/assets/bgm_game7-BwktSevm.mp3",pi=Object.freeze(Object.defineProperty({__proto__:null,default:ui},Symbol.toStringTag,{value:"Module"})),di="/terragem/assets/bgm_game8-CWrQBCK3.mp3",gi=Object.freeze(Object.defineProperty({__proto__:null,default:di},Symbol.toStringTag,{value:"Module"})),yi="/terragem/assets/bgm_game9-Y0v3vi9U.mp3",Ei=Object.freeze(Object.defineProperty({__proto__:null,default:yi},Symbol.toStringTag,{value:"Module"})),fi="/terragem/assets/bgm_menu1-D5Cqw0ay.mp3",Mi=Object.freeze(Object.defineProperty({__proto__:null,default:fi},Symbol.toStringTag,{value:"Module"})),Ai="/terragem/assets/main_action-BPrtFktz.mp3",Ti=Object.freeze(Object.defineProperty({__proto__:null,default:Ai},Symbol.toStringTag,{value:"Module"})),bi="/terragem/assets/main_confirm-she_2nsU.mp3",Si=Object.freeze(Object.defineProperty({__proto__:null,default:bi},Symbol.toStringTag,{value:"Module"})),Ii="/terragem/assets/main_error-CNlGL_Y3.mp3",Ni=Object.freeze(Object.defineProperty({__proto__:null,default:Ii},Symbol.toStringTag,{value:"Module"})),Gi="/terragem/assets/main_select-MQdCDlhu.mp3",Li=Object.freeze(Object.defineProperty({__proto__:null,default:Gi},Symbol.toStringTag,{value:"Module"})),xi="/terragem/assets/main_start-BirMcx32.mp3",Ri=Object.freeze(Object.defineProperty({__proto__:null,default:xi},Symbol.toStringTag,{value:"Module"})),Oi="/terragem/assets/main_stop-DfI-u1jJ.mp3",hi=Object.freeze(Object.defineProperty({__proto__:null,default:Oi},Symbol.toStringTag,{value:"Module"})),Ci="/terragem/assets/main_success-D-sc8066.mp3",Yi=Object.freeze(Object.defineProperty({__proto__:null,default:Ci},Symbol.toStringTag,{value:"Module"})),Ui="/terragem/assets/main_unlock-d0YoqSbh.mp3",Di=Object.freeze(Object.defineProperty({__proto__:null,default:Ui},Symbol.toStringTag,{value:"Module"})),vi="/terragem/assets/main_warning-CMiuSe75.mp3",Pi=Object.freeze(Object.defineProperty({__proto__:null,default:vi},Symbol.toStringTag,{value:"Module"})),He={adminId:null,requestId:null,tileMapId:null},ye=({key:e,value:t})=>He[e]=t,P=({key:e})=>(He[e]&&ji({entityId:He[e]}))??g({message:`No ${e} in store`,where:"getStore"}),tn=({key:e})=>He[e]=null,X={},Ct="Admin",Ln="Gem",Yt="TileMap",wi="Tile",Ue=({entityName:e})=>{const t=Vi({entityName:e});return nt({entityId:t})&&g({message:`Entity ${t} already exists`,where:Ue.name}),X[t]={},e===Ct?ye({key:"adminId",value:t}):e===Yt&&ye({key:"tileMapId",value:t}),t},$=({entityId:e,component:t})=>{const n=nt({entityId:e})??g({message:`Entity ${e} does not exist`,where:$.name});n[t._]=t},l=({entityId:e,componentId:t})=>(nt({entityId:e})??g({message:`Entity ${e} does not exist`,where:l.name}))[t]??g({message:`Component ${t} does not exist on entity ${e}`,where:l.name}),$i=({entityId:e})=>{delete X[e]},C=[];for(let e=0;e<256;++e)C.push((e+256).toString(16).slice(1));function ki(e,t=0){return(C[e[t+0]]+C[e[t+1]]+C[e[t+2]]+C[e[t+3]]+"-"+C[e[t+4]]+C[e[t+5]]+"-"+C[e[t+6]]+C[e[t+7]]+"-"+C[e[t+8]]+C[e[t+9]]+"-"+C[e[t+10]]+C[e[t+11]]+C[e[t+12]]+C[e[t+13]]+C[e[t+14]]+C[e[t+15]]).toLowerCase()}let pt;const Fi=new Uint8Array(16);function Qi(){if(!pt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");pt=crypto.getRandomValues.bind(crypto)}return pt(Fi)}const Bi=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),nn={randomUUID:Bi};function qi(e,t,n){var o;if(nn.randomUUID&&!e)return nn.randomUUID();e=e||{};const a=e.random??((o=e.rng)==null?void 0:o.call(e))??Qi();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,ki(a)}const nt=({entityId:e})=>X[e]?X[e]:null,ji=({entityId:e})=>X[e]?e:null,Vi=({entityName:e})=>`${e}-${qi().split("-")[0]}`,Qe=({entityId:e})=>e.split("-")[0],at=({entityId:e,componentId:t})=>!!(nt({entityId:e})??g({message:`Entity ${e} does not exist`,where:at.name}))[t],T=()=>{const e=P({key:"adminId"});return l({componentId:"Admin",entityId:e})},Xi=()=>{const e=P({key:"tileMapId"});return l({componentId:"TileMap",entityId:e})},xn=({gemId:e})=>e.includes(Ln),zi=document.getElementById("Game"),_=({absolute:e=!0,id:t,entityId:n,css:a,parent:o,sprite:s=!1,image:i,text:p,title:E})=>{const y=document.createElement("div"),N=(t||n)??g({message:"Element id must be provided",where:_.name});y.setAttribute("id",N);const h=Qe({entityId:N}).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return y.setAttribute("class",`${a||h||""}`.trim()),e?y.classList.add("abs"):y.classList.add("rel"),(o?c({elId:o}):zi).appendChild(y),p&&(y.innerText=p),i?y.style.backgroundImage=`url(${i})`:s&&Rn({elId:N}),E&&y.addEventListener("mouseover",()=>{y.title=E}),y},b=({click:e,...t})=>{const n=_({...t});return n.classList.add("btn"),n.addEventListener("click",e),n},Ut=({value:e,...t})=>{if(!t.id)throw g({message:"Element id must be provided",where:Ut.name});_({...t,id:`${t.id}-ProgressContainer`,text:void 0}).classList.add("progress-container"),_({css:"progress",id:`${t.id}-Progress`,parent:`${t.id}-ProgressContainer`}),t.text&&_({css:"progress-text",id:`${t.id}-ProgressText`,parent:`${t.id}-ProgressContainer`,text:t.text}),We({elId:t.id,value:e})},We=({elId:e,value:t,text:n})=>{const a=c({elId:`${e}-Progress`});if(a.style.width=`${t}%`,n){const o=c({elId:`${e}-ProgressText`});o.innerText=n}},W=({elId:e})=>{const t=c({elId:e});for(;t.firstChild;)t.removeChild(t.firstChild);t.remove()},Rn=({elId:e})=>{const t=l({componentId:"Sprite",entityId:e}),n=c({elId:e});n.style.width=`${t._width*x}px`,n.style.height=`${t._height*x}px`,n.style.backgroundImage=`url(${t._image})`};var D=(e=>(e.BUILD_FORGE_ORYON="FORGE_ORYON",e.BUILD_FORGE_VULKAN="FORGE_VULKAN",e.GEM_CARRY="GEM_CARRY",e.GEM_FLOOR="GEM_FLOOR",e.GEM_LIFT="GEM_LIFT",e.GEM_MINE="GEM_MINE",e.GEM_SHAFT="GEM_SHAFT",e.GEM_TUNNEL="GEM_TUNNEL",e.MK1_CARRY="MK1_CARRY",e.MK1_MINE="MK1_MINE",e.MK1_TUNNEL="MK1_TUNNEL",e.RES_CERULYN="CERULYN",e.RES_CLARYN="CLARYN",e.RES_DAMSYN="DAMSYN",e.RES_FIRMYN="FIRMYN",e.RES_GEOLYN="GEOLYN",e.RES_LUMYN="LUMYN",e.RES_STONE="STONE",e.RES_VIRIDYN="VIRIDYN",e))(D||{}),m=(e=>(e.CARRY="Carry",e.FLOOR="Floor",e.LIFT="Lift",e.MINE="Mine",e.SHAFT="Shaft",e.TUNNEL="Tunnel",e))(m||{});const Ee=new Map,ot=new Map([["bgm_game",{count:9,prefix:"bgm_game"}],["bgm_menu",{count:1,prefix:"bgm_menu"}]]),On=({audioName:e})=>Ye.getAudioUrl(e)??g({message:`Audio ${e} not found`,where:On.name}),an=({nb:e})=>Math.floor(Math.random()*e)+1,Hi=()=>{R({audioName:"bgm_game1"}),R({audioName:"bgm_game2"}),R({audioName:"bgm_game3"}),R({audioName:"bgm_game4"}),R({audioName:"bgm_game5"}),R({audioName:"bgm_game6"}),R({audioName:"bgm_game7"}),R({audioName:"bgm_game8"}),R({audioName:"bgm_game9"}),R({audioName:"bgm_menu1"}),R({audioName:"main_confirm"}),R({audioName:"main_error"}),R({audioName:"main_select"}),R({audioName:"main_success"}),R({audioName:"main_warning"}),R({audioName:"main_action"}),R({audioName:"main_start"}),R({audioName:"main_stop"}),R({audioName:"main_unlock"})},R=({audioName:e})=>{if(Ee.has(e))return;const t=new Audio(On({audioName:e}));t.addEventListener("ended",()=>Wi({audioName:e})),Ee.set(e,t)},Dt=({audioName:e,loop:t=!1,volume:n=1,list:a=!1})=>{const o=T();e=a?vt({audioCategory:e}):e;const s=Ee.get(e)??g({message:`Audio ${e} not found`,where:Dt.name});s.loop&&s.currentTime>0||(s.currentTime=0,s.loop=t&&!a,s.volume=n*o.settings._audioVolume,s.play())},hn=({audioName:e})=>{const t=ot.get(e);e=t?t.currentAudio??e:e,(Ee.get(e)??g({message:`Audio ${e} not found`,where:hn.name})).pause()},Cn=({audioName:e})=>{const t=ot.get(e);e=t?t.currentAudio??e:e;const n=Ee.get(e)??g({message:`Audio ${e} not found`,where:Cn.name});n.pause(),n.currentTime=0},Wi=({audioName:e})=>{for(const[t]of ot)if(e.startsWith(t)){const n=vt({audioCategory:t}),a=Ee.get(e);a&&Dt({audioName:n,volume:a.volume});break}},vt=({audioCategory:e})=>{const t=ot.get(e)??g({message:`Category ${e} not found`,where:vt.name});let n;if(t.currentAudio){const o=parseInt(t.currentAudio.slice(-1));do n=an({nb:t.count});while(n===o)}else n=an({nb:t.count});const a=`${t.prefix}${n}`;return t.currentAudio=a,a},Yn={gameLaunch:!1,gameLoad:!1,gamePause:!1,gamePlay:!1,requestGemCarryStart:!1,requestGemCarryTarget:!1,requestGemLift:!1,requestGemMove:!1,requestTile:!1},U=({key:e,value:t})=>Yn[e]=t,Y=({key:e})=>Yn[e],Pt=({entityId:e,targetX:t,targetY:n})=>{const a=l({componentId:"Position",entityId:e});if(a._x===t&&a._y===n)return Le.delete(e),!0;let o=Le.get(e);if(!o||o.targetX!==t||o.targetY!==n){const p=Ki({startX:a._x,startY:a._y,targetX:t,targetY:n});if(p.length===0)return g({message:`No valid path found for entity ${e} to (${t},${n})`,where:Pt.name}),!1;o={entityId:e,path:p.slice(1),targetX:t,targetY:n},Le.set(e,o)}const s=o.path[0];if(!s)return Le.delete(e),!1;const{tile:i}=S({x:s.x,y:s.y});return i._destroy?(a._x=s.x,a._y=s.y,o.path.shift(),r({entityId:e,target:"render",type:u.POSITION_UPDATE}),a._x===t&&a._y===n):(Le.delete(e),!1)},S=({x:e,y:t})=>{const n=Xi();for(const a of n.tiles){const o=l({componentId:"Position",entityId:a});if(o._x===e&&o._y===t)return{tile:l({componentId:"Tile",entityId:a}),tileId:a}}throw g({message:`Tile at position (${e},${t}) not found`,where:S.name})},wt=({gemId:e,x:t,y:n})=>{const a=T(),o=[];for(const s of a.gems){const i=l({componentId:"Position",entityId:s});e!==s&&i._x===t&&i._y===n&&o.push(s)}return o},Le=new Map,Ki=({startX:e,startY:t,targetX:n,targetY:a})=>{const o=[],s=new Set,i={f:0,g:0,h:on(e,t,n,a),parent:null,x:e,y:t};for(i.f=i.g+i.h,o.push(i);o.length>0;){const p=o.reduce((y,N)=>N.f<y.f?N:y,o[0]);if(o.splice(o.indexOf(p),1),s.add(`${p.x},${p.y}`),p.x===n&&p.y===a)return Zi(p);const E=Ji(p.x,p.y);for(const y of E){if(s.has(`${y.x},${y.y}`))continue;const N=p.g+1,h=o.find(v=>v.x===y.x&&v.y===y.y);if(h)N<h.g&&(h.g=N,h.f=h.g+h.h,h.parent=p);else{const v={f:0,g:N,h:on(y.x,y.y,n,a),parent:p,x:y.x,y:y.y};v.f=v.g+v.h,o.push(v)}}}return[]},Ji=(e,t)=>[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}].map(a=>({x:e+a.x,y:t+a.y})).filter(a=>{try{const{tile:o,tileId:s}=S({x:a.x,y:a.y});return s?o._destroy:!0}catch{return!1}}),on=(e,t,n,a)=>Math.abs(n-e)+Math.abs(a-t),Zi=e=>{const t=[];let n=e;for(;n!==null;)t.unshift({x:n.x,y:n.y}),n=n.parent;return t},A=({spriteName:e})=>Ye.getSpriteUrl(e)??g({message:`Sprite ${e} not found`,where:A.name}),w=({entityId:e,image:t})=>{const n=l({componentId:"Sprite",entityId:e}),a=A({spriteName:t});n._image!==a&&(n._image=a,r({entityId:e,target:"render",type:u.SPRITE_UPDATE}),xn({gemId:e})&&r({entityId:e,target:"render",type:u.GEM_UPDATE}))},e_=15,t_=3,sn=-1,n_=1,rn=-1,a_=0,_n=0,o_=1,s_=({tileMapId:e,saveTileMap:t})=>{if(e||(e=P({key:"tileMapId"})),t)for(const n of t.tiles){const a=l({componentId:"Tile",entityId:n}),o=l({componentId:"Sprite",entityId:n}),s=l({componentId:"Position",entityId:n});ft({density:a._density,destroy:a._destroy,dropAmount:a._dropAmount,drops:a.drops,sprite:o._image,tileId:n,x:s._x,y:s._y})}else r_({tileMapId:e})},r_=({tileMapId:e})=>{e||(e=P({key:"tileMapId"}));const t=l({componentId:"TileMap",entityId:e}),n=kt({tileMapName:t._name});let a=0;for(let o=0;o<n.width;o++){const s=ft({density:0,destroy:!0,dropAmount:0,drops:[],sprite:"tile_ground",x:o,y:a});t.tiles.push(s)}a++,n.layers.forEach((o,s)=>{const i=Array(o.height).fill(null).map(()=>Array(n.width).fill({resourceName:"",spawn:null}));o.resources&&o.resources.forEach(p=>{p.spawns.forEach(E=>{const y=E.startY;E.points.forEach(N=>{const h=Math.floor(Math.random()*(n_-sn+1))+sn,v=Math.floor(Math.random()*(a_-rn+1))+rn,ce=Math.floor(Math.random()*(o_-_n+1))+_n,mt=N.x+h,re=y+N.y+v,Ge=Math.max(1,N.width+ce);for(let lt=0;lt<Ge;lt++){const ct=mt+lt,ut=re;ct>=0&&ct<n.width&&ut>=0&&ut<o.height&&(i[ut][ct]={resourceName:p.name,spawn:E})}})})});for(let p=0;p<o.height;p++)for(let E=0;E<n.width;E++){const{resourceName:y,spawn:N}=i[p][E];let h,v,ce;if(y&&o.resources){const re=o.resources.find(Ge=>Ge.name===y);re&&N?(h=re.drops,v=re.name,ce=Math.floor(Math.random()*(N.dropAmount.max-N.dropAmount.min+1))+N.dropAmount.min):(h=o.ground.drops,v=o.ground.name,ce=Math.floor(Math.random()*(o.ground.dropAmount.max-o.ground.dropAmount.min+1))+o.ground.dropAmount.min)}else h=o.ground.drops,v=o.ground.name,ce=Math.floor(Math.random()*(o.ground.dropAmount.max-o.ground.dropAmount.min+1))+o.ground.dropAmount.min;const mt=ft({density:s+1,dropAmount:ce,drops:h.map(({rate:re,name:Ge})=>({_name:Ge,_rate:re})),sprite:v,x:E,y:p+a});t.tiles.push(mt)}a+=o.height});for(let o=0;o<e_;o++)for(let s=1;s<=t_;s++){const{tileId:i}=S({x:o,y:s});$t({tileId:i})}},Un=({selectedTileId:e})=>{Y({key:"requestTile"})||g({message:"No request for tile selection was made",where:Un.name});const t=l({componentId:"Position",entityId:e}),{tile:n,tileId:a}=S({x:t._x,y:t._y-1}),o=l({componentId:"Position",entityId:a});if(Y({key:"requestGemMove"})){const s=P({key:"requestId"});om({gemId:s,targetX:o._x,targetY:n._destroy?o._y:0}),r({target:"render",type:u.MODE_BASE}),r({entityId:s,target:"engine",type:d.GEM_MOVE_CONFIRM})}else if(Y({key:"requestGemCarryStart"})||Y({key:"requestGemCarryTarget"})){const s=P({key:"requestId"}),i=l({componentId:"Position",entityId:s});rm({gemId:s,x:o._x,y:i._y}),Y({key:"requestGemCarryTarget"})&&r({target:"render",type:u.MODE_BASE}),r({entityId:s,target:"engine",type:Y({key:"requestGemCarryStart"})?d.GEM_CARRY_CONFIRM_START:d.GEM_CARRY_CONFIRM_TARGET})}},Ke=({tileId:e,gemId:t})=>{const n=l({componentId:"Tile",entityId:e}),a=l({componentId:"Position",entityId:t}),o=G({gemId:t}),s=L({gemId:t});if(n._lock)return{stop:!0};if(n._destroy)return o===m.MINE&&Pt({entityId:t,targetX:a._x,targetY:a._y+1}),{destroy:!0,stop:!1};if(q(s)&&Te({gemId:t}))return w({entityId:t,image:H({error:!0,gemId:t})}),{stop:!1};if(f({gemId:t,gemType:o,stat:"_digStrength"})<n._density)return r({data:{alert:!0,text:`${s._name} is not strong enough to mine`,type:"warning"},target:"render",type:u.INFO}),{stop:!0};if(n._dropAmount<=0)return Dn({tileId:e}),{stop:!1};if(n._dropAmount--,o===m.MINE){const p=i_({tileId:e});if(p)return Me({amount:f({gemId:t,gemType:m.MINE,stat:"_digAmount"}),gemId:t,name:p}),w({entityId:t,image:H({gemId:t})}),{drop:p,stop:!1}}return{stop:!1}},i_=({tileId:e})=>{const t=l({componentId:"Tile",entityId:e}),n=t.drops.reduce((o,s)=>o+s._rate,0);let a=Math.random();if(a>n)return null;for(const o of t.drops){if(a<o._rate)return o._name;a-=o._rate}return null},__=({tileId:e})=>{const t=l({componentId:"Sprite",entityId:e});return t._image.includes("ground")||t._image.includes("floor")},m_=({tileId:e})=>l({componentId:"Tile",entityId:e})._lock,Dn=({tileId:e,value:t=!0})=>{const n=l({componentId:"Tile",entityId:e});n._destroy=t,t?(w({entityId:e,image:`tile_ground${n._density}_destroy`}),r({entityId:e,target:"render",type:u.TILE_DESTROY})):(w({entityId:e,image:"tile_floor"}),r({entityId:e,target:"render",type:u.TILE_CREATE}))},$t=({tileId:e,value:t=!0})=>{const n=l({componentId:"Tile",entityId:e});n._lock=t,w(t?{entityId:e,image:"tile_lock"}:{entityId:e,image:`tile_ground${n._density}`})},vn="map1",Pn=50,wn=64,$n=[{height:20,ground:{name:"tile_ground",dropAmount:{min:15,max:30},drops:[{name:"STONE",rate:.8},{name:"GEOLYN",rate:.1},{name:"CERULYN",rate:.1}]},resources:[{name:"tile_geolyn",drops:[{name:"GEOLYN",rate:.8},{name:"STONE",rate:.2}],spawns:[{startY:2,points:[{x:20,y:0,width:2},{x:20,y:1,width:2},{x:50,y:0,width:2},{x:50,y:1,width:2}],dropAmount:{min:75,max:100}},{startY:6,points:[{x:30,y:0,width:3},{x:30,y:1,width:3},{x:30,y:2,width:3}],dropAmount:{min:100,max:200}},{startY:8,points:[{x:2,y:0,width:3},{x:2,y:1,width:3},{x:2,y:2,width:3}],dropAmount:{min:100,max:200}},{startY:14,points:[{x:38,y:0,width:4},{x:38,y:1,width:4},{x:38,y:2,width:4},{x:38,y:3,width:4},{x:50,y:0,width:4},{x:50,y:1,width:4},{x:50,y:2,width:4},{x:50,y:3,width:4}],dropAmount:{min:7e4,max:12e4}}]},{name:"tile_cerulyn",drops:[{name:"CERULYN",rate:.8},{name:"STONE",rate:.2}],spawns:[{startY:2,points:[{x:24,y:0,width:2},{x:24,y:1,width:2},{x:47,y:0,width:2},{x:47,y:1,width:2}],dropAmount:{min:75,max:100}},{startY:6,points:[{x:55,y:0,width:3},{x:55,y:1,width:3},{x:55,y:2,width:3}],dropAmount:{min:100,max:200}},{startY:8,points:[{x:12,y:0,width:3},{x:12,y:1,width:3},{x:12,y:2,width:3}],dropAmount:{min:100,max:200}},{startY:14,points:[{x:15,y:0,width:4},{x:15,y:1,width:4},{x:15,y:2,width:4},{x:15,y:3,width:4},{x:35,y:0,width:4},{x:35,y:1,width:4},{x:35,y:2,width:4},{x:35,y:3,width:4}],dropAmount:{min:7e4,max:12e4}}]}]},{height:30,ground:{name:"tile_ground",dropAmount:{min:25,max:50},drops:[{name:"STONE",rate:.8},{name:"DAMSYN",rate:.1},{name:"CLARYN",rate:.1}]},resources:[{name:"tile_damsyn",drops:[{name:"DAMSYN",rate:.8},{name:"STONE",rate:.2}],spawns:[{startY:2,points:[{x:2,y:0,width:2},{x:2,y:1,width:2},{x:15,y:0,width:2},{x:15,y:1,width:2},{x:30,y:0,width:2},{x:30,y:1,width:2},{x:45,y:0,width:2},{x:45,y:1,width:2},{x:60,y:0,width:2},{x:60,y:1,width:2}],dropAmount:{min:250,max:500}},{startY:8,points:[{x:20,y:0,width:3},{x:20,y:1,width:3},{x:20,y:2,width:3},{x:50,y:0,width:3},{x:50,y:1,width:3},{x:50,y:2,width:3}],dropAmount:{min:5e3,max:1e4}},{startY:16,points:[{x:8,y:0,width:4},{x:8,y:1,width:4},{x:8,y:2,width:4},{x:8,y:3,width:4},{x:32,y:0,width:4},{x:32,y:1,width:4},{x:32,y:2,width:4},{x:32,y:3,width:4}],dropAmount:{min:1e4,max:15e3}},{startY:24,points:[{x:15,y:0,width:5},{x:15,y:1,width:6},{x:15,y:2,width:7}],dropAmount:{min:5e4,max:1e5}}]},{name:"tile_claryn",drops:[{name:"CLARYN",rate:.8},{name:"STONE",rate:.2}],spawns:[{startY:2,points:[{x:20,y:0,width:2},{x:20,y:1,width:2},{x:50,y:0,width:2},{x:50,y:1,width:2}],dropAmount:{min:250,max:500}},{startY:8,points:[{x:16,y:0,width:3},{x:16,y:1,width:3},{x:16,y:2,width:3},{x:24,y:0,width:3},{x:24,y:1,width:3},{x:24,y:2,width:3}],dropAmount:{min:5e3,max:1e4}},{startY:16,points:[{x:28,y:0,width:4},{x:28,y:1,width:4},{x:28,y:2,width:4},{x:28,y:3,width:4},{x:52,y:0,width:4},{x:52,y:1,width:4},{x:52,y:2,width:4},{x:52,y:3,width:4}],dropAmount:{min:1e4,max:15e3}},{startY:24,points:[{x:45,y:0,width:5},{x:45,y:1,width:6},{x:45,y:2,width:7}],dropAmount:{min:5e4,max:1e5}}]},{name:"tile_geolyn",drops:[{name:"GEOLYN",rate:.8},{name:"STONE",rate:.2}],spawns:[{startY:4,points:[{x:55,y:0,width:2},{x:55,y:1,width:2}],dropAmount:{min:500,max:1e3}},{startY:10,points:[{x:40,y:0,width:2},{x:40,y:1,width:2}],dropAmount:{min:1e3,max:2500}},{startY:18,points:[{x:50,y:0,width:2},{x:50,y:1,width:2}],dropAmount:{min:5e3,max:1e4}},{startY:26,points:[{x:8,y:0,width:2},{x:8,y:1,width:2},{x:35,y:0,width:2},{x:35,y:1,width:2}],dropAmount:{min:1e4,max:15e3}}]},{name:"tile_cerulyn",drops:[{name:"CERULYN",rate:.8},{name:"STONE",rate:.2}],spawns:[{startY:4,points:[{x:10,y:0,width:2},{x:10,y:1,width:2}],dropAmount:{min:500,max:1e3}},{startY:10,points:[{x:45,y:0,width:2},{x:45,y:1,width:2}],dropAmount:{min:1e3,max:2500}},{startY:18,points:[{x:25,y:0,width:2},{x:25,y:1,width:2}],dropAmount:{min:5e3,max:1e4}},{startY:26,points:[{x:5,y:0,width:2},{x:5,y:1,width:2},{x:60,y:0,width:2},{x:60,y:1,width:2}],dropAmount:{min:1e4,max:15e3}}]}]}],l_={name:vn,height:Pn,width:wn,layers:$n},c_=Object.freeze(Object.defineProperty({__proto__:null,default:l_,height:Pn,layers:$n,name:vn,width:wn},Symbol.toStringTag,{value:"Module"})),u_=Object.assign({"/src/assets/data/maps/map1.json":c_}),kt=({tileMapName:e})=>{const t=`/src/assets/data/maps/${e}.json`;return u_[t].default??g({message:`TileMapData for ${e} not found`,where:kt.name})},p_=.1,d_=.1,g_=3,y_=10,E_=2,f_=1,M_=4,A_=3,T_=.2,b_=1,S_=3,I_=100,N_=.1,G_=4,L_=5,x_=3,R_=10,O_=.5,h_=1,C_=1,Y_=3,U_=1,D_=1,v_=4,P_=3,w_=1,$_=1,k_=3,F_=0,Q_=({adminId:e})=>{e||(e=P({key:"adminId"}));const t={_:"Admin",builds:{forges:{oryon:0,vulkan:0}},crafts:["GEM_MINE"],gems:[],items:[{_amount:50,_name:D.RES_STONE},{_amount:25,_name:D.RES_GEOLYN},{_amount:25,_name:D.RES_CERULYN},{_amount:1,_name:D.RES_LUMYN}],labs:[],mechs:[],quests:[],requests:[],settings:{_audioActive:!0,_audioVolume:.5},stats:{_forgeOryonSpeed:d_,_forgeVulkanSpeed:p_,_gemCarryItemAmount:f_,_gemCarryItemCapacity:y_,_gemCarryItemRange:M_,_gemCarryItemSpeed:E_,_gemCarryMoveSpeed:g_,_gemFloorDigSpeed:T_,_gemFloorDigStrength:b_,_gemFloorMoveSpeed:A_,_gemLiftItemCapacity:I_,_gemLiftItemRange:G_,_gemLiftItemSpeed:N_,_gemLiftMoveSpeed:S_,_gemMax:L_,_gemMineDigAmount:C_,_gemMineDigSpeed:O_,_gemMineDigStrength:h_,_gemMineItemCapacity:R_,_gemMineMoveSpeed:x_,_gemShaftDigRange:v_,_gemShaftDigSpeed:U_,_gemShaftDigStrength:D_,_gemShaftMoveSpeed:Y_,_gemTunnelDigRange:k_,_gemTunnelDigSpeed:w_,_gemTunnelDigStrength:$_,_gemTunnelMoveSpeed:P_,_labPoints:F_}};return $({component:t,entityId:e}),l({componentId:"Admin",entityId:e})},B_=({tileMapId:e,tileMapName:t,saveTileMap:n})=>{if(e||(e=P({key:"tileMapId"})),n)return $({component:n,entityId:e}),l({componentId:"TileMap",entityId:e});const a=kt({tileMapName:t}),o={_:"TileMap",_height:a.height,_name:a.name,_width:a.width,tiles:[]};return $({component:o,entityId:e}),l({componentId:"TileMap",entityId:e})},q_=({tileId:e,density:t,drops:n,dropAmount:a,destroy:o=!1})=>($({component:{_:"Tile",_density:t,_destroy:o,_dropAmount:a,_lock:!1,carry:[],drops:n},entityId:e}),l({componentId:"Tile",entityId:e})),kn=({entityId:e,x:t,y:n})=>($({component:{_:"Position",_x:t,_y:n},entityId:e}),l({componentId:"Position",entityId:e})),Ft=({entityId:e,height:t=1,width:n=1,image:a})=>($({component:{_:"Sprite",_height:t,_image:a,_width:n},entityId:e}),l({componentId:"Sprite",entityId:e})),j_=({gemId:e})=>{const t={_:"Mine",_digAmount:0,_digSpeed:0,_digStrength:0,_itemCapacity:0,_moveSpeed:0,_name:`Mine-${se({gemType:m.MINE})}`,_xp:0,_xpLvl:1,_xpToNext:100,items:[]};return $({component:t,entityId:e}),l({componentId:"Mine",entityId:e})},V_=({gemId:e})=>{const t={_:"Carry",_itemAmount:0,_itemCapacity:0,_itemRange:0,_itemSpeed:0,_moveSpeed:0,_name:`Carry-${se({gemType:m.CARRY})}`,_xp:0,_xpLvl:1,_xpToNext:100,items:[]};return $({component:t,entityId:e}),l({componentId:"Carry",entityId:e})},X_=({gemId:e})=>{const t={_:"Lift",_itemCapacity:0,_itemRange:0,_itemSpeed:0,_moveSpeed:0,_name:`Lift-${se({gemType:m.LIFT})}`,_xp:0,_xpLvl:1,_xpToNext:100,items:[]};return $({component:t,entityId:e}),l({componentId:"Lift",entityId:e})},z_=({gemId:e})=>{const t={_:"Tunnel",_digRange:0,_digSpeed:0,_digStrength:0,_moveSpeed:0,_name:`Tunnel-${se({gemType:m.TUNNEL})}`,_xp:0,_xpLvl:1,_xpToNext:100};return $({component:t,entityId:e}),l({componentId:"Tunnel",entityId:e})},H_=({gemId:e})=>{const t={_:"Floor",_digSpeed:0,_digStrength:0,_moveSpeed:0,_name:`Floor-${se({gemType:m.FLOOR})}`,_xp:0,_xpLvl:1,_xpToNext:100};return $({component:t,entityId:e}),l({componentId:"Floor",entityId:e})},W_=({gemId:e})=>{const t={_:"Shaft",_digRange:0,_digSpeed:0,_digStrength:0,_moveSpeed:0,_name:`Shaft-${se({gemType:m.SHAFT})}`,_xp:0,_xpLvl:1,_xpToNext:100};return $({component:t,entityId:e}),l({componentId:"Shaft",entityId:e})},K_=({entityId:e,action:t})=>($({component:{_:"State",_action:t,_request:!1,_store:!0},entityId:e}),l({componentId:"State",entityId:e})),J_={[m.CARRY]:V_,[m.FLOOR]:H_,[m.LIFT]:X_,[m.MINE]:j_,[m.SHAFT]:W_,[m.TUNNEL]:z_},Qt=({adminId:e})=>{e?ye({key:"adminId",value:e}):(e=Ue({entityName:Ct}),Q_({adminId:e}),r({entityId:e,target:"render",type:u.ADMIN_CREATE}))},Fn=({tileMapId:e,tileMapName:t,saveTileMap:n})=>{if(e)ye({key:"tileMapId",value:e});else{e=Ue({entityName:Yt});const a=B_({saveTileMap:n,tileMapId:e,tileMapName:t});Ft({entityId:e,height:a._height,image:A({spriteName:`map_${a._name}`}),width:a._width})}r({entityId:e,target:"render",type:u.TILEMAP_CREATE}),s_({saveTileMap:n,tileMapId:e})},ft=({tileId:e,density:t,drops:n,dropAmount:a,destroy:o=!1,sprite:s,x:i,y:p})=>(e||(e=Ue({entityName:wi}),q_({density:t,destroy:o,dropAmount:a,drops:n,tileId:e}),kn({entityId:e,x:i,y:p}),Ft({entityId:e,image:A({spriteName:o?`${s}${t}_destroy`:`${s}${t}`})})),r({entityId:e,target:"render",type:u.TILE_CREATE}),p<=0?r({entityId:e,target:"render",type:u.TILE_GROUND}):o&&r({entityId:e,target:"render",type:u.TILE_DESTROY}),e),Je=({gemId:e,type:t,deploy:n=!1,x:a=0,y:o=0})=>{if(e){const s=l({componentId:"State",entityId:e});r({entityId:e,target:"render",type:u.GEM_CREATE}),r({entityId:e,target:"all",type:s._store?M.GEM_STORE:M.GEM_STORE_DEPLOY}),!s._store&&s._action==="work"&&r({entityId:e,target:"render",type:u.GEM_WORK})}else{const s=T();e=Ue({entityName:Ln}),kn({entityId:e,x:a,y:o}),K_({action:"idle",entityId:e}),J_[t]({gemId:e}),Ft({entityId:e,image:A({spriteName:`gem_${t.toLowerCase()}`})}),s.gems.push(e),r({data:{amount:1},target:"engine",type:d.QUEST_GEMS}),n&&(r({entityId:e,target:"render",type:u.GEM_CREATE}),r({entityId:e,target:"all",type:M.GEM_STORE_DEPLOY}))}},Qn=({buildName:e})=>{Bn({buildName:e})||g({message:`${e} is not a build`,where:Qn.name});const t=T();e===D.BUILD_FORGE_VULKAN?t.builds.forges.vulkan++:e===D.BUILD_FORGE_ORYON&&t.builds.forges.oryon++,r({data:e,target:"render",type:u.BUILD_CREATE})},Mt=({buildName:e})=>{Bn({buildName:e})||g({message:`${e} is not a build`,where:Mt.name});const t=T(),n=Se({buildName:e});if(n.type==="forge"){const a=e===D.BUILD_FORGE_VULKAN?t.builds.forges.vulkan:t.builds.forges.oryon;for(let o=0;o<a;o++){for(const s of n.forge.inputs)if(!qn({amount:s.amount,name:s.name}))return;for(const s of n.forge.outputs)fe({amount:s.amount,name:s.name}),r({data:{amount:s.amount,name:s.name},target:"engine",type:d.QUEST_FORGE})}}r({target:"render",type:u.ADMIN_UPDATE_STORAGE})},Bn=({buildName:e})=>e.includes("FORGE"),mn=({buildName:e})=>T().crafts.includes(e),Z_=[{"@":"ADMIN"},{type:"admin",name:"ADMIN",width:4,height:2,x:1},{"@":"FORGE"},{type:"forge",name:"FORGE_VULKAN",width:1,height:1,x:5,forge:{inputs:[{name:"GEOLYN",amount:5},{name:"DAMSYN",amount:5}],outputs:[{name:"VIRIDYN",amount:1}]}},{type:"forge",name:"FORGE_ORYON",width:1,height:1,x:6,forge:{inputs:[{name:"CERULYN",amount:5},{name:"CLARYN",amount:5}],outputs:[{name:"FIRMYN",amount:1}]}}],Se=({buildName:e})=>Z_.filter(a=>!a["@"]).find(a=>a.name===e)??g({message:`BuildData for ${e} not found`,where:Se.name}),fe=({name:e,amount:t})=>{const n=T(),a=n.items.find(o=>o._name===e);a?a._amount+=t:n.items.push({_amount:t,_name:e}),jn({itemName:e})&&n.mechs.push(e),r({data:{amount:t,name:e},target:"render",type:u.ADMIN_TOAST})},qn=({name:e,amount:t})=>{const a=T().items.find(o=>o._name===e);return a?a._amount<t?!1:(a._amount-=t,!0):!1},em=({itemName:e})=>{const t=T();if(t.crafts.includes(e)){if(Ae({itemName:e})&&t.gems.length>=t.stats._gemMax)return r({data:{alert:!0,text:"Already have the current maximum number of gems",type:"warning"},target:"render",type:u.INFO}),!1;const n=De({itemName:e}),a=[];for(const o of n.components){const s=t.items.find(i=>i._name===o.name);if(s){if(s._amount<o.amount)return r({data:{alert:!0,text:`Insufficient items to craft ${e}`,type:"warning"},target:"render",type:u.INFO}),!1;a.push({amount:o.amount,name:s._name})}else return r({data:{alert:!0,text:`Insufficient items to craft ${e}`,type:"warning"},target:"render",type:u.INFO}),!1}if(a.length){for(const o of a)if(!qn({amount:o.amount,name:o.name}))return r({data:{alert:!0,text:`Insufficient items to craft ${e}`,type:"warning"},target:"render",type:u.INFO}),!1}return Ae({itemName:e})?Je({type:st({itemName:e})}):tm({itemName:e})?(Qn({buildName:e}),fe({amount:1,name:n.name})):fe({amount:1,name:n.name}),r({data:{text:`Crafted 1 ${e} !`,type:"success"},target:"render",type:u.INFO}),!0}else return r({data:{alert:!0,text:`Insufficient items to craft ${e}`,type:"warning"},target:"render",type:u.INFO}),!1},Me=({gemId:e,name:t,amount:n})=>{const a=L({gemId:e});if(!q(a))throw g({message:`${e} cannot use items`,where:Me.name});if(Te({gemId:e}))throw g({message:`${e} is at capacity`,where:Me.name});const o=a.items.find(s=>s._name===t);o?o._amount+=n:a.items.push({_amount:n,_name:t}),r({entityId:e,target:"render",type:u.GEM_UPDATE})},At=({gemId:e,amount:t})=>{const n=L({gemId:e});if(!q(n))throw g({message:`${e} cannot use items`,where:Me.name});if(!n.items.length)return;const a=n.items.shift();if(!a)return;const o={amount:0,name:a._name};return t>a._amount?o.amount=a._amount:t===a._amount?o.amount=t:t<a._amount&&(n.items.push({_amount:a._amount-t,_name:a._name}),o.amount=t),r({entityId:e,target:"render",type:u.GEM_UPDATE}),o},Ae=({itemName:e})=>e.includes("GEM"),tm=({itemName:e})=>e.includes("FORGE"),jn=({itemName:e})=>e.includes("MK"),st=({itemName:e})=>{Ae({itemName:e})||g({message:`${e} is not a gem`,where:st.name});const t=e.split("_")[1];return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},Vn=({itemName:e})=>{const n=T().items.find(a=>a._name===e);return n==null?void 0:n._amount},nm=[{"@":"GEMS"},{name:"GEM_MINE",image:"gem_mine",text:"Mine tiles below them vertically. Harvest resources from the planet. Keep resources in their inventory. Stop mining when inventory is full.",components:[{name:"GEOLYN",amount:10},{name:"STONE",amount:5},{name:"LUMYN",amount:1}]},{name:"GEM_CARRY",image:"gem_carry",text:"Carry resources strictly horizontally from a start to a target tile. Start and target tiles are set in that order and always at the same height as the CARRY. Can pick items from other gems inventories except other CARRY when on their start tile. Can pick items from gems below them within their Item Range. Can drop items into the base storage when and on their target tile if it is close to the base on the surface.",components:[{name:"CERULYN",amount:10},{name:"STONE",amount:5},{name:"LUMYN",amount:1}]},{name:"GEM_TUNNEL",image:"gem_tunnel",text:"Mine tiles horizontally to their sides to create tunnels within its Tunnel Range. Do not have an inventory. Do not harvest resources. Stop when Tunnel Range is reached.",components:[{name:"GEOLYN",amount:300},{name:"STONE",amount:300},{name:"LUMYN",amount:2}]},{name:"GEM_LIFT",image:"gem_lift",text:"Create a vertical lift. Lock the tile below it. Set a target above themself within their Item Range or when reaching a ceiling or the surface. CARRY can drop items into the lift at its base and can pick items from the lift at its top target.",components:[{name:"CERULYN",amount:250},{name:"STONE",amount:250},{name:"LUMYN",amount:2}]},{name:"GEM_FLOOR",image:"gem_floor",text:"Fill up tiles below them with floor. Continue vertically until they reach a ceiling or the surface.",components:[{name:"STONE",amount:500},{name:"LUMYN",amount:2}]},{name:"GEM_SHAFT",image:"gem_shaft",text:"Mine tiles above it vertically within their Shaft Range. Do not have an inventory. Do not harvest resources. Stop when Shaft Range is reached.",components:[{name:"GEOLYN",amount:300},{name:"CERULYN",amount:300},{name:"STONE",amount:300},{name:"LUMYN",amount:2}]},{"@":"MECHS"},{name:"MK1_MINE",image:"mech_mk1_mine",text:"Equip to a MINE to improve its stats. Can be unequipped.",components:[{name:"GEOLYN",amount:500},{name:"CERULYN",amount:500},{name:"STONE",amount:100}]},{name:"MK1_TUNNEL",image:"mech_mk1_tunnel",text:"Equip to a TUNNEL to improve its stats. Can be unequipped.",components:[{name:"VIRIDYN",amount:100},{name:"STONE",amount:100}]},{name:"MK1_CARRY",image:"mech_mk1_carry",text:"Equip to a CARRY to improve its stats. Can be unequipped.",components:[{name:"FIRMYN",amount:25},{name:"STONE",amount:100}]},{"@":"BUILDS"},{name:"FORGE_VULKAN",image:"build_forge_vulkan",text:"Build to forge hard ressources. Deploy themself on the surface close to the base. Merge resources into others on a cycle based on VULKAN SPEED stat. Multiples stack on top of each other.",components:[{name:"DAMSYN",amount:50},{name:"STONE",amount:500}]},{name:"FORGE_ORYON",image:"build_forge_oryon",text:"Build to forge soft ressources. Deploy themself on the surface close to the base. Merge resources into others on a cycle based on ORYON SPEED stat. Multiples stack on top of each other.",components:[{name:"CLARYN",amount:50},{name:"STONE",amount:500}]}],am=[{"@":"MINE"},{name:"MK1_MINE",stats:{digSpeed:.5,digStrength:1,itemCapacity:20}},{"@":"CARRY"},{name:"MK1_CARRY",stats:{itemSpeed:1,itemCapacity:30,itemAmount:1,itemRange:2}},{"@":"TUNNEL"},{name:"MK1_TUNNEL",stats:{digSpeed:3,digStrength:1,digRange:3}}],De=({itemName:e})=>nm.filter(a=>!a["@"]).find(a=>a.name===e)??g({message:`CraftData for ${e} not found`,where:De.name}),Xn=({mechName:e})=>am.filter(a=>!a["@"]).find(a=>a.name===e)??g({message:`MechData for ${e} not found`,where:Xn.name}),om=({gemId:e,targetX:t,targetY:n})=>{const a=L({gemId:e});a._moveX=t,a._moveY=n,Q({gemId:e,request:!0}),k({action:"move",gemId:e})},zn=({gemId:e})=>{const t=L({gemId:e});t._moveX=void 0,t._moveY=void 0,Q({gemId:e,request:!1}),k({action:"idle",gemId:e}),r({entityId:e,target:"render",type:u.GEM_STOP})},Hn=({gemId:e})=>{const t=L({gemId:e});if(t._moveX===void 0||t._moveY===void 0)throw g({message:`${e} has invalid move target`,where:Hn.name});Pt({entityId:e,targetX:t._moveX,targetY:t._moveY})&&(r({data:{text:`${t._name} is at destination`,type:"confirm"},entityId:e,target:"render",type:u.INFO}),zn({gemId:e}))},sm=({gemId:e})=>{const t=T(),n=G({gemId:e}),a=L({gemId:e});if(a._mech){t.mechs.push(a._mech.slice()),a._mech=void 0,w({entityId:e,image:H({gemId:e})});return}const o=t.mechs.find(s=>s.includes(n.toUpperCase()));o?(a._mech=o,t.mechs.splice(t.mechs.indexOf(o),1),w({entityId:e,image:H({gemId:e})}),r({data:{text:`Equipped ${a._name} with ${a._mech}`,type:"confirm"},entityId:e,target:"render",type:u.INFO})):r({data:{alert:!0,text:`No mech found for ${a._name}`,type:"warning"},entityId:e,target:"render",type:u.INFO})},rm=({gemId:e,x:t,y:n})=>{const a=l({componentId:"Carry",entityId:e});if(Y({key:"requestGemCarryStart"})){a._moveTo="start",a._moveStartX=t,a._moveStartY=n;const{tile:o}=S({x:t,y:n});o.carry.push(e),r({data:{text:`${a._name} carry start set`,type:"confirm"},entityId:e,target:"render",type:u.INFO})}else if(Y({key:"requestGemCarryTarget"})){a._moveTargetX=t,a._moveTargetY=n;const{tile:o}=S({x:t,y:n});o.carry.push(e),Q({gemId:e,request:!0}),k({action:"work",gemId:e}),r({data:{text:`${a._name} carry target set`,type:"confirm"},entityId:e,target:"render",type:u.INFO})}},Be=({gemId:e})=>{const t=l({componentId:"Carry",entityId:e});if(t._moveStartX&&t._moveStartY){const{tile:n}=S({x:t._moveStartX,y:t._moveStartY});n.carry.splice(n.carry.indexOf(e),1)}if(t._moveTargetX&&t._moveTargetY){const{tile:n}=S({x:t._moveTargetX,y:t._moveTargetY});n.carry.splice(n.carry.indexOf(e),1)}t._moveTo=void 0,t._moveStartX=void 0,t._moveStartY=void 0,t._moveTargetX=void 0,t._moveTargetY=void 0,Q({gemId:e,request:!1}),k({action:"idle",gemId:e}),r({entityId:e,target:"render",type:u.GEM_STOP})},im=({gemId:e})=>{const t=l({componentId:"Carry",entityId:e});if(oe({at:"start",gemId:e})){if(!Te({gemId:e})&&Tt({gemId:e}))return}else if(oe({at:"target",gemId:e})&&Wn({gemId:e})){lm({gemId:e});return}bt({gemId:e})&&(t._moveTo=t._moveTo==="start"?"target":"start")},Tt=({gemId:e})=>{if(!oe({at:"start",gemId:e}))throw g({message:`${e} is not at start`,where:Tt.name});if(Te({gemId:e}))throw g({message:`${e} is at capacity`,where:Tt.name});const t=_m({gemId:e});if(t.length)for(const n of t){const a=At({amount:f({gemId:e,gemType:m.CARRY,stat:"_itemAmount"}),gemId:n});if(a)return Me({amount:a.amount,gemId:e,name:a.name}),w({entityId:e,image:H({gemId:e})}),!0}else return w({entityId:e,image:H({error:!0,gemId:e})}),!1;return!1},_m=({gemId:e})=>{const t=l({componentId:"Position",entityId:e}),n=f({gemId:e,gemType:m.CARRY,stat:"_itemRange"}),a=[];for(let o=t._y;o<t._y+n;o++){const s=wt({gemId:e,x:t._x,y:o});for(const i of s){if(G({gemId:i})===m.CARRY)continue;const E=L({gemId:i});q(E)&&a.push(i)}}if(!a.length){const{tile:o}=S({x:t._x,y:t._y});o._lift&&a.push(o._lift)}return a},Wn=({gemId:e})=>{const t=l({componentId:"Carry",entityId:e}),n=l({componentId:"Position",entityId:e});if(!oe({at:"target",gemId:e}))throw g({message:`${e} is not at target`,where:Wn.name});if(!t.items.length)return!1;const a=mm({gemId:e});if(a.length){const o=a.sort((i,p)=>i.priority-p.priority)[0],s=At({amount:f({gemId:e,gemType:m.CARRY,stat:"_itemAmount"}),gemId:e});return s?(Me({amount:s.amount,gemId:o.gemId,name:s.name}),w({entityId:e,image:H({gemId:e})}),!0):!1}else if(n._y===0){const{tile:o}=S({x:n._x,y:n._y+1});if(!o._lock)return w({entityId:e,image:H({error:!0,gemId:e})}),!1;const s=At({amount:f({gemId:e,gemType:m.CARRY,stat:"_itemAmount"}),gemId:e});return s?(fe({amount:s.amount,name:s.name}),w({entityId:e,image:H({gemId:e})}),r({data:{amount:s.amount},entityId:e,target:"engine",type:d.QUEST_CARRY}),r({target:"render",type:u.ADMIN_UPDATE_STORAGE}),!0):!1}else return w({entityId:e,image:H({error:!0,gemId:e})}),!1},mm=({gemId:e})=>{const t=l({componentId:"Position",entityId:e}),n=[],a=wt({gemId:e,x:t._x,y:t._y});for(const o of a){if(G({gemId:o})===m.CARRY)continue;const i=L({gemId:o});q(i)&&(Te({gemId:o})||at({componentId:m.LIFT,entityId:o})&&n.push({gemId:o,priority:1}))}if(!n.length){const{tile:o}=S({x:t._x,y:t._y});o._lift&&(Te({gemId:o._lift})||n.push({gemId:o._lift,priority:1}))}return n},bt=({gemId:e})=>{const t=l({componentId:"Carry",entityId:e}),n=l({componentId:"Position",entityId:e});if(!t._moveTo)throw g({message:`${e} is not moving to a target`,where:bt.name});if(t._moveStartX===void 0||t._moveStartY===void 0||t._moveTargetX===void 0||t._moveTargetY===void 0)throw g({message:`${e} has invalid carry target`,where:bt.name});const a=t._moveTo==="start"?{x:t._moveStartX,y:t._moveStartY}:{x:t._moveTargetX,y:t._moveTargetY};if(t._moveTo==="start"&&!oe({at:"start",gemId:e})){const p=a.x-n._x,E=a.y-n._y;if(Math.abs(E)>0){const y=n._y+Math.sign(E),{tile:N}=S({x:n._x,y});return N._destroy?(n._y=y,r({entityId:e,target:"render",type:u.POSITION_UPDATE}),!1):(Be({gemId:e}),r({data:{alert:!0,text:`${t._name} cannot reach start position`,type:"error"},entityId:e,target:"render",type:u.INFO}),!1)}if(Math.abs(p)>0){const y=n._x+Math.sign(p),{tile:N}=S({x:y,y:n._y});return N._destroy?(n._x=y,r({entityId:e,target:"render",type:u.POSITION_UPDATE}),!1):(Be({gemId:e}),r({data:{alert:!0,text:`${t._name} cannot reach start position`,type:"error"},entityId:e,target:"render",type:u.INFO}),!1)}return!0}const o=a.x-n._x;if(o===0)return!0;const s={x:n._x+Math.sign(o),y:n._y},{tile:i}=S({x:s.x,y:s.y});return i._destroy?(n._x=s.x,n._y=s.y,r({entityId:e,target:"render",type:u.POSITION_UPDATE}),oe({at:t._moveTo,gemId:e})):(Be({gemId:e}),r({data:{alert:!0,text:`${t._name} cannot carry to target`,type:"error"},entityId:e,target:"render",type:u.INFO}),!1)},lm=({gemId:e})=>{const t=l({componentId:"Carry",entityId:e});t._xp+=1,t._xp>=t._xpToNext&&(t._xp=0,t._xpLvl+=1,t._xpToNext=t._xpToNext*1.5,t._itemCapacity+=1,t._xpLvl%10===0?t._itemSpeed+=.5:t._xpLvl%50===0?t._itemAmount+=1:t._xpLvl%100===0&&(t._itemRange+=1))},cm=({gemId:e})=>{Q({gemId:e,request:!0}),k({action:"work",gemId:e})},Re=({gemId:e})=>{Q({gemId:e,request:!1}),k({action:"idle",gemId:e}),r({entityId:e,target:"render",type:u.GEM_STOP})},um=({gemId:e})=>{const t=l({componentId:"Floor",entityId:e}),n=l({componentId:"Position",entityId:e});if(n._y<=0){r({data:{alert:!0,text:`${t._name} is too close to the surface to create a floor`,type:"warning"},entityId:e,target:"render",type:u.INFO}),Re({gemId:e});return}const{tileId:a}=S({x:n._x,y:n._y});pm({gemId:e,tileId:a})},pm=({gemId:e,tileId:t})=>{const n=l({componentId:"Floor",entityId:e}),a=l({componentId:"Position",entityId:e}),o=l({componentId:"Tile",entityId:t}),{tile:s}=S({x:a._x,y:a._y-1});if(!s._destroy){r({data:{text:`${n._name} floor has reached a ceiling`,type:"confirm"},entityId:e,target:"render",type:u.INFO}),Re({gemId:e});return}if(wt({gemId:e,x:a._x,y:a._y}).length){r({data:{text:`${n._name} is blocked by other gems`,type:"confirm"},entityId:e,target:"render",type:u.INFO}),Re({gemId:e});return}if(o._destroy)if(f({gemId:e,gemType:m.FLOOR,stat:"_digStrength"})<o._density){r({data:{text:`${n._name} is not strong enough to floor this ground`,type:"confirm"},entityId:e,target:"render",type:u.INFO}),Re({gemId:e});return}else a._y-=1,r({entityId:e,target:"render",type:u.POSITION_UPDATE}),Dn({tileId:t,value:!1}),dm({gemId:e})},dm=({gemId:e})=>{const t=l({componentId:"Floor",entityId:e});t._xp+=1,t._xp>=t._xpToNext&&(t._xp=0,t._xpLvl+=1,t._xpToNext=t._xpToNext*1.5,t._xpLvl%10===0&&(t._digStrength+=1))},Bt=4,gm=({gemId:e})=>{const t=l({componentId:"Lift",entityId:e}),n=l({componentId:"Position",entityId:e});if(t._moveTo="start",t._moveStartX=n._x,t._moveStartY=n._y,t._moveStartY>=Bt){const{tile:a,tileId:o}=S({x:t._moveStartX,y:t._moveStartY+1});if(a._destroy||!__({tileId:o})||m_({tileId:o})||a._lift){r({data:{alert:!0,text:`${t._name} cannot start a lift on this tile`,type:"error"},entityId:e,target:"render",type:u.INFO}),r({entityId:e,target:"render",type:u.GEM_STOP});return}$t({tileId:o,value:!0})}Jn({gemId:e}),Q({gemId:e,request:!0}),k({action:"work",gemId:e})},me=({gemId:e})=>{const t=l({componentId:"Lift",entityId:e});if(t._moveStartX===void 0||t._moveStartY===void 0)throw g({message:`${e} has no lift start position`,where:me.name});if(t._moveTargetX===void 0||t._moveTargetY===void 0)throw g({message:`${e} has no lift target position`,where:me.name});if(t._moveStartY>=Bt){const{tileId:o}=S({x:t._moveStartX,y:t._moveStartY+1});$t({tileId:o,value:!1})}const{tile:n}=S({x:t._moveStartX,y:t._moveStartY});n._lift=void 0;const{tile:a}=S({x:t._moveTargetX,y:t._moveTargetY});a._lift=void 0,t._moveTo=void 0,t._moveStartX=void 0,t._moveStartY=void 0,t._moveTargetX=void 0,t._moveTargetY=void 0,Q({gemId:e,request:!1}),k({action:"idle",gemId:e}),r({entityId:e,target:"render",type:u.GEM_STOP})},Kn=({gemId:e})=>{const t=l({componentId:"Lift",entityId:e});if(t._moveStartX===void 0||t._moveStartY===void 0||t._moveTargetX===void 0||t._moveTargetY===void 0)throw g({message:`${e} has invalid lift target`,where:Kn.name});if(t._moveStartY<Bt){r({data:{alert:!0,text:`${t._name} is too close to the surface to start a lift`,type:"warning"},entityId:e,target:"render",type:u.INFO}),me({gemId:e});return}ym({gemId:e}),St({gemId:e})&&(t._moveTo=t._moveTo==="start"?"target":"start")},Jn=({gemId:e})=>{const t=l({componentId:"Lift",entityId:e});if(t._moveStartX===void 0||t._moveStartY===void 0)throw g({message:`${e} has no lift start position`,where:Jn.name});t._moveTargetX=t._moveStartX,t._moveTargetY=t._moveStartY;const n=f({gemId:e,gemType:m.LIFT,stat:"_itemRange"});let a=0;for(;a<n;){if(a++,t._moveTargetY--,t._moveTargetY<=0){t._moveTargetY=0;break}const{tile:i}=S({x:t._moveTargetX,y:t._moveTargetY});if(!i._destroy){t._moveTargetY++;break}}const{tile:o}=S({x:t._moveStartX,y:t._moveStartY});o._lift=e;const{tile:s}=S({x:t._moveTargetX,y:t._moveTargetY});s._lift=e},St=({gemId:e})=>{const t=l({componentId:"Lift",entityId:e}),n=l({componentId:"Position",entityId:e});if(!t._moveTo)throw g({message:`${e} is not moving to a target`,where:St.name});if(t._moveStartX===void 0||t._moveStartY===void 0||t._moveTargetX===void 0||t._moveTargetY===void 0)throw g({message:`${e} has invalid lift target`,where:St.name});const a=t._moveTo==="start"?{x:t._moveStartX,y:t._moveStartY}:{x:t._moveTargetX,y:t._moveTargetY};if(t._moveTo==="start"&&!oe({at:"start",gemId:e})){const p=a.x-n._x,E=a.y-n._y;if(Math.abs(p)>0){const y=n._x+Math.sign(p),{tile:N}=S({x:y,y:n._y});return N._destroy?(n._x=y,r({entityId:e,target:"render",type:u.POSITION_UPDATE}),!1):(me({gemId:e}),r({data:{alert:!0,text:`${t._name} cannot reach start position`,type:"error"},entityId:e,target:"render",type:u.INFO}),!1)}if(Math.abs(E)>0){const y=n._y+Math.sign(E),{tile:N}=S({x:n._x,y});return N._destroy?(n._y=y,r({entityId:e,target:"render",type:u.POSITION_UPDATE}),!1):(me({gemId:e}),r({data:{alert:!0,text:`${t._name} cannot reach start position`,type:"error"},entityId:e,target:"render",type:u.INFO}),!1)}return!0}const o=a.y-n._y;if(o===0)return!0;const s={x:n._x,y:n._y+Math.sign(o)},{tile:i}=S({x:s.x,y:s.y});return i._destroy?(n._x=s.x,n._y=s.y,r({entityId:e,target:"render",type:u.POSITION_UPDATE}),oe({at:t._moveTo,gemId:e})):(me({gemId:e}),r({data:{alert:!0,text:`${t._name} cannot lift to target`,type:"error"},entityId:e,target:"render",type:u.INFO}),!1)},ym=({gemId:e})=>{const t=l({componentId:"Lift",entityId:e});t._xp+=1,t._xp>=t._xpToNext&&(t._xp=0,t._xpLvl+=1,t._xpToNext=t._xpToNext*1.5,t._itemCapacity+=1)},Em=({gemId:e})=>{Q({gemId:e,request:!0}),k({action:"work",gemId:e})},It=({gemId:e})=>{Q({gemId:e,request:!1}),k({action:"idle",gemId:e}),r({entityId:e,target:"render",type:u.GEM_STOP})},fm=({gemId:e})=>{const t=l({componentId:"Mine",entityId:e}),n=l({componentId:"Position",entityId:e}),{tile:a,tileId:o}=S({x:n._x,y:n._y+1});if(a._lock){r({data:{alert:!0,text:`${t._name} cannot mine a locked tile`,type:"warning"},entityId:e,target:"render",type:u.INFO}),It({gemId:e});return}const{drop:s,stop:i}=Ke({gemId:e,tileId:o});s&&(Mm({gemId:e}),r({data:{amount:1,name:s},entityId:e,target:"render",type:u.GEM_TOAST}),r({data:{amount:1,name:s},entityId:e,target:"engine",type:d.QUEST_MINE})),i&&It({gemId:e})},Mm=({gemId:e})=>{const t=l({componentId:"Mine",entityId:e});t._xp+=1,t._xp>=t._xpToNext&&(t._xp=0,t._xpLvl+=1,t._xpToNext=t._xpToNext*1.5,t._itemCapacity+=1,t._xpLvl%10===0?t._digSpeed+=.5:t._xpLvl%50===0?t._digAmount+=1:t._xpLvl%100===0&&(t._digStrength+=1))},Am=4,Tm=({gemId:e})=>{const t=l({componentId:"Shaft",entityId:e});t._digOffset=1,Q({gemId:e,request:!0}),k({action:"work",gemId:e})},xe=({gemId:e})=>{const t=l({componentId:"Shaft",entityId:e});t._digOffset=void 0,Q({gemId:e,request:!1}),k({action:"idle",gemId:e}),r({entityId:e,target:"render",type:u.GEM_STOP})},bm=({gemId:e})=>{const t=l({componentId:"Shaft",entityId:e}),n=l({componentId:"Position",entityId:e});if(n._y<Am){r({data:{alert:!0,text:`${t._name} is too close to the surface to dig a shaft`,type:"warning"},entityId:e,target:"render",type:u.INFO}),xe({gemId:e});return}if(!t._digOffset)throw g({message:`${e} has no shaft offset`,where:qt.name});const a=f({gemId:e,gemType:m.SHAFT,stat:"_digRange"});if(t._digOffset>a){r({data:{text:`${t._name} shaft has reached maximum range`,type:"confirm"},entityId:e,target:"render",type:u.INFO}),xe({gemId:e});return}if(n._y-t._digOffset<=0){r({data:{text:`${t._name} shaft has reached the surface`,type:"confirm"},entityId:e,target:"render",type:u.INFO}),xe({gemId:e});return}const{tileId:o}=S({x:n._x,y:n._y-t._digOffset}),{destroy:s,stop:i}=Ke({gemId:e,tileId:o});i?xe({gemId:e}):s?t._digOffset++:Sm({gemId:e})},Sm=({gemId:e})=>{const t=l({componentId:"Shaft",entityId:e});t._xp+=1,t._xp>=t._xpToNext&&(t._xp=0,t._xpLvl+=1,t._xpToNext=t._xpToNext*1.5,t._digSpeed+=.5,t._xpLvl%10===0?t._digRange+=1:t._xpLvl%50===0&&(t._digStrength+=1))},Im=4,Nm=({gemId:e})=>{const t=l({componentId:"Tunnel",entityId:e});t._digOffset=1,Q({gemId:e,request:!0}),k({action:"work",gemId:e})},qe=({gemId:e})=>{const t=l({componentId:"Tunnel",entityId:e});t._digOffset=void 0,Q({gemId:e,request:!1}),k({action:"idle",gemId:e}),r({entityId:e,target:"render",type:u.GEM_STOP})},qt=({gemId:e})=>{const t=l({componentId:"Tunnel",entityId:e}),n=l({componentId:"Position",entityId:e});if(n._y<Im){r({data:{alert:!0,text:`${t._name} is too close to the surface to dig a tunnel`,type:"warning"},entityId:e,target:"render",type:u.INFO}),qe({gemId:e});return}if(!t._digOffset)throw g({message:`${e} has no tunnel offset`,where:qt.name});const a=f({gemId:e,gemType:m.TUNNEL,stat:"_digRange"});if(t._digOffset>a){r({data:{text:`${t._name} tunnel has reached maximum range`,type:"confirm"},entityId:e,target:"render",type:u.INFO}),qe({gemId:e});return}const{tileId:o}=S({x:n._x-t._digOffset,y:n._y}),{tileId:s}=S({x:n._x+t._digOffset,y:n._y}),{destroy:i,stop:p}=Ke({gemId:e,tileId:o}),{destroy:E,stop:y}=Ke({gemId:e,tileId:s});p||y?qe({gemId:e}):i&&E?t._digOffset++:Gm({gemId:e})},Gm=({gemId:e})=>{const t=l({componentId:"Tunnel",entityId:e});t._xp+=1,t._xp>=t._xpToNext&&(t._xp=0,t._xpLvl+=1,t._xpToNext=t._xpToNext*1.5,t._digSpeed+=.5,t._xpLvl%10===0?t._digRange+=1:t._xpLvl%50===0&&(t._digStrength+=1))},Lm={[m.CARRY]:im,[m.FLOOR]:um,[m.LIFT]:Kn,[m.MINE]:fm,[m.SHAFT]:bm,[m.TUNNEL]:qt},xm=({gemId:e})=>{const t=G({gemId:e});Lm[t]({gemId:e})},L=({gemId:e})=>{const t=G({gemId:e});return l({componentId:t,entityId:e})},G=({gemId:e})=>{const t=Object.values(m).find(n=>at({componentId:n,entityId:e}));if(!t)throw g({message:`Gem ${e} has no type`,where:G.name});return t},f=({gemId:e,gemType:t,stat:n})=>{if(!n)throw g({message:`Invalid stat ${n}`,where:f.name});const a=T(),o=L({gemId:e});if(o||g({message:`Invalid gem ${e}`,where:f.name}),!(n in o))throw g({message:`Stat ${n} is not valid for gemType ${t}`,where:f.name});const s=n.slice(1)[0].toUpperCase()+n.slice(2),i=`_gem${t}${s}`;if(o._mech){const p=Xn({mechName:o._mech}),E=n.slice(1),y=p.stats[E]??0;return Math.round((o[n]+(a.stats[i]??0)+y)*10)/10}return Math.round((o[n]+(a.stats[i]??0))*10)/10},Zn=({gemId:e})=>{const t=G({gemId:e}),n=l({componentId:"State",entityId:e});if(t===m.MINE||t===m.FLOOR||t===m.SHAFT||t===m.TUNNEL)return n._action==="move"?f({gemId:e,gemType:t,stat:"_moveSpeed"}):f({gemId:e,gemType:t,stat:"_digSpeed"});if(t===m.CARRY||t===m.LIFT)return n._action==="move"?f({gemId:e,gemType:t,stat:"_moveSpeed"}):f({gemId:e,gemType:t,stat:"_itemSpeed"});throw g({message:`Gem ${e} has no action speed`,where:Zn.name})},se=({gemType:e})=>T().gems.filter(n=>G({gemId:n})===e).length,H=({gemId:e,error:t=!1})=>{var s;const n=L({gemId:e});let o=`gem_${G({gemId:e}).toLowerCase()}`;return Rm({gemId:e})&&(o+=`_${(s=n._mech)==null?void 0:s.split("_")[0].toLowerCase()}`),t&&(o+="_error"),o},Q=({gemId:e,request:t})=>{const n=T(),a=l({componentId:"State",entityId:e});if(a._request=t,t)n.requests.includes(e)||n.requests.push(e);else{const o=n.requests.indexOf(e);o>-1&&n.requests.splice(o,1)}},ln=({gemId:e,store:t})=>{const n=T(),a=l({componentId:"State",entityId:e}),o=l({componentId:"Position",entityId:e}),s=L({gemId:e});a._store=t,a._store&&(k({action:"idle",gemId:e}),n.requests=n.requests.filter(i=>i!==e),o._x=0,o._y=0,q(s)&&(s.items=[]),s._mech&&r({entityId:e,target:"engine",type:d.GEM_EQUIP}),w({entityId:e,image:H({gemId:e})}),r({entityId:e,target:"render",type:u.GEM_UPDATE})),r({data:{text:`${s._name} ${t?"stored":"deployed"}`,type:"confirm"},entityId:e,target:"render",type:u.INFO})},k=({gemId:e,action:t})=>{const n=l({componentId:"State",entityId:e});n._action=t,r({entityId:e,target:"render",type:u.GEM_UPDATE})},q=e=>"items"in e&&"_itemCapacity"in e,Te=({gemId:e})=>{const t=G({gemId:e}),n=L({gemId:e});return q(n)?n.items.reduce((o,s)=>o+s._amount,0)>=f({gemId:e,gemType:t,stat:"_itemCapacity"}):!1},oe=({gemId:e,at:t})=>{const a=G({gemId:e})===m.CARRY?l({componentId:"Carry",entityId:e}):l({componentId:"Lift",entityId:e}),o=l({componentId:"Position",entityId:e});return t==="start"?o._x===a._moveStartX&&o._y===a._moveStartY:t==="target"?o._x===a._moveTargetX&&o._y===a._moveTargetY:!1},ea=({gemType:e})=>T().crafts.includes(`GEM_${e.toUpperCase()}`),Rm=({gemId:e})=>!!L({gemId:e})._mech,Om=({gemId:e})=>{const t=T(),n=G({gemId:e}),a=L({gemId:e}),o=De({itemName:`GEM_${n.toUpperCase()}`});for(const s of o.components)fe({amount:s.amount,name:s.name});t.gems=t.gems.filter(s=>s!==e),r({data:{alert:!0,text:`${a._name} destroyed`,type:"confirm"},target:"render",type:u.INFO}),r({data:{amount:-1},target:"engine",type:d.QUEST_GEMS}),$i({entityId:e})},hm=({name:e})=>{const t=T(),a={_done:!1,_name:le({name:e}).name,_progress:0,_run:!1};t.labs.push(a)},Cm=({name:e})=>{const t=T(),n=jt({name:e});if(!n||n._run)return;const a=le({name:n._name});t.stats._labPoints>=a.cost?(t.stats._labPoints-=a.cost,n._run=!0,r({data:{text:`Starting ${e}`,type:"confirm"},target:"render",type:u.INFO}),r({target:"render",type:u.ADMIN_UPDATE_LABS})):r({data:{alert:!0,text:`Not enough Lab Points to run ${e}`,type:"warning"},target:"render",type:u.INFO})},Ym=({name:e})=>{const t=jt({name:e});if(!t||!t._run)return;const n=le({name:t._name});if(t._progress+=1,t._progress>=n.time){ta({name:n.name}),r({target:"render",type:u.ADMIN_UPDATE_LABS});return}r({target:"render",type:u.ADMIN_UPDATE_LABS})},ta=({name:e})=>{const t=T(),n=jt({name:e});if(!n)throw g({message:`Lab ${e} not found`,where:ta.name});const a=le({name:n._name});n._run=!1,n._done=!0;for(const o of a.unlock)if(o.type==="craft")t.crafts.push(o.name),r({target:"render",type:u.ADMIN_UPDATE_WORKSHOP});else if(o.type==="stat"){const s=Um({name:o.name});t.stats[s]=Math.round((t.stats[s]+o.amount)*10)/10,r({target:"render",type:u.ADMIN_UPDATE_GEMS})}r({target:"render",type:u.ADMIN_UPDATE_LABS}),r({data:{text:`${a.text} complete !`,type:"success"},target:"render",type:u.INFO})},jt=({name:e})=>T().labs.find(a=>a._name===e&&a._done===!1),Um=({name:e})=>"_"+e.toLowerCase().replace(/_([a-z])/g,(n,a)=>a.toUpperCase()),Dm=JSON.parse('[{"@":"CRAFT"},{"name":"LAB_CRAFT_GEM_CARRY","text":"Unlock crafting Carry Gems","image":"lab_gem_carry","cost":1,"time":15,"unlock":[{"type":"craft","name":"GEM_CARRY"}]},{"name":"LAB_CRAFT_GEM_TUNNEL","text":"Unlock crafting Tunnel Gems","image":"lab_gem_tunnel","cost":2,"time":40,"unlock":[{"type":"craft","name":"GEM_TUNNEL"}]},{"name":"LAB_CRAFT_GEM_FLOOR","text":"Unlock crafting Floor Gems","image":"lab_gem_floor","cost":3,"time":80,"unlock":[{"type":"craft","name":"GEM_FLOOR"}]},{"name":"LAB_CRAFT_GEM_LIFT","text":"Unlock crafting Lift Gems","image":"lab_gem_lift","cost":4,"time":120,"unlock":[{"type":"craft","name":"GEM_LIFT"}]},{"name":"LAB_CRAFT_GEM_SHAFT","text":"Unlock crafting Shaft Gems","image":"lab_gem_shaft","cost":5,"time":160,"unlock":[{"type":"craft","name":"GEM_SHAFT"}]},{"name":"LAB_CRAFT_MK1_MINE","text":"Unlock crafting MK1 Mine Mechs","image":"lab_mk1_mine","cost":8,"time":300,"unlock":[{"type":"craft","name":"MK1_MINE"}]},{"name":"LAB_CRAFT_FORGE_VULKAN","text":"Unlock crafting Vulcan Forges","image":"lab_forge_vulkan","cost":5,"time":120,"unlock":[{"type":"craft","name":"FORGE_VULKAN"}]},{"name":"LAB_CRAFT_FORGE_ORYON","text":"Unlock crafting Oryon Forges","image":"lab_forge_oryon","cost":5,"time":120,"unlock":[{"type":"craft","name":"FORGE_ORYON"}]},{"name":"LAB_CRAFT_MK1_TUNNEL","text":"Unlock crafting MK1 Tunnel Mechs","image":"lab_mk1_tunnel","cost":10,"time":330,"unlock":[{"type":"craft","name":"MK1_TUNNEL"}]},{"name":"LAB_CRAFT_MK1_CARRY","text":"Unlock crafting MK1 Carry Mechs","image":"lab_mk1_carry","cost":12,"time":360,"unlock":[{"type":"craft","name":"MK1_CARRY"}]},{"@":"GEM_MAX"},{"name":"LAB_GEM_MAX_1","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":1,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_2","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":1,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_3","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":1,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_4","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":1,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_5","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":1,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_6","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":2,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_7","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":2,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_8","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":2,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_9","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":2,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_10","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":2,"time":30,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_11","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":3,"time":60,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_12","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":3,"time":60,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_13","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":3,"time":60,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_14","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":3,"time":60,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_15","text":"Increase Max Gem by 1","image":"lab_gem_max","cost":3,"time":60,"unlock":[{"type":"stat","name":"GEM_MAX","amount":1}]},{"name":"LAB_GEM_MAX_16","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":5,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_17","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":5,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_18","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":5,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_19","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":5,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_20","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":5,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_21","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":6,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_22","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":6,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_23","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":6,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_24","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":6,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_25","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":6,"time":90,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_26","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":7,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_27","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":7,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_28","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":7,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_29","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":7,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_30","text":"Increase Max Gem by 2","image":"lab_gem_max","cost":7,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":2}]},{"name":"LAB_GEM_MAX_31","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":9,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_32","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":9,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_33","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":9,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_34","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":9,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_35","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":9,"time":120,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_36","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":12,"time":150,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_37","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":12,"time":150,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_38","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":12,"time":150,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_39","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":12,"time":150,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"name":"LAB_GEM_MAX_40","text":"Increase Max Gem by 3","image":"lab_gem_max","cost":12,"time":150,"unlock":[{"type":"stat","name":"GEM_MAX","amount":3}]},{"@":"GEM_MOVE_SPEED"},{"name":"LAB_GEM_MOVE_SPEED_1","text":"Increase ALL Gems Move Speed by 1","image":"lab_gem_move_speed","cost":3,"time":100,"unlock":[{"type":"stat","name":"GEM_MINE_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_CARRY_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_TUNNEL_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_LIFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_SHAFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_FLOOR_MOVE_SPEED","amount":1}]},{"name":"LAB_GEM_MOVE_SPEED_2","text":"Increase ALL Gems Move Speed by 1","image":"lab_gem_move_speed","cost":6,"time":200,"unlock":[{"type":"stat","name":"GEM_MINE_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_CARRY_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_TUNNEL_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_LIFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_SHAFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_FLOOR_MOVE_SPEED","amount":1}]},{"name":"LAB_GEM_MOVE_SPEED_3","text":"Increase ALL Gems Move Speed by 1","image":"lab_gem_move_speed","cost":9,"time":300,"unlock":[{"type":"stat","name":"GEM_MINE_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_CARRY_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_TUNNEL_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_LIFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_SHAFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_FLOOR_MOVE_SPEED","amount":1}]},{"name":"LAB_GEM_MOVE_SPEED_4","text":"Increase ALL Gems Move Speed by 1","image":"lab_gem_move_speed","cost":12,"time":400,"unlock":[{"type":"stat","name":"GEM_MINE_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_CARRY_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_TUNNEL_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_LIFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_SHAFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_FLOOR_MOVE_SPEED","amount":1}]},{"name":"LAB_GEM_MOVE_SPEED_5","text":"Increase ALL Gems Move Speed by 1","image":"lab_gem_move_speed","cost":15,"time":500,"unlock":[{"type":"stat","name":"GEM_MINE_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_CARRY_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_TUNNEL_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_LIFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_SHAFT_MOVE_SPEED","amount":1},{"type":"stat","name":"GEM_FLOOR_MOVE_SPEED","amount":1}]},{"@":"GEM_MINE_ITEM_CAPACITY"},{"name":"LAB_GEM_MINE_ITEM_CAPACITY_1","text":"Increase ALL MINE Gems Item Capacity by 5","image":"lab_gem_mine_item_capacity","cost":2,"time":100,"unlock":[{"type":"stat","name":"GEM_MINE_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_MINE_ITEM_CAPACITY_2","text":"Increase ALL MINE Gems Item Capacity by 5","image":"lab_gem_mine_item_capacity","cost":4,"time":200,"unlock":[{"type":"stat","name":"GEM_MINE_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_MINE_ITEM_CAPACITY_3","text":"Increase ALL MINE Gems Item Capacity by 5","image":"lab_gem_mine_item_capacity","cost":6,"time":300,"unlock":[{"type":"stat","name":"GEM_MINE_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_MINE_ITEM_CAPACITY_4","text":"Increase ALL MINE Gems Item Capacity by 5","image":"lab_gem_mine_item_capacity","cost":9,"time":400,"unlock":[{"type":"stat","name":"GEM_MINE_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_MINE_ITEM_CAPACITY_5","text":"Increase ALL MINE Gems Item Capacity by 5","image":"lab_gem_mine_item_capacity","cost":12,"time":500,"unlock":[{"type":"stat","name":"GEM_MINE_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_MINE_ITEM_CAPACITY_6","text":"Increase ALL MINE Gems Item Capacity by 5","image":"lab_gem_mine_item_capacity","cost":15,"time":600,"unlock":[{"type":"stat","name":"GEM_MINE_ITEM_CAPACITY","amount":5}]},{"@":"GEM_MINE_DIG_SPEED"},{"name":"LAB_GEM_MINE_DIG_SPEED_1","text":"Increase ALL MINE Gems Dig Speed by 0.2","image":"lab_gem_mine_dig_speed","cost":1,"time":50,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_SPEED","amount":0.2}]},{"name":"LAB_GEM_MINE_DIG_SPEED_2","text":"Increase ALL MINE Gems Dig Speed by 0.2","image":"lab_gem_mine_dig_speed","cost":2,"time":100,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_SPEED","amount":0.2}]},{"name":"LAB_GEM_MINE_DIG_SPEED_3","text":"Increase ALL MINE Gems Dig Speed by 0.2","image":"lab_gem_mine_dig_speed","cost":3,"time":150,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_SPEED","amount":0.2}]},{"name":"LAB_GEM_MINE_DIG_SPEED_4","text":"Increase ALL MINE Gems Dig Speed by 0.2","image":"lab_gem_mine_dig_speed","cost":5,"time":200,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_SPEED","amount":0.2}]},{"name":"LAB_GEM_MINE_DIG_SPEED_5","text":"Increase ALL MINE Gems Dig Speed by 0.2","image":"lab_gem_mine_dig_speed","cost":7,"time":250,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_SPEED","amount":0.2}]},{"name":"LAB_GEM_MINE_DIG_SPEED_6","text":"Increase ALL MINE Gems Dig Speed by 0.2","image":"lab_gem_mine_dig_speed","cost":9,"time":300,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_SPEED","amount":0.2}]},{"@":"GEM_MINE_DIG_STRENGTH"},{"name":"LAB_GEM_MINE_DIG_STRENGTH_1","text":"Increase ALL MINE Gems Dig Strength by 1","image":"lab_gem_mine_dig_strength","cost":10,"time":1000,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_STRENGTH","amount":1}]},{"@":"GEM_MINE_DIG_AMOUNT"},{"name":"LAB_GEM_MINE_DIG_AMOUNT_1","text":"Increase ALL MINE Gems Dig Amount by 1","image":"lab_gem_mine_dig_amount","cost":15,"time":1500,"unlock":[{"type":"stat","name":"GEM_MINE_DIG_AMOUNT","amount":1}]},{"@":"GEM_CARRY_ITEM_CAPACITY"},{"name":"LAB_GEM_CARRY_ITEM_CAPACITY_1","text":"Increase ALL CARRY Gems Item Capacity by 5","image":"lab_gem_carry_item_capacity","cost":2,"time":100,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_CARRY_ITEM_CAPACITY_2","text":"Increase ALL CARRY Gems Item Capacity by 5","image":"lab_gem_carry_item_capacity","cost":4,"time":200,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_CARRY_ITEM_CAPACITY_3","text":"Increase ALL CARRY Gems Item Capacity by 5","image":"lab_gem_carry_item_capacity","cost":6,"time":300,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_CARRY_ITEM_CAPACITY_4","text":"Increase ALL CARRY Gems Item Capacity by 5","image":"lab_gem_carry_item_capacity","cost":8,"time":400,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_CAPACITY","amount":5}]},{"name":"LAB_GEM_CARRY_ITEM_CAPACITY_5","text":"Increase ALL CARRY Gems Item Capacity by 5","image":"lab_gem_carry_item_capacity","cost":10,"time":500,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_CAPACITY","amount":5}]},{"@":"GEM_CARRY_ITEM_SPEED"},{"name":"LAB_GEM_CARRY_ITEM_SPEED_1","text":"Increase ALL CARRY Gems item speed by 0.2","image":"lab_gem_carry_item_speed","cost":1,"time":50,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_SPEED","amount":0.2}]},{"name":"LAB_GEM_CARRY_ITEM_SPEED_2","text":"Increase ALL CARRY Gems item speed by 0.2","image":"lab_gem_carry_item_speed","cost":2,"time":100,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_SPEED","amount":0.2}]},{"name":"LAB_GEM_CARRY_ITEM_SPEED_3","text":"Increase ALL CARRY Gems item speed by 0.2","image":"lab_gem_carry_item_speed","cost":3,"time":150,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_SPEED","amount":0.2}]},{"name":"LAB_GEM_CARRY_ITEM_SPEED_4","text":"Increase ALL CARRY Gems item speed by 0.2","image":"lab_gem_carry_item_speed","cost":4,"time":200,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_SPEED","amount":0.2}]},{"name":"LAB_GEM_CARRY_ITEM_SPEED_5","text":"Increase ALL CARRY Gems item speed by 0.2","image":"lab_gem_carry_item_speed","cost":5,"time":250,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_SPEED","amount":0.2}]},{"@":"GEM_CARRY_ITEM_AMOUNT"},{"name":"LAB_GEM_CARRY_ITEM_AMOUNT_1","text":"Increase ALL CARRY Gems Item Amount by 1","image":"lab_gem_carry_item_amount","cost":3,"time":200,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_AMOUNT","amount":1}]},{"name":"LAB_GEM_CARRY_ITEM_AMOUNT_2","text":"Increase ALL CARRY Gems Item Amount by 1","image":"lab_gem_carry_item_amount","cost":6,"time":400,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_AMOUNT","amount":1}]},{"name":"LAB_GEM_CARRY_ITEM_AMOUNT_3","text":"Increase ALL CARRY Gems Item Amount by 1","image":"lab_gem_carry_item_amount","cost":9,"time":600,"unlock":[{"type":"stat","name":"GEM_CARRY_ITEM_AMOUNT","amount":1}]},{"@":"GEM_LIFT_ITEM_CAPACITY"},{"name":"LAB_GEM_LIFT_ITEM_CAPACITY_1","text":"Increase ALL LIFT Gems Item Capacity by 15","image":"lab_gem_lift_item_capacity","cost":10,"time":200,"unlock":[{"type":"stat","name":"GEM_LIFT_ITEM_CAPACITY","amount":15}]},{"name":"LAB_GEM_LIFT_ITEM_CAPACITY_2","text":"Increase ALL LIFT Gems Item Capacity by 15","image":"lab_gem_lift_item_capacity","cost":20,"time":300,"unlock":[{"type":"stat","name":"GEM_LIFT_ITEM_CAPACITY","amount":15}]},{"name":"LAB_GEM_LIFT_ITEM_CAPACITY_3","text":"Increase ALL LIFT Gems Item Capacity by 15","image":"lab_gem_lift_item_capacity","cost":30,"time":400,"unlock":[{"type":"stat","name":"GEM_LIFT_ITEM_CAPACITY","amount":15}]}]'),le=({name:e})=>Dm.filter(a=>!a["@"]).find(a=>a.name===e)??g({message:`LabData for ${e} not found`,where:le.name}),ue=({questName:e})=>{const t=T(),n=J({questName:e}),a={_done:!1,_name:n.name,_progress:0};n.type==="gem"&&(a._progress=t.gems.length),t.quests.push(a),r({target:"render",type:u.QUEST_CREATE})},vm=({name:e,amount:t})=>{const n=Pe({name:e,type:"mine"});if(!n||n._done)return;const a=J({questName:n._name});if(a.type==="mine"){if(n._progress+=t,n._progress>=a.mine.amount){ve({name:a.name,type:"mine"});return}r({target:"render",type:u.QUEST_UPDATE})}},Pm=({amount:e})=>{const t=Pe({name:"carry",type:"carry"});if(!t||t._done)return;const n=J({questName:t._name});if(n.type==="carry"){if(t._progress+=e,t._progress>=n.carry){ve({name:n.name,type:"carry"});return}r({target:"render",type:u.QUEST_UPDATE})}},wm=({amount:e})=>{const t=Pe({name:"gems",type:"gem"});if(!t||t._done)return;const n=J({questName:t._name});if(n.type==="gem"){if(t._progress+=e,t._progress>=n.gems){ve({name:n.name,type:"gem"});return}r({target:"render",type:u.QUEST_UPDATE})}},$m=({name:e,amount:t})=>{const n=Pe({name:e,type:"forge"});if(!n||n._done)return;const a=J({questName:n._name});if(a.type==="forge"){if(n._progress+=t,n._progress>=a.forge.amount){ve({name:a.name,type:"forge"});return}r({target:"render",type:u.QUEST_UPDATE})}},ve=({name:e,type:t})=>{const n=T(),a=Pe({name:e,type:t});if(!a)throw g({message:`Quest ${t} ${e} not found`,where:ve.name});const o=J({questName:a._name});a._done=!0;for(const s of o.reward)s.type==="lab"?(n.stats._labPoints+=s.amount,r({target:"render",type:u.ADMIN_UPDATE_LABS})):s.type==="item"&&(fe({amount:s.amount,name:s.name}),r({target:"render",type:u.ADMIN_UPDATE_STORAGE}));for(const s of o.unlock)s.type==="lab"?(hm({name:s.name}),r({target:"render",type:u.ADMIN_UPDATE_LABS}),r({data:{text:`${s.name.split("_").join(" ")} unlocked`,type:"success"},target:"render",type:u.INFO})):s.type==="quest"&&ue({questName:s.name});r({target:"render",type:u.QUEST_END}),r({data:{text:a._name,type:"quest"},target:"render",type:u.INFO})},Pe=({name:e})=>T().quests.find(a=>(a._name.includes(e.toUpperCase())||a._name===e)&&a._done===!1),km=JSON.parse('[{"@":"MINE_STONE"},{"name":"QUEST_MINE_STONE_1","type":"mine","text":"Mine 15 Stone","image":"resource_stone","mine":{"name":"STONE","amount":15},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":1}],"unlock":[{"type":"lab","name":"LAB_CRAFT_GEM_CARRY"}]},{"@":"MINE_GEOLYN"},{"name":"QUEST_MINE_GEOLYN_1","type":"mine","text":"Mine 50 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":50},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":1}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_1"},{"type":"quest","name":"QUEST_MINE_GEOLYN_2"}]},{"name":"QUEST_MINE_GEOLYN_2","type":"mine","text":"Mine 100 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":2}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_4"},{"type":"quest","name":"QUEST_MINE_GEOLYN_3"}]},{"name":"QUEST_MINE_GEOLYN_3","type":"mine","text":"Mine 150 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":150},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":3}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_7"},{"type":"quest","name":"QUEST_MINE_GEOLYN_4"}]},{"name":"QUEST_MINE_GEOLYN_4","type":"mine","text":"Mine 200 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":200},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":4}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_10"},{"type":"lab","name":"LAB_GEM_MINE_ITEM_CAPACITY_1"},{"type":"quest","name":"QUEST_MINE_GEOLYN_5"}]},{"name":"QUEST_MINE_GEOLYN_5","type":"mine","text":"Mine 300 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":300},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_13"},{"type":"quest","name":"QUEST_MINE_GEOLYN_6"}]},{"name":"QUEST_MINE_GEOLYN_6","type":"mine","text":"Mine 400 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":400},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":6}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_16"},{"type":"quest","name":"QUEST_MINE_GEOLYN_7"}]},{"name":"QUEST_MINE_GEOLYN_7","type":"mine","text":"Mine 500 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":500},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":7}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_19"},{"type":"quest","name":"QUEST_MINE_GEOLYN_8"}]},{"name":"QUEST_MINE_GEOLYN_8","type":"mine","text":"Mine 600 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":600},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":8}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_22"},{"type":"lab","name":"LAB_GEM_MINE_ITEM_CAPACITY_2"},{"type":"quest","name":"QUEST_MINE_GEOLYN_9"}]},{"name":"QUEST_MINE_GEOLYN_9","type":"mine","text":"Mine 800 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":800},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":9}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_25"},{"type":"quest","name":"QUEST_MINE_GEOLYN_10"}]},{"name":"QUEST_MINE_GEOLYN_10","type":"mine","text":"Mine 1000 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":1000},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":10}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_28"},{"type":"quest","name":"QUEST_MINE_GEOLYN_11"}]},{"name":"QUEST_MINE_GEOLYN_11","type":"mine","text":"Mine 1200 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":1200},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":11}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_31"},{"type":"quest","name":"QUEST_MINE_GEOLYN_12"}]},{"name":"QUEST_MINE_GEOLYN_12","type":"mine","text":"Mine 1500 Geolyn","image":"resource_geolyn","mine":{"name":"GEOLYN","amount":1500},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":12}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_34"},{"type":"lab","name":"LAB_GEM_MINE_ITEM_CAPACITY_3"}]},{"@":"MINE_CERULYN"},{"name":"QUEST_MINE_CERULYN_1","type":"mine","text":"Mine 50 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":50},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":1}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_2"},{"type":"quest","name":"QUEST_MINE_CERULYN_2"}]},{"name":"QUEST_MINE_CERULYN_2","type":"mine","text":"Mine 100 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":2}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_5"},{"type":"quest","name":"QUEST_MINE_CERULYN_3"}]},{"name":"QUEST_MINE_CERULYN_3","type":"mine","text":"Mine 150 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":150},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":3}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_8"},{"type":"quest","name":"QUEST_MINE_CERULYN_4"}]},{"name":"QUEST_MINE_CERULYN_4","type":"mine","text":"Mine 200 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":200},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":4}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_11"},{"type":"lab","name":"LAB_GEM_MINE_DIG_SPEED_1"},{"type":"quest","name":"QUEST_MINE_CERULYN_5"}]},{"name":"QUEST_MINE_CERULYN_5","type":"mine","text":"Mine 300 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":300},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_14"},{"type":"quest","name":"QUEST_MINE_CERULYN_6"}]},{"name":"QUEST_MINE_CERULYN_6","type":"mine","text":"Mine 400 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":400},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":6}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_17"},{"type":"quest","name":"QUEST_MINE_CERULYN_7"}]},{"name":"QUEST_MINE_CERULYN_7","type":"mine","text":"Mine 500 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":500},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":7}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_20"},{"type":"quest","name":"QUEST_MINE_CERULYN_8"}]},{"name":"QUEST_MINE_CERULYN_8","type":"mine","text":"Mine 600 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":600},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":8}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_23"},{"type":"lab","name":"LAB_GEM_MINE_DIG_SPEED_2"},{"type":"quest","name":"QUEST_MINE_CERULYN_9"}]},{"name":"QUEST_MINE_CERULYN_9","type":"mine","text":"Mine 800 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":800},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":9}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_26"},{"type":"quest","name":"QUEST_MINE_CERULYN_10"}]},{"name":"QUEST_MINE_CERULYN_10","type":"mine","text":"Mine 1000 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":1000},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":10}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_29"},{"type":"quest","name":"QUEST_MINE_CERULYN_11"}]},{"name":"QUEST_MINE_CERULYN_11","type":"mine","text":"Mine 1200 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":1200},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":11}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_32"},{"type":"quest","name":"QUEST_MINE_CERULYN_12"}]},{"name":"QUEST_MINE_CERULYN_12","type":"mine","text":"Mine 1400 Cerulyn","image":"resource_cerulyn","mine":{"name":"CERULYN","amount":1400},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":12}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_35"},{"type":"lab","name":"LAB_GEM_MINE_DIG_SPEED_3"}]},{"@":"MINE_DAMSYN"},{"name":"QUEST_MINE_DAMSYN_1","type":"mine","text":"Mine 50 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":50},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":3}],"unlock":[{"type":"lab","name":"LAB_CRAFT_FORGE_VULKAN"},{"type":"quest","name":"QUEST_FORGE_VIRIDYN_1"},{"type":"quest","name":"QUEST_MINE_DAMSYN_2"}]},{"name":"QUEST_MINE_DAMSYN_2","type":"mine","text":"Mine 100 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":4}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_3"}]},{"name":"QUEST_MINE_DAMSYN_3","type":"mine","text":"Mine 150 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":150},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_4"}]},{"name":"QUEST_MINE_DAMSYN_4","type":"mine","text":"Mine 200 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":6}],"unlock":[{"type":"lab","name":"LAB_GEM_MINE_ITEM_CAPACITY_4"},{"type":"quest","name":"QUEST_MINE_DAMSYN_5"}]},{"name":"QUEST_MINE_DAMSYN_5","type":"mine","text":"Mine 300 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":7}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_6"}]},{"name":"QUEST_MINE_DAMSYN_6","type":"mine","text":"Mine 400 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":400},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":8}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_7"}]},{"name":"QUEST_MINE_DAMSYN_7","type":"mine","text":"Mine 500 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":500},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":9}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_8"}]},{"name":"QUEST_MINE_DAMSYN_8","type":"mine","text":"Mine 600 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":600},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":10}],"unlock":[{"type":"lab","name":"LAB_GEM_MINE_ITEM_CAPACITY_5"},{"type":"quest","name":"QUEST_MINE_DAMSYN_9"}]},{"name":"QUEST_MINE_DAMSYN_9","type":"mine","text":"Mine 800 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":800},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":11}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_10"}]},{"name":"QUEST_MINE_DAMSYN_10","type":"mine","text":"Mine 1000 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":1000},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":12}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_11"}]},{"name":"QUEST_MINE_DAMSYN_11","type":"mine","text":"Mine 1200 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":1200},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":13}],"unlock":[{"type":"quest","name":"QUEST_MINE_DAMSYN_12"}]},{"name":"QUEST_MINE_DAMSYN_12","type":"mine","text":"Mine 1500 Damsyn","image":"resource_damsyn","mine":{"name":"DAMSYN","amount":1500},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":14}],"unlock":[{"type":"lab","name":"LAB_GEM_MINE_ITEM_CAPACITY_6"}]},{"@":"MINE_CLARYN"},{"name":"QUEST_MINE_CLARYN_1","type":"mine","text":"Mine 50 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":50},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":3}],"unlock":[{"type":"lab","name":"LAB_CRAFT_FORGE_ORYON"},{"type":"quest","name":"QUEST_FORGE_FIRMYN_1"},{"type":"quest","name":"QUEST_MINE_CLARYN_2"}]},{"name":"QUEST_MINE_CLARYN_2","type":"mine","text":"Mine 100 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":4}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_3"}]},{"name":"QUEST_MINE_CLARYN_3","type":"mine","text":"Mine 150 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":150},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_4"}]},{"name":"QUEST_MINE_CLARYN_4","type":"mine","text":"Mine 200 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":6}],"unlock":[{"type":"lab","name":"LAB_GEM_MINE_DIG_SPEED_4"},{"type":"quest","name":"QUEST_MINE_CLARYN_5"}]},{"name":"QUEST_MINE_CLARYN_5","type":"mine","text":"Mine 300 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":7}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_6"}]},{"name":"QUEST_MINE_CLARYN_6","type":"mine","text":"Mine 400 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":400},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":8}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_7"}]},{"name":"QUEST_MINE_CLARYN_7","type":"mine","text":"Mine 500 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":500},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":9}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_8"}]},{"name":"QUEST_MINE_CLARYN_8","type":"mine","text":"Mine 600 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":600},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":10}],"unlock":[{"type":"lab","name":"LAB_GEM_MINE_DIG_SPEED_5"},{"type":"quest","name":"QUEST_MINE_CLARYN_9"}]},{"name":"QUEST_MINE_CLARYN_9","type":"mine","text":"Mine 800 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":800},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":11}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_10"}]},{"name":"QUEST_MINE_CLARYN_10","type":"mine","text":"Mine 1000 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":1000},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":12}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_11"}]},{"name":"QUEST_MINE_CLARYN_11","type":"mine","text":"Mine 1200 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":1200},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":13}],"unlock":[{"type":"quest","name":"QUEST_MINE_CLARYN_12"}]},{"name":"QUEST_MINE_CLARYN_12","type":"mine","text":"Mine 1400 Claryn","image":"resource_claryn","mine":{"name":"CLARYN","amount":1400},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":14}],"unlock":[{"type":"lab","name":"LAB_GEM_MINE_DIG_SPEED_6"}]},{"@":"CARRY"},{"name":"QUEST_CARRY_1","type":"carry","text":"Carry 100 items","image":"gem_carry","carry":100,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":1}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_3"},{"type":"quest","name":"QUEST_CARRY_2"}]},{"name":"QUEST_CARRY_2","type":"carry","text":"Carry 200 items","image":"gem_carry","carry":200,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":2}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_6"},{"type":"quest","name":"QUEST_CARRY_3"}]},{"name":"QUEST_CARRY_3","type":"carry","text":"Carry 300 items","image":"gem_carry","carry":300,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":3}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_9"},{"type":"quest","name":"QUEST_CARRY_4"}]},{"name":"QUEST_CARRY_4","type":"carry","text":"Carry 400 items","image":"gem_carry","carry":400,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":4}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_12"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_CAPACITY_1"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_SPEED_1"},{"type":"lab","name":"LAB_GEM_MOVE_SPEED_1"},{"type":"quest","name":"QUEST_CARRY_5"}]},{"name":"QUEST_CARRY_5","type":"carry","text":"Carry 600 items","image":"gem_carry","carry":600,"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_15"},{"type":"quest","name":"QUEST_CARRY_6"}]},{"name":"QUEST_CARRY_6","type":"carry","text":"Carry 800 items","image":"gem_carry","carry":800,"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":6}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_18"},{"type":"quest","name":"QUEST_CARRY_7"}]},{"name":"QUEST_CARRY_7","type":"carry","text":"Carry 1000 items","image":"gem_carry","carry":1000,"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":7}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_21"},{"type":"quest","name":"QUEST_CARRY_8"}]},{"name":"QUEST_CARRY_8","type":"carry","text":"Carry 1200 items","image":"gem_carry","carry":1200,"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":8}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_24"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_CAPACITY_2"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_SPEED_2"},{"type":"lab","name":"LAB_GEM_MOVE_SPEED_2"},{"type":"quest","name":"QUEST_CARRY_9"}]},{"name":"QUEST_CARRY_9","type":"carry","text":"Carry 1500 items","image":"gem_carry","carry":1500,"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":9}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_27"},{"type":"quest","name":"QUEST_CARRY_10"}]},{"name":"QUEST_CARRY_10","type":"carry","text":"Carry 1800 items","image":"gem_carry","carry":1800,"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":10}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_30"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_AMOUNT_1"},{"type":"quest","name":"QUEST_CARRY_11"}]},{"name":"QUEST_CARRY_11","type":"carry","text":"Carry 2100 items","image":"gem_carry","carry":2100,"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":11}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_33"},{"type":"quest","name":"QUEST_CARRY_12"}]},{"name":"QUEST_CARRY_12","type":"carry","text":"Carry 2400 items","image":"gem_carry","carry":2400,"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":12}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_36"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_CAPACITY_3"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_SPEED_3"},{"type":"lab","name":"LAB_GEM_MOVE_SPEED_3"},{"type":"quest","name":"QUEST_CARRY_13"}]},{"name":"QUEST_CARRY_13","type":"carry","text":"Carry 2800 items","image":"gem_carry","carry":2800,"reward":[{"type":"item","name":"LUMYN","amount":4},{"type":"lab","amount":13}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_37"},{"type":"quest","name":"QUEST_CARRY_14"}]},{"name":"QUEST_CARRY_14","type":"carry","text":"Carry 3200 items","image":"gem_carry","carry":3200,"reward":[{"type":"item","name":"LUMYN","amount":4},{"type":"lab","amount":14}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_38"},{"type":"quest","name":"QUEST_CARRY_15"}]},{"name":"QUEST_CARRY_15","type":"carry","text":"Carry 3600 items","image":"gem_carry","carry":3600,"reward":[{"type":"item","name":"LUMYN","amount":4},{"type":"lab","amount":15}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_39"},{"type":"quest","name":"QUEST_CARRY_16"}]},{"name":"QUEST_CARRY_16","type":"carry","text":"Carry 4000 items","image":"gem_carry","carry":4000,"reward":[{"type":"item","name":"LUMYN","amount":4},{"type":"lab","amount":16}],"unlock":[{"type":"lab","name":"LAB_GEM_MAX_40"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_CAPACITY_4"},{"type":"lab","name":"LAB_GEM_CARRY_ITEM_SPEED_4"},{"type":"lab","name":"LAB_GEM_MOVE_SPEED_4"}]},{"@":"FORGE_VIRIDYN"},{"name":"QUEST_FORGE_VIRIDYN_1","type":"forge","text":"Forge 25 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":25},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_CRAFT_MK1_TUNNEL"},{"type":"quest","name":"QUEST_FORGE_VIRIDYN_2"}]},{"name":"QUEST_FORGE_VIRIDYN_2","type":"forge","text":"Forge 50 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":50},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":6}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_3"}]},{"name":"QUEST_FORGE_VIRIDYN_3","type":"forge","text":"Forge 75 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":75},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":7}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_4"}]},{"name":"QUEST_FORGE_VIRIDYN_4","type":"forge","text":"Forge 100 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":8}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_5"}]},{"name":"QUEST_FORGE_VIRIDYN_5","type":"forge","text":"Forge 150 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":150},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":9}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_6"}]},{"name":"QUEST_FORGE_VIRIDYN_6","type":"forge","text":"Forge 200 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":200},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":10}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_7"}]},{"name":"QUEST_FORGE_VIRIDYN_7","type":"forge","text":"Forge 250 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":250},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":11}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_8"}]},{"name":"QUEST_FORGE_VIRIDYN_8","type":"forge","text":"Forge 300 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":300},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":12}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_9"}]},{"name":"QUEST_FORGE_VIRIDYN_9","type":"forge","text":"Forge 400 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":400},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":13}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_10"}]},{"name":"QUEST_FORGE_VIRIDYN_10","type":"forge","text":"Forge 500 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":500},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":14}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_11"}]},{"name":"QUEST_FORGE_VIRIDYN_11","type":"forge","text":"Forge 600 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":600},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":15}],"unlock":[{"type":"quest","name":"QUEST_FORGE_VIRIDYN_12"}]},{"name":"QUEST_FORGE_VIRIDYN_12","type":"forge","text":"Forge 700 Viridyn","image":"resource_viridyn","forge":{"name":"VIRIDYN","amount":700},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":16}],"unlock":[]},{"@":"FORGE_FIRMYN"},{"name":"QUEST_FORGE_FIRMYN_1","type":"forge","text":"Forge 25 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":25},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_CRAFT_MK1_CARRY"},{"type":"quest","name":"QUEST_FORGE_FIRMYN_2"}]},{"name":"QUEST_FORGE_FIRMYN_2","type":"forge","text":"Forge 50 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":50},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":6}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_3"}]},{"name":"QUEST_FORGE_FIRMYN_3","type":"forge","text":"Forge 75 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":75},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":7}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_4"}]},{"name":"QUEST_FORGE_FIRMYN_4","type":"forge","text":"Forge 100 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":100},"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":8}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_5"}]},{"name":"QUEST_FORGE_FIRMYN_5","type":"forge","text":"Forge 150 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":150},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":9}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_6"}]},{"name":"QUEST_FORGE_FIRMYN_6","type":"forge","text":"Forge 200 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":200},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":10}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_7"}]},{"name":"QUEST_FORGE_FIRMYN_7","type":"forge","text":"Forge 250 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":250},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":11}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_8"}]},{"name":"QUEST_FORGE_FIRMYN_8","type":"forge","text":"Forge 300 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":300},"reward":[{"type":"item","name":"LUMYN","amount":2},{"type":"lab","amount":12}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_9"}]},{"name":"QUEST_FORGE_FIRMYN_9","type":"forge","text":"Forge 400 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":400},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":13}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_10"}]},{"name":"QUEST_FORGE_FIRMYN_10","type":"forge","text":"Forge 500 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":500},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":14}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_11"}]},{"name":"QUEST_FORGE_FIRMYN_11","type":"forge","text":"Forge 600 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":600},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":15}],"unlock":[{"type":"quest","name":"QUEST_FORGE_FIRMYN_12"}]},{"name":"QUEST_FORGE_FIRMYN_12","type":"forge","text":"Forge 700 Firmyn","image":"resource_firmyn","forge":{"name":"FIRMYN","amount":700},"reward":[{"type":"item","name":"LUMYN","amount":3},{"type":"lab","amount":16}],"unlock":[]},{"@":"GEMS"},{"name":"QUEST_GEMS_1","type":"gem","text":"Get 10 Gems","image":"lab_gem_count","gems":10,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_CRAFT_GEM_TUNNEL"},{"type":"quest","name":"QUEST_GEMS_2"}]},{"name":"QUEST_GEMS_2","type":"gem","text":"Get 15 Gems","image":"lab_gem_count","gems":15,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_CRAFT_GEM_LIFT"},{"type":"quest","name":"QUEST_GEMS_3"}]},{"name":"QUEST_GEMS_3","type":"gem","text":"Get 20 Gems","image":"lab_gem_count","gems":20,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_CRAFT_GEM_FLOOR"},{"type":"quest","name":"QUEST_GEMS_4"}]},{"name":"QUEST_GEMS_4","type":"gem","text":"Get 25 Gems","image":"lab_gem_count","gems":25,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_CRAFT_GEM_SHAFT"},{"type":"quest","name":"QUEST_GEMS_5"}]},{"name":"QUEST_GEMS_5","type":"gem","text":"Get 40 Gems","image":"lab_gem_count","gems":40,"reward":[{"type":"item","name":"LUMYN","amount":1},{"type":"lab","amount":5}],"unlock":[{"type":"lab","name":"LAB_CRAFT_MK1_MINE"},{"type":"quest","name":"QUEST_MINE_DAMSYN_1"},{"type":"quest","name":"QUEST_MINE_CLARYN_1"}]}]'),J=({questName:e})=>km.filter(a=>!a["@"]).find(a=>a.name===e)??g({message:`QuestData for ${e} not found`,where:J.name});var d=(e=>(e.AUDIO_PAUSE="AUDIO_PAUSE",e.AUDIO_PLAY="AUDIO_PLAY",e.AUDIO_STOP="AUDIO_STOP",e.CRAFT_REQUEST="CRAFT_REQUEST",e.ENGINE_PLAY="ENGINE_PLAY",e.GEM_CARRY_CANCEL="GEM_CARRY_CANCEL",e.GEM_CARRY_CONFIRM_START="GEM_CARRY_CONFIRM_START",e.GEM_CARRY_CONFIRM_TARGET="GEM_CARRY_CONFIRM_TARGET",e.GEM_DESTROY="GEM_DESTROY",e.GEM_EQUIP="GEM_EQUIP",e.GEM_FLOOR_CANCEL="GEM_FLOOR_CANCEL",e.GEM_LIFT_CANCEL="GEM_LIFT_CANCEL",e.GEM_MINE_CANCEL="GEM_MINE_CANCEL",e.GEM_MOVE_CANCEL="GEM_MOVE_CANCEL",e.GEM_MOVE_CONFIRM="GEM_MOVE_CONFIRM",e.GEM_SHAFT_CANCEL="GEM_SHAFT_CANCEL",e.GEM_TUNNEL_CANCEL="GEM_TUNNEL_CANCEL",e.LAB_RUN="LAB_RUN",e.QUEST_CARRY="QUEST_CARRY",e.QUEST_FORGE="QUEST_FORGE",e.QUEST_GEMS="QUEST_GEMS",e.QUEST_MINE="QUEST_MINE",e.TILE_SELECT="TILE_SELECT",e))(d||{});const Ze=({type:e,entityId:t,data:n})=>{e===M.GAME_LAUNCH?gu():e===M.GAME_LOADING_ERROR?g({message:"Error loading game",where:Ze.name}):e===M.GAME_LOADING_OFF?U({key:"gameLoad",value:!1}):e===M.GAME_LOADING_ON?U({key:"gameLoad",value:!0}):e===M.GAME_RUN?xa({saveData:n}):e==="ENGINE_PLAY"?(U({key:"gameLaunch",value:!1}),U({key:"gamePlay",value:!0}),r({target:"all",type:M.GAME_LOADING_OFF})):e==="AUDIO_PAUSE"&&n.audioName?hn({audioName:n.audioName}):e==="AUDIO_PLAY"&&n.audioName?Dt({audioName:n.audioName,list:n.list,loop:n.loop,volume:n.volume}):e==="AUDIO_STOP"&&n.audioName?Cn({audioName:n.audioName}):e==="CRAFT_REQUEST"&&n?em({itemName:n}):e===M.GEM_MOVE_REQUEST&&t?(U({key:"requestGemMove",value:!0}),U({key:"requestTile",value:!0}),ye({key:"requestId",value:t})):e==="GEM_MOVE_CONFIRM"&&t?(U({key:"requestGemMove",value:!1}),U({key:"requestTile",value:!1}),tn({key:"requestId"})):e==="GEM_MOVE_CANCEL"&&t?zn({gemId:t}):e===M.GEM_CARRY_REQUEST&&t?(U({key:"requestGemCarryStart",value:!0}),U({key:"requestTile",value:!0}),ye({key:"requestId",value:t})):e==="GEM_CARRY_CONFIRM_START"&&t?(U({key:"requestGemCarryStart",value:!1}),U({key:"requestGemCarryTarget",value:!0})):e==="GEM_CARRY_CONFIRM_TARGET"&&t?(U({key:"requestGemCarryTarget",value:!1}),U({key:"requestTile",value:!1}),tn({key:"requestId"})):e==="GEM_CARRY_CANCEL"&&t?Be({gemId:t}):e===M.GEM_FLOOR_REQUEST&&t?cm({gemId:t}):e==="GEM_FLOOR_CANCEL"&&t?Re({gemId:t}):e===M.GEM_LIFT_REQUEST&&t?gm({gemId:t}):e==="GEM_LIFT_CANCEL"&&t?me({gemId:t}):e===M.GEM_MINE_REQUEST&&t?Em({gemId:t}):e==="GEM_MINE_CANCEL"&&t?It({gemId:t}):e===M.GEM_SHAFT_REQUEST&&t?Tm({gemId:t}):e==="GEM_SHAFT_CANCEL"&&t?xe({gemId:t}):e===M.GEM_TUNNEL_REQUEST&&t?Nm({gemId:t}):e==="GEM_TUNNEL_CANCEL"&&t?qe({gemId:t}):e===M.GEM_STORE_DEPLOY&&t?ln({gemId:t,store:!1}):e===M.GEM_STORE&&t?ln({gemId:t,store:!0}):e==="GEM_DESTROY"&&t?Om({gemId:t}):e==="GEM_EQUIP"&&t?sm({gemId:t}):e==="LAB_RUN"&&n?Cm({name:n}):e==="QUEST_MINE"&&n.amount!==void 0&&n.name?vm({amount:n.amount,name:n.name}):e==="QUEST_CARRY"&&n.amount!==void 0?Pm({amount:n.amount}):e==="QUEST_GEMS"&&n.amount!==void 0?wm({amount:n.amount}):e==="QUEST_FORGE"&&n.amount!==void 0&&n.name?$m({amount:n.amount,name:n.name}):e==="TILE_SELECT"&&t?Un({selectedTileId:t}):g({message:`Unknown event type: ${e} ${t} ${n}`,where:Ze.name})},x=32,Ie=5;let j;const Fm=({tileMapId:e})=>{j=e,_({css:"tilemap enable",entityId:e,sprite:!0}),Zm(),Xm()},Qm=({tileMapId:e})=>{W({elId:e}),zm()},Bm=({tileId:e})=>{if(V({elId:e})){te({mode:"base",tileId:e});return}else{const n=b({click:()=>qm({tileId:e}),css:"tile enable",entityId:e,parent:j,sprite:!0}),a=l({componentId:"Position",entityId:e});n.style.top=`${a._y*x+Ie*x}px`,n.style.left=`${a._x*x}px`}},te=({tileId:e,mode:t,remove:n})=>{if(n){if(!e)return;c({elId:e}).classList.remove(t);return}if(t==="base"){if(e){const a=c({elId:e});a.classList.remove("request"),a.classList.remove("destroy")}else if(Ce({className:"tile",parent:j}).forEach(o=>{o.classList.contains("destroy")||o.classList.remove("request")}),Y({key:"requestGemMove"})||Y({key:"requestGemCarryStart"})||Y({key:"requestGemCarryTarget"})){const o=P({key:"requestId"});ee({gemId:o,mode:"disable",remove:!0})}}else if(t==="request"){if(Ce({className:"tile",parent:j}).forEach(o=>{o.classList.contains("destroy")||o.classList.add("request")}),Y({key:"requestGemMove"})||Y({key:"requestGemCarryStart"})||Y({key:"requestGemCarryTarget"})){const o=P({key:"requestId"});ee({gemId:o,mode:"disable"})}}else{if(!e)return;c({elId:e}).classList.add(t)}},qm=({tileId:e})=>{Y({key:"requestTile"})&&r({entityId:e,target:"engine",type:d.TILE_SELECT})},$e=5,ke=64;let Vt=0,Xt=0,je=0,Ve=0;const z={bottom:{elId:"ScrollBottom",isHovered:!1,isPressed:!1},left:{elId:"ScrollLeft",isHovered:!1,isPressed:!1},right:{elId:"ScrollRight",isHovered:!1,isPressed:!1},top:{elId:"ScrollTop",isHovered:!1,isPressed:!1}},jm=()=>{for(const[e,t]of Object.entries(z)){const n=_({css:`scroll-${e} btn enable`,id:t.elId,image:A({spriteName:`ui_scroll_${e}`}),parent:"UI",title:`Hold to scroll ${e}`});n.addEventListener("mouseenter",()=>{Fe(e,{isHovered:!0})}),n.addEventListener("mouseleave",()=>{Fe(e,{isHovered:!1,isPressed:!1})}),n.addEventListener("mousedown",()=>{Fe(e,{isPressed:!0})}),n.addEventListener("mouseup",()=>{Fe(e,{isPressed:!1})})}window.addEventListener("mousemove",e=>{const{clientX:t,clientY:n}=e,{innerWidth:a,innerHeight:o}=window,s=c({elId:z.left.elId});s.style.display=t<ke?"block":"none";const i=c({elId:z.right.elId});i.style.display=t>a-ke?"block":"none";const p=c({elId:z.top.elId});p.style.display=n<ke?"block":"none";const E=c({elId:z.bottom.elId});E.style.display=n>o-ke?"block":"none"})},Vm=()=>{const e=c({elId:j});let t=je,n=Ve;z.right.isPressed&&(t=Math.min(t+$e,Vt)),z.left.isPressed&&(t=Math.max(t-$e,0)),z.bottom.isPressed&&(n=Math.min(n+$e,Xt)),z.top.isPressed&&(n=Math.max(n-$e,0)),je=t,Ve=n,e.style.transform=`translate3d(${-je}px, ${-Ve}px, 0)`},Fe=(e,t)=>{z[e]={...z[e],...t}},Xm=()=>{const e=l({componentId:"TileMap",entityId:j}),{innerWidth:t,innerHeight:n}=window;Vt=Math.max(0,e._width*x-t),Xt=Math.max(0,e._height*x+(Ie+1)*x-n)},zm=()=>{Vt=0,Xt=0,je=0,Ve=0},zt=({elId:e,width:t,height:n,x:a,y:o,z:s=1})=>{const i=c({elId:e});i.style.width=`${t*x}px`,i.style.height=`${n*x}px`,i.style.left=`${a*x}px`,i.style.top=`${(o+(Ie+1-n))*x}px`,i.style.zIndex=`${s}`},Hm=({elId:e})=>{const t=c({elId:e}),n=l({componentId:"Position",entityId:e}),a=l({componentId:"Sprite",entityId:e});t.style.left=`${n._x*x}px`,t.style.top=`${(n._y+(Ie+1-a._height))*x}px`},Wm=3e3,Km=({buildName:e})=>{const t=T(),n=Se({buildName:e});if(n.type==="forge"){const a=e===D.BUILD_FORGE_VULKAN?t.builds.forges.vulkan:t.builds.forges.oryon;b({click:()=>Jm({buildName:e}),css:"build",id:`Build${e}-${a}`,image:A({spriteName:`build_${e.toLowerCase()}`}),parent:j}),zt({elId:`Build${e}-${a}`,height:n.height,width:n.width,x:n.x,y:0-(a-1),z:0})}},Jm=({buildName:e})=>{const t=T(),n=Se({buildName:e});if(!V({elId:"BuildInfo"})&&n.type==="forge"){const o=c({elId:`Build${e}-1`}),s=_({css:"build frame row align g-8 p-box",id:"BuildInfo",parent:"UI"});s.style.left=`${o.offsetLeft+x}px`,s.style.top=`${o.offsetTop-x}px`;for(const i of n.forge.inputs)_({absolute:!1,css:"row align g-4",id:`BuildInfoInput${i.name}`,parent:"BuildInfo"}),_({absolute:!1,css:"icon",id:`BuildInfoInputIcon${i.name}`,image:A({spriteName:`resource_${i.name.toLowerCase()}`}),parent:`BuildInfoInput${i.name}`}),_({absolute:!1,css:"t-10",id:`BuildInfoInputAmount${i.name}`,parent:`BuildInfoInput${i.name}`,text:`x${i.amount}`});_({absolute:!1,css:"row align g-4",id:"BuildInfoSpeed",parent:"BuildInfo"}),_({absolute:!1,css:"icon",id:"BuildInfoSpeedIcon",image:A({spriteName:"lab_run"}),parent:"BuildInfoSpeed"}),_({absolute:!1,css:"t-10",id:"BuildInfoSpeedAmount",parent:"BuildInfoSpeed",text:e===D.BUILD_FORGE_VULKAN?`${t.stats._forgeVulkanSpeed*100}s`:`${t.stats._forgeOryonSpeed*100}s`});for(const i of n.forge.outputs)_({absolute:!1,css:"row align g-4",id:`BuildInfoOutput${i.name}`,parent:"BuildInfo"}),_({absolute:!1,css:"icon",id:`BuildInfoOutputIcon${i.name}`,image:A({spriteName:`resource_${i.name.toLowerCase()}`}),parent:`BuildInfoOutput${i.name}`}),_({absolute:!1,css:"t-10",id:`BuildInfoOutputAmount${i.name}`,parent:`BuildInfoOutput${i.name}`,text:`x${i.amount}`});b({click:()=>W({elId:"BuildInfo"}),css:"close enable",id:"BuildInfoClose",image:A({spriteName:"ui_close"}),parent:"BuildInfo"})}},Zm=()=>{const e=Se({buildName:"ADMIN"});b({click:()=>rt({display:!0}),css:"admin",id:"AdminEntity",image:A({spriteName:"build_admin"}),parent:j,title:"Admin"}),zt({elId:"AdminEntity",height:e.height,width:e.width,x:e.x,y:0,z:0})},el=({name:e,amount:t})=>{const n=Se({buildName:"ADMIN"}),a=Date.now(),o=_({css:"toast row align",id:`AdminToast${e}${t}${a}`,parent:j});o.style.left=`${n.x*x+n.width}px`,o.style.top=`${(0+(Ie+1-n.height))*x-x/2}px`,_({absolute:!1,css:"t-8",id:`AdminToastAmount${e}${t}${a}`,parent:`AdminToast${e}${t}${a}`,text:`${t}`}),_({absolute:!1,css:"icon",id:`AdminToastIcon${e}${t}${a}`,image:A({spriteName:`resource_${e.toLowerCase()}`}),parent:`AdminToast${e}${t}${a}`}),setTimeout(()=>W({elId:`AdminToast${e}${t}${a}`}),Wm)},et=({mode:e})=>{const t=c({elId:"AdminEntity"});e==="base"?t.classList.remove("disable"):e==="disable"&&t.classList.add("disable")},tl=3e3,nl=({gemId:e})=>{const t=l({componentId:"Sprite",entityId:e}),n=l({componentId:"Position",entityId:e});b({click:()=>sl({gemId:e}),css:"gem",entityId:e,parent:j,sprite:!0}),zt({elId:e,height:t._height,width:t._width,x:n._x,y:n._y})},al=({gemId:e})=>{W({elId:e})},F=({gemId:e,mode:t,remove:n})=>{const a=G({gemId:e}),o=c({elId:e});if(t==="work"&&(a===m.CARRY||a===m.FLOOR||a===m.LIFT?t="carry":(a===m.MINE||a===m.SHAFT||a===m.TUNNEL)&&(t="mine")),n){o.classList.remove(t);return}t==="base"?(o.classList.remove("request"),o.classList.remove("hover"),o.classList.remove("disable"),o.classList.remove("mine"),o.classList.remove("carry")):o.classList.add(t)},ee=({gemId:e,mode:t,remove:n})=>{Ce({className:"gem",parent:j}).filter(o=>o.id!==e).forEach(o=>F({gemId:o.id,mode:t,remove:n}))},ol=({gemId:e,name:t,amount:n})=>{const a=l({componentId:"Position",entityId:e}),o=l({componentId:"Sprite",entityId:e}),s=Date.now(),i=_({css:"toast row align",id:`GemToast${e}${t}${n}${s}`,parent:j});i.style.left=`${a._x*x}px`,i.style.top=`${(a._y+(Ie+1-o._height))*x-x/2}px`,_({absolute:!1,css:"t-8",id:`GemToastAmount${e}${t}${n}${s}`,parent:`GemToast${e}${t}${n}${s}`,text:`${n}`}),_({absolute:!1,css:"icon",id:`GemToastIcon${e}${t}${n}${s}`,image:A({spriteName:`resource_${t.toLowerCase()}`}),parent:`GemToast${e}${t}${n}${s}`}),setTimeout(()=>W({elId:`GemToast${e}${t}${n}${s}`}),tl)},sl=({gemId:e})=>{F({gemId:e,mode:"request"}),K({display:!0,gemId:e})},rl=()=>{const e=il(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`terragem-save-${new Date().toISOString()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)},Nt=({saveFile:e})=>new Promise((t,n)=>{const a=new FileReader;a.onload=o=>{var s;try{const i=JSON.parse((s=o.target)==null?void 0:s.result);na(i),t()}catch(i){n(g({message:`Failed to parse save file: ${i.message}`,where:Nt.name}))}},a.onerror=()=>n(g({message:"Failed to import save file",where:Nt.name})),a.readAsText(e)}),il=()=>{const e={entities:{},store:{adminId:P({key:"adminId"}),tileMapId:P({key:"tileMapId"})},timestamp:Date.now(),version:he()},t=Object.keys(X).filter(a=>Qe({entityId:a})===Ct);for(const a of t)a!==P({key:"adminId"})&&delete X[a];const n=Object.keys(X).filter(a=>Qe({entityId:a})===Yt);for(const a of n)a!==P({key:"tileMapId"})&&delete X[a];return Object.entries(X).forEach(([a,o])=>{const s={};Object.entries(o).forEach(([i,p])=>{p!==void 0&&(s[i]=p)}),e.entities[a]={components:s,entityName:Qe({entityId:a})}}),e},na=e=>{if(e.version!==he())throw g({emit:!0,message:`Save version mismatch. Expected ${he()}, got ${e.version}`,where:na.name});Object.entries(e.entities).forEach(([t,n])=>{X[t]={},Object.entries(n.components).forEach(([a,o])=>{$({component:o,entityId:t}),at({componentId:a,entityId:t})})}),r({data:e,target:"all",type:M.GAME_RUN})},_l=()=>{Qt({adminId:P({key:"adminId"})}),Fn({tileMapName:"map1"}),ue({questName:"QUEST_MINE_STONE_1"}),ue({questName:"QUEST_MINE_GEOLYN_1"}),ue({questName:"QUEST_MINE_CERULYN_1"}),ue({questName:"QUEST_CARRY_1"}),ue({questName:"QUEST_GEMS_1"}),Je({deploy:!0,type:m.MINE,x:18,y:0}),Je({deploy:!0,type:m.CARRY,x:10,y:0}),r({data:{audioName:"main_start"},target:"engine",type:d.AUDIO_PLAY}),r({data:{audioName:"bgm_menu",list:!0},target:"engine",type:d.AUDIO_STOP}),r({data:{audioName:"bgm_game",list:!0},target:"engine",type:d.AUDIO_PLAY})},ml=({saveData:e})=>{Qt({adminId:e.store.adminId});const t=Al({saveData:e});Fn({saveTileMap:t,tileMapName:t._name}),r({target:"render",type:u.QUEST_CREATE}),Tl(),bl(),r({data:{audioName:"main_start"},target:"engine",type:d.AUDIO_PLAY}),r({data:{audioName:"bgm_menu",list:!0},target:"engine",type:d.AUDIO_STOP}),r({data:{audioName:"bgm_game",list:!0},target:"engine",type:d.AUDIO_PLAY})},ll="terragem",cl="0.5.19",ul="module",pl={build:"tsc && vite build",dev:"vite --force",preview:"vite preview",lint:"eslint . --ext .ts","lint-fix":"eslint . --ext .ts --fix",test:"vitest --passWithNoTests --watch"},dl=[],gl="Radalls",yl="ISC",El={uuid:"^11.0.5"},fl={"@eslint/config-array":"^0.19.1","@eslint/object-schema":"^2.1.5","@types/node":"^22.10.5","@types/uuid":"^10.0.0","@typescript-eslint/eslint-plugin":"^8.19.1","@typescript-eslint/parser":"^8.19.1",eslint:"^8.57.0","eslint-plugin-import":"^2.31.0","eslint-plugin-typescript-sort-keys":"^3.3.0","ts-node":"^10.9.2","ts-node-dev":"^2.0.0",typescript:"^5.7.3",vite:"^6.0.7",vitest:"^2.1.8"},Ml={name:ll,private:!0,version:cl,type:ul,scripts:pl,keywords:dl,author:gl,license:yl,dependencies:El,devDependencies:fl},he=()=>Ml.version,Al=({saveData:e})=>e.entities[e.store.tileMapId].components.TileMap,Tl=()=>{const e=T();for(const t of e.gems){const n=G({gemId:t});Je({gemId:t,type:n})}},bl=()=>{const e=T();for(let t=0;t<e.builds.forges.vulkan;t++)r({data:D.BUILD_FORGE_VULKAN,target:"render",type:u.BUILD_CREATE});for(let t=0;t<e.builds.forges.oryon;t++)r({data:D.BUILD_FORGE_ORYON,target:"render",type:u.BUILD_CREATE})},Sl=()=>{Gl(),xl(),Cl(),Il()},we=({display:e})=>{const t=c({elId:"Menus"});t.style.display=e?"flex":"none",U({key:"gamePause",value:e})},Il=()=>{_({css:"loading hidden full align",id:"Loading",parent:"Menus"}),_({absolute:!1,css:"loader w-10 h-10",id:"Loader",parent:"Loading"})},Nl=({display:e})=>{we({display:!0});const t=c({elId:"Loading"});t.style.display=e?"flex":"none"},Gl=()=>{_({css:"boot full hidden",id:"Boot",parent:"Menus"}),_({css:"title",id:"BootTitle",parent:"Boot",text:"TERRAGEM"}),b({click:()=>Ll(),css:"center w-15 p-box t-24",id:"BootLaunch",parent:"Boot",text:"Boot"}),_({css:"version",id:"BootVersion",parent:"Boot",text:`v${he()}`})},Ll=()=>{r({target:"all",type:M.GAME_LAUNCH}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},aa=({display:e})=>{we({display:e});const t=c({elId:"Boot"});t.style.display=e?"flex":"none"},xl=()=>{_({css:"launch col full align hidden g-32",id:"Launch",parent:"Menus"}),_({css:"title",id:"LaunchTitle",parent:"Launch",text:"TERRAGEM"}),b({absolute:!1,click:()=>Rl(),css:"align w-15 p-box t-24",id:"LaunchStart",parent:"Launch",text:"Start"}),oa(),b({absolute:!1,click:()=>Ol(),css:"align w-15 p-box t-24",id:"LaunchLoad",parent:"Launch",text:"Load"}),b({absolute:!1,click:()=>hl(),css:"align w-15 p-box t-24",id:"LaunchSettings",parent:"Launch",text:"Settings"}),_({css:"version",id:"LaunchVersion",parent:"Launch",text:`v${he()}`})},oa=()=>{const e=document.createElement("input");return e.type="file",e.id="SaveFileInput",e.accept=".json",e.style.display="none",e.addEventListener("change",async t=>{var o;const n=t.target,a=(o=n.files)==null?void 0:o[0];if(a)try{await Nt({saveFile:a})}catch(s){throw g({message:`Failed to import save file: ${s.message}`,where:oa.name})}n.value=""}),document.body.appendChild(e),e},Rl=()=>{r({target:"all",type:M.GAME_RUN})},Ol=()=>{const e=document.getElementById("SaveFileInput");e&&e.click(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},hl=()=>{r({data:{text:"Settings is WIP",type:"warning"},target:"render",type:u.INFO})},sa=({display:e})=>{we({display:e});const t=c({elId:"Launch"});t.style.display=e?"flex":"none",e&&r({data:{audioName:"bgm_menu",list:!0},target:"engine",type:d.AUDIO_PLAY})},Cl=()=>{_({css:"settings",id:"Settings",parent:"Menus"})};var ra=(e=>(e.STORAGE="AdminTabStorage",e.GEMS="AdminTabGems",e.WORKSHOP="AdminTabWorkshop",e.LAB="AdminTabLabs",e))(ra||{});const Yl=()=>{_({css:"admin row full center hidden g-32 p-32",id:"Admin",parent:"Menus"}),_({absolute:!1,css:"tabs frame col align w-15 g-12 p-8",id:"AdminTabs",parent:"Admin"}),_({absolute:!1,css:"frame col full p-32",id:"AdminContent",parent:"Admin"}),b({click:()=>rt({display:!1}),css:"close p-24",id:"AdminClose",image:A({spriteName:"menu_close"}),parent:"Admin",title:"Back"}),b({click:()=>Dl(),css:"home p-24",id:"AdminHome",image:A({spriteName:"menu_home"}),parent:"AdminTabs",title:"Home"}),b({click:()=>Ul(),css:"save p-24",id:"AdminSave",image:A({spriteName:"menu_save"}),parent:"AdminTabs",title:"Save"});for(const e of Object.values(ra))b({absolute:!1,click:()=>Gt({tab:e}),css:"tab full-w h-20",id:e,image:A({spriteName:`menu_${e.replace("AdminTab","").toLowerCase()}`}),parent:"AdminTabs",title:e.replace("AdminTab","")});vl(),wl(),lc(),gc()},Ne=({tab:e,page:t})=>{un({display:!1}),gn({display:!1}),En({display:!1}),Mn({display:!1}),e==="AdminTabStorage"?(ia(),un({display:!0})):e==="AdminTabGems"?(be(),gn({display:!0,page:t})):e==="AdminTabWorkshop"?(Lt(),En({display:!0,page:t})):e==="AdminTabLabs"&&(ca(),Mn({display:!0,page:t}))},Gt=({tab:e})=>{Ce({className:"tab",parent:"AdminTabs"}).forEach(n=>n.classList.remove("select")),e&&(c({elId:e}).classList.add("select"),Ne({tab:e}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}))},Ul=()=>{r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}),rl()},Dl=()=>{_({css:"home-confirm frame col w-25 p-box g-32",id:"HomeConfirm",parent:"app"}),_({absolute:!1,css:"mt-32",id:"HomeConfirmText",parent:"HomeConfirm",text:"Leave to menu ?"}),_({absolute:!1,css:"row between full-w p-box",id:"HomeConfirmActions",parent:"HomeConfirm"}),b({absolute:!1,click:()=>cn({home:!1}),id:"HomeConfirmNo",parent:"HomeConfirmActions",text:"No"}),b({absolute:!1,click:()=>cn({home:!0}),id:"HomeConfirmYes",parent:"HomeConfirmActions",text:"Yes"}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},cn=({home:e})=>{e?(r({data:{audioName:"main_start"},target:"engine",type:d.AUDIO_PLAY}),window.location.reload()):(W({elId:"HomeConfirm"}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}))},rt=({display:e})=>{we({display:e});const t=c({elId:"Admin"});t.style.display=e?"flex":"none",e?(Gt({tab:"AdminTabStorage"}),Gn({display:!1})):(Gt({}),Gn({display:!0}))},vl=()=>{_({absolute:!1,css:"storage row wrap g-12",id:"AdminStorage",parent:"AdminContent"})},Pl=({itemName:e,itemAmount:t})=>{_({absolute:!1,css:"item btn col align",id:`Item${e}`,parent:"AdminStorage"}),_({absolute:!1,css:"row align right full-w pr-8",id:`ItemAmount${e}`,parent:`Item${e}`,text:`x${t}`}),_({absolute:!1,css:"icon",id:`ItemIcon${e}`,image:A({spriteName:`resource_${e.toLowerCase()}`}),parent:`Item${e}`}),_({absolute:!1,css:"row align full-w t-12",id:`ItemLabel${e}`,parent:`Item${e}`,text:e.replace("_"," ")})},ia=()=>{const e=T();for(const t of e.items)if(V({elId:`Item${t._name}`})){const a=c({elId:`ItemAmount${t._name}`});a.innerText=`x${t._amount}`}else Pl({itemAmount:t._amount,itemName:t._name})},un=({display:e})=>{const t=c({elId:"AdminStorage"});t.style.display=e?"flex":"none"};var pe=(e=>(e.MINE="gem_mine",e.CARRY="gem_carry",e.TUNNEL="gem_tunnel",e.LIFT="gem_lift",e.FLOOR="gem_floor",e.SHAFT="gem_shaft",e))(pe||{});const _a={gem_mine:m.MINE,gem_carry:m.CARRY,gem_tunnel:m.TUNNEL,gem_lift:m.LIFT,gem_floor:m.FLOOR,gem_shaft:m.SHAFT};let B=0;const dt=4;let ie=0,it=!0,_t=!0;const wl=()=>{_({absolute:!1,css:"gems col full g-8",id:"AdminGems",parent:"AdminContent"}),_({absolute:!1,css:"col full g-8",id:"AdminGemsPage",parent:"AdminGems"}),$l()},$l=()=>{b({click:()=>ic(),css:"all p-4",id:"AdminGemsAll",image:A({spriteName:"ui_gem_placeholder"}),parent:"AdminGems",title:"Filter All"}),b({click:()=>mc(),css:"deploy p-4",id:"AdminGemsStore",image:A({spriteName:"ui_admin_placeholder"}),parent:"AdminGems",title:"Filter Store"}),b({click:()=>_c(),css:"type p-4",id:"AdminGemsType",image:A({spriteName:Object.values(pe)[ie]}),parent:"AdminGems",title:"Filter Type"}),_({absolute:!1,css:"row align g-12",id:"AdminGemsActions",parent:"AdminGems"}),b({absolute:!1,click:()=>dn({action:"previous"}),id:"AdminGemsPagePrevious",parent:"AdminGemsActions",text:"<"}),b({absolute:!1,click:()=>dn({action:"next"}),id:"AdminGemsPageNext",parent:"AdminGemsActions",text:">"}),_({css:"index",id:"AdminGemsPageIndex",parent:"AdminGemsActions",text:"0/0"})},Ht=({gemId:e})=>{const t=G({gemId:e}),n=l({componentId:"State",entityId:e}),a=l({componentId:"Sprite",entityId:e});if(_({absolute:!1,css:"btn row align h-25 p-box",id:`AdminGem${e}`,parent:"AdminGemsPage"}),_({absolute:!1,css:"sprite mr-32",id:`AdminGemSprite${e}`,image:a._image,parent:`AdminGem${e}`}),b({click:()=>rc({gemId:e}),css:"destroy",id:`AdminGemDestroy${e}`,image:A({spriteName:"menu_destroy"}),parent:`AdminGem${e}`,title:"Destroy"}),kl({gemAction:n._action,gemId:e,gemType:t}),t===m.CARRY)Fl({gemId:e});else if(t===m.FLOOR)Ql({gemId:e});else if(t===m.LIFT)Bl({gemId:e});else if(t===m.MINE)ql({gemId:e});else if(t===m.SHAFT)jl({gemId:e});else if(t===m.TUNNEL)Vl({gemId:e});else throw g({message:`Gem ${e} has no type`,where:Ht.name});Xl({gemId:e})},kl=({gemId:e,gemType:t,gemAction:n})=>{const a=L({gemId:e});_({absolute:!1,css:"col align full g-4",id:`AdminGemData${e}`,parent:`AdminGem${e}`}),_({absolute:!1,css:"row between full",id:`AdminGemInfo${e}`,parent:`AdminGemData${e}`}),_({absolute:!1,css:"row wrap full g-4",id:`AdminGemStats${e}`,parent:`AdminGemData${e}`}),_({absolute:!1,id:`AdminGemLabel${e}`,parent:`AdminGemInfo${e}`,text:a._name}),_({absolute:!1,id:`AdminGemType${e}`,parent:`AdminGemInfo${e}`,text:`Type: ${t}`}),_({absolute:!1,id:`AdminGemState${e}`,parent:`AdminGemInfo${e}`,text:`State: ${n}`}),_({absolute:!1,id:`AdminGemLvl${e}`,parent:`AdminGemInfo${e}`,text:`Lvl: ${a._xpLvl}`}),q(a)&&_({absolute:!1,css:"w-20 t-10 t-l",id:`ItemCapacity${e}`,parent:`AdminGemStats${e}`,text:`Item Capacity: ${f({gemId:e,gemType:t,stat:"_itemCapacity"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`MoveSpeed${e}`,parent:`AdminGemStats${e}`,text:`Move Speed: ${f({gemId:e,gemType:t,stat:"_moveSpeed"})}`})},Fl=({gemId:e})=>{_({absolute:!1,css:"w-20 t-10 t-l",id:`ItemSpeed${e}`,parent:`AdminGemStats${e}`,text:`Item Speed: ${f({gemId:e,gemType:m.CARRY,stat:"_itemSpeed"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`ItemAmount${e}`,parent:`AdminGemStats${e}`,text:`Item Amount: ${f({gemId:e,gemType:m.CARRY,stat:"_itemAmount"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`ItemRange${e}`,parent:`AdminGemStats${e}`,text:`Item Range: ${f({gemId:e,gemType:m.CARRY,stat:"_itemRange"})}`})},Ql=({gemId:e})=>{_({absolute:!1,css:"w-20 t-10 t-l",id:`FloorSpeed${e}`,parent:`AdminGemStats${e}`,text:`Floor Speed: ${f({gemId:e,gemType:m.FLOOR,stat:"_digSpeed"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`FloorStrength${e}`,parent:`AdminGemStats${e}`,text:`Floor Strength: ${f({gemId:e,gemType:m.FLOOR,stat:"_digStrength"})}`})},Bl=({gemId:e})=>{_({absolute:!1,css:"w-20 t-10 t-l",id:`ItemSpeed${e}`,parent:`AdminGemStats${e}`,text:`Item Speed: ${f({gemId:e,gemType:m.LIFT,stat:"_itemSpeed"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`ItemRange${e}`,parent:`AdminGemStats${e}`,text:`Item Range: ${f({gemId:e,gemType:m.LIFT,stat:"_itemRange"})}`})},ql=({gemId:e})=>{_({absolute:!1,css:"w-20 t-10 t-l",id:`MineSpeed${e}`,parent:`AdminGemStats${e}`,text:`Mine Speed: ${f({gemId:e,gemType:m.MINE,stat:"_digSpeed"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`MineStrength${e}`,parent:`AdminGemStats${e}`,text:`Mine Strength: ${f({gemId:e,gemType:m.MINE,stat:"_digStrength"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`MineAmount${e}`,parent:`AdminGemStats${e}`,text:`Mine Amount: ${f({gemId:e,gemType:m.MINE,stat:"_digAmount"})}`})},jl=({gemId:e})=>{_({absolute:!1,css:"w-20 t-10 t-l",id:`ShaftSpeed${e}`,parent:`AdminGemStats${e}`,text:`Shaft Speed: ${f({gemId:e,gemType:m.SHAFT,stat:"_digSpeed"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`ShaftStrength${e}`,parent:`AdminGemStats${e}`,text:`Shaft Strength: ${f({gemId:e,gemType:m.SHAFT,stat:"_digStrength"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`ShaftRange${e}`,parent:`AdminGemStats${e}`,text:`Shaft Range: ${f({gemId:e,gemType:m.SHAFT,stat:"_digRange"})}`})},Vl=({gemId:e})=>{_({absolute:!1,css:"w-20 t-10 t-l",id:`TunnelSpeed${e}`,parent:`AdminGemStats${e}`,text:`Tunnel Speed: ${f({gemId:e,gemType:m.TUNNEL,stat:"_digSpeed"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`TunnelStrength${e}`,parent:`AdminGemStats${e}`,text:`Tunnel Strength: ${f({gemId:e,gemType:m.TUNNEL,stat:"_digStrength"})}`}),_({absolute:!1,css:"w-20 t-10 t-l",id:`TunnelRange${e}`,parent:`AdminGemStats${e}`,text:`Tunnel Range: ${f({gemId:e,gemType:m.TUNNEL,stat:"_digRange"})}`})},Xl=({gemId:e})=>{_({absolute:!1,css:"col align w-15 g-4 ml-32",id:`AdminGemActions${e}`,parent:`AdminGem${e}`}),b({absolute:!1,click:()=>sc({gemId:e}),css:"hidden w-75 t-12",id:`AdminGemEquip${e}`,parent:`AdminGemActions${e}`,text:"Equip"}),b({absolute:!1,click:()=>ac({gemId:e}),css:"hidden w-75 t-12",id:`AdminGemView${e}`,parent:`AdminGemActions${e}`,text:"View"}),b({absolute:!1,click:()=>oc({gemId:e}),css:"w-75 t-12",id:`AdminGemDeploy${e}`,parent:`AdminGemActions${e}`,text:"Deploy"})},be=()=>{const e=T();for(const t of e.gems)V({elId:`AdminGem${t}`})?zl({gemId:t}):Ht({gemId:t});Wt()},Wt=()=>{const e=ma(),t=c({elId:"AdminGemsPageIndex"});t.innerText=`${B+1}/${e||1}`},zl=({gemId:e})=>{const t=G({gemId:e}),n=l({componentId:"State",entityId:e}),a=l({componentId:"Sprite",entityId:e}),o=c({elId:`AdminGemSprite${e}`});o.style.backgroundImage=`url("${a._image}")`;const s=c({elId:`AdminGemDestroy${e}`});if(s.style.display=n._store?"flex":"none",Hl({gemAction:n._action,gemId:e,gemType:t}),t===m.CARRY)Wl({gemId:e});else if(t===m.FLOOR)Kl({gemId:e});else if(t===m.LIFT)Jl({gemId:e});else if(t===m.MINE)Zl({gemId:e});else if(t===m.SHAFT)ec({gemId:e});else if(t===m.TUNNEL)tc({gemId:e});else throw g({message:`Gem ${e} has no type`,where:Ht.name});nc({gemId:e,gemStore:n._store})},Hl=({gemId:e,gemType:t,gemAction:n})=>{const a=L({gemId:e}),o=c({elId:`AdminGemState${e}`});o.innerText=`State: ${n}`;const s=c({elId:`AdminGemLvl${e}`});if(s.innerText=`Lvl: ${a._xpLvl}`,q(a)){const p=c({elId:`ItemCapacity${e}`});p.innerText=`Item Capacity: ${f({gemId:e,gemType:t,stat:"_itemCapacity"})}`}const i=c({elId:`MoveSpeed${e}`});i.innerText=`Move Speed: ${f({gemId:e,gemType:t,stat:"_moveSpeed"})}`},Wl=({gemId:e})=>{const t=c({elId:`ItemSpeed${e}`});t.innerText=`Item Speed: ${f({gemId:e,gemType:m.CARRY,stat:"_itemSpeed"})}`;const n=c({elId:`ItemAmount${e}`});n.innerText=`Item Amount: ${f({gemId:e,gemType:m.CARRY,stat:"_itemAmount"})}`;const a=c({elId:`ItemRange${e}`});a.innerText=`Item Range: ${f({gemId:e,gemType:m.CARRY,stat:"_itemRange"})}`},Kl=({gemId:e})=>{const t=c({elId:`FloorSpeed${e}`});t.innerText=`Floor Speed: ${f({gemId:e,gemType:m.FLOOR,stat:"_digSpeed"})}`;const n=c({elId:`FloorStrength${e}`});n.innerText=`Floor Strength: ${f({gemId:e,gemType:m.FLOOR,stat:"_digStrength"})}`},Jl=({gemId:e})=>{const t=c({elId:`ItemSpeed${e}`});t.innerText=`Item Speed: ${f({gemId:e,gemType:m.LIFT,stat:"_itemSpeed"})}`;const n=c({elId:`ItemRange${e}`});n.innerText=`Item Range: ${f({gemId:e,gemType:m.LIFT,stat:"_itemRange"})}`},Zl=({gemId:e})=>{const t=c({elId:`MineSpeed${e}`});t.innerText=`Mine Speed: ${f({gemId:e,gemType:m.MINE,stat:"_digSpeed"})}`;const n=c({elId:`MineStrength${e}`});n.innerText=`Mine Strength: ${f({gemId:e,gemType:m.MINE,stat:"_digStrength"})}`;const a=c({elId:`MineAmount${e}`});a.innerText=`Mine Amount: ${f({gemId:e,gemType:m.MINE,stat:"_digAmount"})}`},ec=({gemId:e})=>{const t=c({elId:`ShaftSpeed${e}`});t.innerText=`Shaft Speed: ${f({gemId:e,gemType:m.SHAFT,stat:"_digSpeed"})}`;const n=c({elId:`ShaftStrength${e}`});n.innerText=`Shaft Strength: ${f({gemId:e,gemType:m.SHAFT,stat:"_digStrength"})}`;const a=c({elId:`ShaftRange${e}`});a.innerText=`Shaft Range: ${f({gemId:e,gemType:m.SHAFT,stat:"_digRange"})}`},tc=({gemId:e})=>{const t=c({elId:`TunnelSpeed${e}`});t.innerText=`Tunnel Speed: ${f({gemId:e,gemType:m.TUNNEL,stat:"_digSpeed"})}`;const n=c({elId:`TunnelStrength${e}`});n.innerText=`Tunnel Strength: ${f({gemId:e,gemType:m.TUNNEL,stat:"_digStrength"})}`;const a=c({elId:`TunnelRange${e}`});a.innerText=`Tunnel Range: ${f({gemId:e,gemType:m.TUNNEL,stat:"_digRange"})}`},nc=({gemId:e,gemStore:t})=>{const n=T(),a=L({gemId:e}),o=c({elId:`AdminGemEquip${e}`});o.innerText=a._mech?"Unequip":"Equip",o.style.display=a._mech?"block":t?"none":n.mechs.length?"block":"none";const s=c({elId:`AdminGemView${e}`});s.style.display=t?"none":"block";const i=c({elId:`AdminGemDeploy${e}`});i.innerText=t?"Deploy":"Store"},ac=({gemId:e})=>{rt({display:!1}),we({display:!1}),K({display:!0,gemId:e})},oc=({gemId:e})=>{const t=G({gemId:e}),n=l({componentId:"State",entityId:e});r({entityId:e,target:"all",type:n._store?M.GEM_STORE_DEPLOY:M.GEM_STORE}),n._store&&(t===m.CARRY?r({entityId:e,target:"engine",type:d.GEM_CARRY_CANCEL}):t===m.FLOOR?r({entityId:e,target:"engine",type:d.GEM_FLOOR_CANCEL}):t===m.LIFT?r({entityId:e,target:"engine",type:d.GEM_LIFT_CANCEL}):t===m.MINE?r({entityId:e,target:"engine",type:d.GEM_MINE_CANCEL}):t===m.SHAFT?r({entityId:e,target:"engine",type:d.GEM_SHAFT_CANCEL}):t===m.TUNNEL&&r({entityId:e,target:"engine",type:d.GEM_TUNNEL_CANCEL})),Ne({page:B,tab:"AdminTabGems"}),r({data:{audioName:"main_action"},target:"engine",type:d.AUDIO_PLAY})},sc=({gemId:e})=>{r({entityId:e,target:"engine",type:d.GEM_EQUIP}),Ne({page:B,tab:"AdminTabGems"}),r({data:{audioName:"main_action"},target:"engine",type:d.AUDIO_PLAY})},rc=({gemId:e})=>{_({css:"destroy-confirm frame col w-33 p-box g-32",id:"DestroyConfirm",parent:"app"}),_({absolute:!1,css:"mt-32",id:"DestroyConfirmText",parent:"DestroyConfirm",text:`Destroy this gem ?
 You will get back resources used to craft it.`}),_({absolute:!1,css:"row between full-w p-box",id:"DestroyConfirmActions",parent:"DestroyConfirm"}),b({absolute:!1,click:()=>pn({destroy:!1,gemId:e}),id:"DestroyConfirmNo",parent:"DestroyConfirmActions",text:"No"}),b({absolute:!1,click:()=>pn({destroy:!0,gemId:e}),id:"DestroyConfirmYes",parent:"DestroyConfirmActions",text:"Yes"}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},pn=({gemId:e,destroy:t})=>{t&&(r({entityId:e,target:"engine",type:d.GEM_DESTROY}),W({elId:`AdminGem${e}`}),Ne({page:B,tab:"AdminTabGems"}),r({data:{audioName:"main_action"},target:"engine",type:d.AUDIO_PLAY})),W({elId:"DestroyConfirm"}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},dn=({action:e})=>{const t=T(),n=ma();t.gems.length&&(e==="previous"?B=Math.max(0,B-1):e==="next"&&(B=Math.min(B+1,n-1)),Wt(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}))},ma=()=>{const e=c({elId:"AdminGemsPage"}),t=Array.from(e.children),n=it?t:_t?t.filter(i=>{const p=i.id.replace("AdminGem","");return l({componentId:"State",entityId:p})._store}):t.filter(i=>{const p=i.id.replace("AdminGem",""),E=Object.values(pe)[ie];return G({gemId:p})===_a[E]});t.forEach(i=>i.style.display="none");const a=B*dt,o=a+dt;return n.slice(a,o).forEach(i=>i.style.display="flex"),Math.ceil(n.length/dt)},ic=()=>{it=!0,_t=!1,B=0,be(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},_c=()=>{const e=Object.values(pe).length;it=!1,_t=!1,B=0,ie=(ie+1)%e;const t=_a[Object.values(pe)[ie]];ea({gemType:t})||(ie=0);const n=c({elId:"AdminGemsType"});n.style.backgroundImage=`url("${A({spriteName:Object.values(pe)[ie]})}")`,be(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},mc=()=>{it=!1,_t=!0,B=0,be(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},gn=({display:e,page:t})=>{const n=c({elId:"AdminGems"});n.style.display=e?"flex":"none",e&&(B=t??0,Wt())};let ne=0;const Xe=4,lc=()=>{const e=T();_({absolute:!1,css:"workshop col full g-8",id:"AdminWorkshop",parent:"AdminContent"}),_({absolute:!1,css:"col full g-8",id:"WorkshopPage",parent:"AdminWorkshop"}),_({css:"count btn row align p-4 g-4",id:"WorkshopGemCount",parent:"AdminWorkshop"}),_({absolute:!1,css:"icon",id:"WorkshopGemCountIcon",image:A({spriteName:"lab_gem_count"}),parent:"WorkshopGemCount"}),_({absolute:!1,id:"WorkshopGemCountValue",parent:"WorkshopGemCount",text:`${e.gems.length}/${e.stats._gemMax}`}),cc()},cc=()=>{_({absolute:!1,css:"row align g-12",id:"WorkshopActions",parent:"AdminWorkshop"}),b({absolute:!1,click:()=>yn({action:"previous"}),id:"WorkshopPagePrevious",parent:"WorkshopActions",text:"<"}),b({absolute:!1,click:()=>yn({action:"next"}),id:"WorkshopPageNext",parent:"WorkshopActions",text:">"}),_({css:"index",id:"WorkshopPageIndex",parent:"WorkshopActions",text:"0/0"})},uc=({craft:e})=>{const t=T(),n=De({itemName:e});_({absolute:!1,css:"craft btn row align h-25 p-box",id:`Craft${e}`,parent:"WorkshopPage"}),_({absolute:!1,css:"sprite mr-16",id:`CraftSprite${e}`,image:A({spriteName:n.image}),parent:`Craft${e}`}),_({absolute:!1,css:"w-20 mr-16 t-20",id:`CraftName${e}`,parent:`Craft${e}`,text:n.name.split("_").join(" ")}),_({absolute:!1,css:"col between full g-12",id:`CraftData${e}`,parent:`Craft${e}`}),_({absolute:!1,css:"t-10",id:`CraftText${e}`,parent:`CraftData${e}`,text:n.text}),_({absolute:!1,css:"row g-16",id:`CraftComponents${e}`,parent:`CraftData${e}`});for(const a of n.components){const o=t.items.find(s=>s._name===a.name);_({absolute:!1,css:"row align",id:`CraftComp${e}${a.name}`,parent:`CraftComponents${e}`}),_({absolute:!1,css:"icon",id:`CraftCompIcon${e}${a.name}`,image:A({spriteName:`resource_${a.name.toLowerCase()}`}),parent:`CraftComp${e}${a.name}`}),_({absolute:!1,id:`CraftCompAmount${e}${a.name}`,parent:`CraftComp${e}${a.name}`,text:`x${a.amount}`+(o?` (${o._amount})`:"")})}b({absolute:!1,click:()=>dc({craft:e}),css:"w-10 p-4 ml-32",id:`CraftRun${e}`,parent:`Craft${e}`,text:"Craft"}),_({css:"count btn row align p-4 g-4",id:`CraftCount${e}`,parent:`Craft${e}`}),_({absolute:!1,css:"icon",id:`CraftCountIcon${e}`,image:Ae({itemName:e})?A({spriteName:`gem_${e.toLowerCase().replace("gem_","")}`}):jn({itemName:e})?A({spriteName:`mech_${e.toLowerCase()}`}):A({spriteName:`build_${e.toLowerCase()}`}),parent:`CraftCount${e}`}),_({absolute:!1,id:`CraftCountValue${e}`,parent:`CraftCount${e}`,text:Ae({itemName:e})?`${se({gemType:st({itemName:e})})??0}`:`${Vn({itemName:e})??0}`})},Lt=()=>{const e=T(),t=c({elId:"WorkshopGemCountValue"});t.innerText=`${e.gems.length}/${e.stats._gemMax}`;for(const n of e.crafts)V({elId:`Craft${n}`})?pc({craft:n}):uc({craft:n})},pc=({craft:e})=>{const t=T(),n=De({itemName:e});if(V({elId:`CraftCount${e}`})){const o=c({elId:`CraftCountValue${e}`});o.innerText=Ae({itemName:e})?`${se({gemType:st({itemName:e})})??0}`:`${Vn({itemName:e})??0}`}for(const o of n.components){const s=t.items.find(p=>p._name===o.name),i=c({elId:`CraftCompAmount${e}${o.name}`});i.innerText=`x${o.amount}`+(s?` (${s._amount})`:"")}},la=()=>{const e=T(),t=Math.ceil(e.crafts.length/Xe),n=c({elId:"WorkshopPage"}),a=c({elId:"WorkshopPageIndex"});if(a.innerText=`${ne+1}/${t||1}`,!e.crafts.length)return;for(let i=0;i<n.children.length;i++){const p=n.children[i];p.style.display="none"}const o=ne*Xe,s=o+Xe;for(let i=o;i<s&&!(i>=e.crafts.length);i++){const p=n.children[i];p.style.display="flex"}},yn=({action:e})=>{const t=T(),n=Math.ceil(t.crafts.length/Xe);t.crafts.length&&(e==="previous"?ne=Math.max(0,ne-1):e==="next"&&(ne=Math.min(ne+1,n-1)),la(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}))},dc=({craft:e})=>{r({data:e,target:"engine",type:d.CRAFT_REQUEST}),Ne({page:ne,tab:"AdminTabWorkshop"}),r({data:{audioName:"main_action"},target:"engine",type:d.AUDIO_PLAY})},En=({display:e,page:t})=>{const n=c({elId:"AdminWorkshop"});n.style.display=e?"flex":"none",e&&(ne=t??0,la())};let Z=0,Oe=!0;const gt=5,gc=()=>{_({absolute:!1,css:"labs col full g-8",id:"AdminLabs",parent:"AdminContent"}),yc(),_({absolute:!1,css:"col full g-8",id:"LabPage",parent:"AdminLabs"}),Ec()},yc=()=>{const e=T();_({absolute:!1,css:"row g-32 mb-32 t-20",id:"LabStats",parent:"AdminLabs"}),_({absolute:!1,css:"row align g-4",id:"LabPoints",parent:"LabStats",title:"Lab Points"}),_({absolute:!1,css:"icon",id:"LabPointsIcon",image:A({spriteName:"lab_points"}),parent:"LabPoints"}),_({absolute:!1,id:"LabPointsValue",parent:"LabPoints",text:`x${e.stats._labPoints}`}),_({absolute:!1,css:"row align g-4",id:"GemMax",parent:"LabStats",title:"Max Gem"}),_({absolute:!1,css:"icon",id:"GemMaxIcon",image:A({spriteName:"lab_gem_count"}),parent:"GemMax"}),_({absolute:!1,id:"GemMaxValue",parent:"GemMax",text:`${e.gems.length}/${e.stats._gemMax}`}),_({absolute:!1,css:"row align g-4",id:"VulkanSpeed",parent:"LabStats",title:"Forge Vulkan Speed"}),_({absolute:!1,css:"icon",id:"VulkanSpeedIcon",image:A({spriteName:"lab_forge_vulkan_speed"}),parent:"VulkanSpeed"}),_({absolute:!1,id:"VulkanSpeedValue",parent:"VulkanSpeed",text:`${e.stats._forgeVulkanSpeed*60}/min`}),_({absolute:!1,css:"row align g-4",id:"OryonSpeed",parent:"LabStats",title:"Forge Oryon Speed"}),_({absolute:!1,css:"icon",id:"OryonSpeedIcon",image:A({spriteName:"lab_forge_oryon_speed"}),parent:"OryonSpeed"}),_({absolute:!1,id:"OryonSpeedValue",parent:"OryonSpeed",text:`${e.stats._forgeOryonSpeed*60}/min`})},Ec=()=>{_({absolute:!1,css:"row align g-12",id:"LabActions",parent:"AdminLabs"}),b({click:()=>Ac(),css:"done t-10 p-box",id:"LabDisplayDone",parent:"LabActions",text:Oe?"Hide Done":"Show All"}),b({absolute:!1,click:()=>fn({action:"previous"}),id:"LabPagePrevious",parent:"LabActions",text:"<"}),b({absolute:!1,click:()=>fn({action:"next"}),id:"LabPageNext",parent:"LabActions",text:">"}),_({css:"index",id:"LabPageIndex",parent:"LabActions",text:"0/0"})},fc=({labName:e,labText:t,labImage:n,labCost:a,labProgress:o,labTime:s})=>{_({absolute:!1,css:"lab btn row between h-20 p-box",id:`Lab${e}`,parent:"LabPage"}),Ut({css:"lab-progress",id:`Lab${e}`,parent:`Lab${e}`,value:o/s*100}),_({absolute:!1,css:"sprite",id:`LabSprite${e}`,image:A({spriteName:n}),parent:`Lab${e}`}),_({absolute:!1,css:"t-18",id:`LabText${e}`,parent:`Lab${e}`,text:t}),_({absolute:!1,css:"row align g-4",id:`LabCost${e}`,parent:`Lab${e}`}),_({absolute:!1,css:"icon",id:`LabCostIcon${e}`,image:A({spriteName:"lab_points"}),parent:`LabCost${e}`}),_({absolute:!1,id:`LabCostValue${e}`,parent:`LabCost${e}`,text:`x${a}`}),_({absolute:!1,css:"row align g-4",id:`LabRun${e}`,parent:`Lab${e}`}),_({absolute:!1,css:"icon",id:`LabRunIcon${e}`,image:A({spriteName:"lab_run"}),parent:`LabRun${e}`}),_({absolute:!1,id:`LabRunValue${e}`,parent:`LabRun${e}`,text:`${o}/${s}`}),_({absolute:!1,css:"t-16 hidden",id:`LabDone${e}`,parent:`Lab${e}`,text:"Done !"}),b({absolute:!1,click:()=>Tc({labName:e}),id:`LabStart${e}`,parent:`Lab${e}`,text:"Start"})},ca=()=>{const e=T();Mc();for(const t of e.labs)if(V({elId:`Lab${t._name}`}))xt({labName:t._name});else{const a=le({name:t._name});fc({labCost:a.cost,labImage:a.image,labName:t._name,labProgress:t._progress,labText:a.text,labTime:a.time}),xt({labName:t._name})}},Mc=()=>{const e=T(),t=c({elId:"LabPointsValue"});t.innerText=`x${e.stats._labPoints}`;const n=c({elId:"GemMaxValue"});n.innerText=`${e.gems.length}/${e.stats._gemMax}`;const a=c({elId:"VulkanSpeed"});if(mn({buildName:D.BUILD_FORGE_VULKAN})){a.style.display="flex";const s=c({elId:"VulkanSpeedValue"});s.innerText=`${e.stats._forgeVulkanSpeed*60}/min`}else a.style.display="none";const o=c({elId:"OryonSpeed"});if(mn({buildName:D.BUILD_FORGE_ORYON})){o.style.display="flex";const s=c({elId:"OryonSpeedValue"});s.innerText=`${e.stats._forgeOryonSpeed*60}/min`}else o.style.display="none"},Kt=()=>{const e=ua(),t=c({elId:"LabPageIndex"});t.innerText=`${Z+1}/${e||1}`},xt=({labName:e})=>{const n=T().labs.find(o=>o._name===e)??g({message:`Lab ${e} not found`,where:xt.name}),a=le({name:n._name});if(n._done){c({elId:`Lab${n._name}`}).classList.add("done");const s=c({elId:`LabDone${n._name}`});s.style.display="block";const i=c({elId:`LabCost${n._name}`});i.style.display="none";const p=c({elId:`LabRun${n._name}`});p.style.display="none";const E=c({elId:`LabStart${n._name}`});E.style.display="none",We({elId:`Lab${e}`,value:n._progress/a.time*100})}else if(n._run){const o=c({elId:`LabDone${n._name}`});o.style.display="none";const s=c({elId:`LabCost${n._name}`});s.style.display="none";const i=c({elId:`LabRunValue${n._name}`});i.innerText=`${n._progress}/${a.time}`;const p=c({elId:`LabStart${n._name}`});p.style.display="none",We({elId:`Lab${e}`,value:n._progress/a.time*100})}},fn=({action:e})=>{const t=T(),n=ua();t.labs.length&&(e==="previous"?Z=Math.max(0,Z-1):e==="next"&&(Z=Math.min(Z+1,n-1)),Kt(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}))},Ac=()=>{const e=c({elId:"LabDisplayDone"});Oe=!Oe,Z=0,e.innerText=Oe?"Hide Done":"Show All",Kt(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},Tc=({labName:e})=>{Ne({page:Z,tab:"AdminTabLabs"}),r({data:e,target:"engine",type:d.LAB_RUN}),r({data:{audioName:"main_action"},target:"engine",type:d.AUDIO_PLAY})},ua=()=>{const e=T(),t=c({elId:"LabPage"}),n=Array.from(t.children),a=n.map(E=>({data:e.labs.find(N=>{const h=`Lab${N._name}`;return E.id===h}),element:E})).filter(E=>E.data),o=Oe?a:a.filter(E=>{var y;return!((y=E.data)!=null&&y._done)});n.forEach(E=>E.style.display="none");const s=Z*gt,i=s+gt;return o.slice(s,i).forEach(E=>E.element.style.display="flex"),Math.ceil(o.length/gt)},Mn=({display:e,page:t})=>{const n=c({elId:"AdminLabs"});n.style.display=e?"flex":"none",e&&(Z=t??0,Kt())},bc=()=>{Oc(),Yc(),qc(),Jc(),Zc()},An=({mode:e})=>{const t=c({elId:"UI"});e==="base"?t.classList.remove("request"):e==="request"&&t.classList.add("request")},Sc=3e3,Ic=3e3,Nc=5e3,Tn=5e3,Gc=5,Lc="#85879B",xc="#F3A72D",Rc="#D02929",bn="#30CB48;",Oc=()=>{_({css:"alerts col align disable full-w g-4 p-box",id:"Alerts",parent:"app"})},hc=({text:e,type:t,alert:n})=>{const a=_({absolute:!1,css:"alert btn t-18 p-box",id:"Alert",parent:"Alerts",text:n?` ${e} `:e});if(t==="confirm")a.style.backgroundColor=Lc,r({data:{audioName:"main_confirm"},target:"engine",type:d.AUDIO_PLAY});else if(t==="success")a.style.backgroundColor=bn,r({data:{audioName:"main_success"},target:"engine",type:d.AUDIO_PLAY});else if(t==="warning")a.style.backgroundColor=xc,r({data:{audioName:"main_warning"},target:"engine",type:d.AUDIO_PLAY});else if(t==="error")a.style.backgroundColor=Rc,r({data:{audioName:"main_error"},target:"engine",type:d.AUDIO_PLAY});else if(t==="quest"){const o=J({questName:e}),s=o.reward.map(i=>i.type==="item"?`${i.name} x${i.amount}`:`LabPoint x${i.amount}`).join(", ");a.style.backgroundColor=bn,a.innerText=`${o.text} complete ! (${s})`,r({data:{audioName:"main_success"},target:"engine",type:d.AUDIO_PLAY})}},Sn=()=>{const e=c({elId:"Alerts"});e.children.length&&e.removeChild(e.children[0])},Cc=({text:e,type:t,alert:n})=>{c({elId:"Alerts"}).children.length>=Gc&&Sn(),hc({alert:n,text:e,type:t});let o=0;t==="confirm"?o=Sc:t==="success"?o=Tn:t==="warning"?o=Ic:t==="error"?o=Nc:t==="quest"&&(o=Tn),setTimeout(()=>Sn(),o)};let I=null;const Yc=()=>{_({css:"gem-view frame col left hidden enable w-25 g-16 p-16",id:"GemView",parent:"UI"}),Bc()},Uc=()=>{if(!I)return;const e=I,t=L({gemId:e}),n=G({gemId:e}),a=l({componentId:"State",entityId:e}),o=l({componentId:"Sprite",entityId:e});_({absolute:!1,css:"col g-8",id:"GemData",parent:"GemView"}),_({absolute:!1,css:"row left g-16 t-l",id:"GemInfo1",parent:"GemData"}),_({absolute:!1,css:"row left g-16 t-l",id:"GemInfo2",parent:"GemData"}),_({absolute:!1,css:"sprite",id:"GemSprite",image:o._image,parent:"GemInfo1"}),_({absolute:!1,css:"hidden",id:"GemId",parent:"GemData",text:e}),_({absolute:!1,id:"GemName",parent:"GemInfo1",text:t._name}),_({absolute:!1,id:"GemType",parent:"GemInfo1",text:`Type: ${n}`}),_({absolute:!1,id:"GemState",parent:"GemInfo2",text:`State: ${a._action}`}),_({absolute:!1,id:"GemLevel",parent:"GemInfo2",text:`Lvl: ${t._xpLvl}`}),q(t)&&Dc()},Dc=()=>{if(!I)return;const t=L({gemId:I});q(t)&&(_({absolute:!1,css:"row left g-8 h-15 t-l",id:"GemItems",parent:"GemData",text:"Items: "}),da())},vc=()=>{if(!I)return;const e=I,t=G({gemId:e}),n=l({componentId:"State",entityId:e}),a=n._action==="move",o=n._action==="work";_({absolute:!1,css:"row align full g-16",id:"GemActions",parent:"GemView"}),b({absolute:!1,click:()=>$c(),id:"GemStore",parent:"GemActions",text:"Store"}),b({absolute:!1,click:()=>kc(),id:"GemMove",parent:"GemActions",text:a?"Cancel":"Move"}),b({absolute:!1,click:()=>Fc(),id:`Gem${t}`,parent:"GemActions",text:o?"Cancel":t})},Pc=()=>{if(!I)return;const e=I;wc(),b({click:()=>K({display:!1,gemId:e}),css:"close p-4",id:"GemClose",image:A({spriteName:"ui_close"}),parent:"GemView"}),Uc(),vc()},pa=({gemId:e})=>{if(e||(e=I??g({message:"No gemId provided",where:pa.name})),!V({elId:"GemId"})||c({elId:"GemId"}).innerText!==e)return;const a=L({gemId:e}),o=l({componentId:"State",entityId:e}),s=l({componentId:"Sprite",entityId:e}),i=c({elId:"GemName"});i.innerText=a._name;const p=c({elId:"GemState"});p.innerText=`State: ${o._action}`;const E=c({elId:"GemSprite"});E.style.backgroundImage=`url("${s._image}")`;const y=c({elId:"GemLevel"});y.innerText=`Lvl: ${a._xpLvl}`,q(a)&&da()},da=()=>{if(!I)return;const t=L({gemId:I});if(!q(t))return;const n=c({elId:"GemItems"});n.innerHTML="",n.innerText="Items: ";for(const a of t.items)_({absolute:!1,css:"item row align p-4",id:`GemItem${a._name}`,parent:"GemItems"}),_({absolute:!1,css:"icon",id:`GemItemIcon${a._name}`,image:A({spriteName:`resource_${a._name.toLowerCase()}`}),parent:`GemItem${a._name}`}),_({absolute:!1,css:"t-12",id:`GemItemAmount${a._name}`,parent:`GemItem${a._name}`,text:`x${a._amount}`})},ze=()=>{if(!I)return;const e=I;if(!V({elId:"GemId"})||c({elId:"GemId"}).innerText!==e)return;const a=G({gemId:e}),o=l({componentId:"State",entityId:e}),s=o._action==="move",i=o._action==="work",p=c({elId:"GemMove"});p.innerText=s?"Cancel":"Move";const E=c({elId:`Gem${a}`});E.innerText=i?"Cancel":a},wc=()=>{const e=c({elId:"GemView"});e.innerHTML=""},$c=()=>{if(!I)return;const e=I,t=L({gemId:e}),n=l({componentId:"State",entityId:e});n._action==="idle"?(K({display:!1,gemId:e}),r({entityId:e,target:"all",type:M.GEM_STORE}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})):n._action==="move"?r({data:{text:`${t._name} is already moving`,type:"warning"},entityId:e,target:"render",type:u.INFO}):n._action==="work"&&r({data:{text:`${t._name} is already working`,type:"warning"},entityId:e,target:"render",type:u.INFO})},kc=()=>{if(!I)return;const e=I,t=l({componentId:"State",entityId:e});t._action==="idle"?(K({display:!1,gemId:e}),r({entityId:e,target:"all",type:M.GEM_MOVE_REQUEST}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})):t._action==="move"?(Rt(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}),ze()):t._action==="work"&&(Rt(),K({display:!1,gemId:e}),r({entityId:e,target:"all",type:M.GEM_MOVE_REQUEST}),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}))},Fc=()=>{if(!I)return;const e=I,t=L({gemId:e}),n=l({componentId:"State",entityId:e});n._action==="idle"?(ze(),Qc(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})):n._action==="move"?(ze(),r({data:{text:`${t._name} is already moving`,type:"warning"},entityId:e,target:"render",type:u.INFO})):n._action==="work"&&(Rt(),ze())},Qc=()=>{if(!I)return;const e=I,t=G({gemId:e});K({display:!1,gemId:e}),t===m.CARRY?r({entityId:e,target:"all",type:M.GEM_CARRY_REQUEST}):t===m.FLOOR?r({entityId:e,target:"all",type:M.GEM_FLOOR_REQUEST}):t===m.LIFT?r({entityId:e,target:"all",type:M.GEM_LIFT_REQUEST}):t===m.MINE?r({entityId:e,target:"all",type:M.GEM_MINE_REQUEST}):t===m.SHAFT?r({entityId:e,target:"all",type:M.GEM_SHAFT_REQUEST}):t===m.TUNNEL&&r({entityId:e,target:"all",type:M.GEM_TUNNEL_REQUEST})},Rt=()=>{if(!I)return;const e=I,t=G({gemId:e});l({componentId:"State",entityId:e})._action==="move"&&r({entityId:e,target:"engine",type:d.GEM_MOVE_CANCEL}),t===m.CARRY?(tt({display:!1}),r({entityId:e,target:"engine",type:d.GEM_CARRY_CANCEL})):t===m.FLOOR?r({entityId:e,target:"engine",type:d.GEM_FLOOR_CANCEL}):t===m.LIFT?(tt({display:!1}),r({entityId:e,target:"engine",type:d.GEM_LIFT_CANCEL})):t===m.MINE?r({entityId:e,target:"engine",type:d.GEM_MINE_CANCEL}):t===m.SHAFT?r({entityId:e,target:"engine",type:d.GEM_SHAFT_CANCEL}):t===m.TUNNEL&&r({entityId:e,target:"engine",type:d.GEM_TUNNEL_CANCEL})},Bc=()=>{document.addEventListener("click",e=>{if(!V({elId:"GemView"})||!I)return;const t=c({elId:"GemView"}),n=e.target;n.id.includes("Gem")||t&&!t.contains(n)&&t.style.display==="flex"&&K({display:!1,gemId:I})})},tt=({display:e})=>{if(!I)return;const t=I,n=G({gemId:t});if(n===m.CARRY||n===m.LIFT){const a=l({componentId:n,entityId:t});if(l({componentId:"State",entityId:t})._action==="work"&&a._moveStartX!==void 0&&a._moveStartY!==void 0&&a._moveTargetX!==void 0&&a._moveTargetY!==void 0){const{tileId:s}=S({x:a._moveStartX,y:a._moveStartY});te({mode:"path",remove:!e,tileId:s});const{tileId:i}=S({x:a._moveTargetX,y:a._moveTargetY});te({mode:"path",remove:!e,tileId:i})}}},In=({display:e})=>{if(!I)return;const t=I,n=G({gemId:t});if(n===m.LIFT){const a=l({componentId:"Lift",entityId:t});if(l({componentId:"State",entityId:t})._action==="work"&&a._moveStartX!==void 0&&a._moveStartY!==void 0&&a._moveTargetX!==void 0&&a._moveTargetY!==void 0){const s=[],{tile:i}=S({x:a._moveStartX,y:a._moveStartY});s.push(...i.carry);const{tile:p}=S({x:a._moveTargetX,y:a._moveTargetY});s.push(...p.carry);for(const E of s)F({gemId:E,mode:"request",remove:!e})}}else if(n===m.MINE){const a=T(),o=l({componentId:"Position",entityId:t});if(l({componentId:"State",entityId:t})._action==="work"){const i=Math.round(a.stats._gemCarryItemRange*2),p=[];let E=0;for(;p.length===0&&!(E>i);){const{tile:y}=S({x:o._x,y:o._y-E});y.carry.length&&p.push(...y.carry),E++}for(const y of p)F({gemId:y,mode:"request",remove:!e})}}},K=({gemId:e,display:t})=>{const n=c({elId:"GemView"});if(n.style.display=t?"flex":"none",t){if(!e)return;I=e,Pc(),F({gemId:e,mode:"request"}),F({gemId:e,mode:"disable",remove:!0}),F({gemId:e,mode:"hover",remove:!0}),ee({gemId:e,mode:"disable"}),ee({gemId:e,mode:"request",remove:!0}),ee({gemId:e,mode:"hover",remove:!0}),et({mode:"disable"}),tt({display:!0}),In({display:!0})}else{if(!e&&I&&(e=I),!e)return;F({gemId:e,mode:"request",remove:!0}),F({gemId:e,mode:"hover",remove:!0}),F({gemId:e,mode:"disable",remove:!0}),ee({gemId:e,mode:"disable",remove:!0}),ee({gemId:e,mode:"request",remove:!0}),ee({gemId:e,mode:"hover",remove:!0}),et({mode:"base"}),tt({display:!1}),In({display:!1}),I=null}r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})};var de=(e=>(e.MINE="gem_mine",e.CARRY="gem_carry",e.TUNNEL="gem_tunnel",e.LIFT="gem_lift",e.FLOOR="gem_floor",e.SHAFT="gem_shaft",e))(de||{});const ga={gem_mine:m.MINE,gem_carry:m.CARRY,gem_tunnel:m.TUNNEL,gem_lift:m.LIFT,gem_floor:m.FLOOR,gem_shaft:m.SHAFT};let ae=0;const yt=4;let _e=0,Jt=!0;const qc=()=>{_({css:"gems frame col hidden enable w-25 h-50 g-8 p-8 t-16",id:"Gems",parent:"UI"}),b({click:()=>Ea({display:!0}),css:"gems-icon enable",id:"GemsIcon",image:A({spriteName:"ui_gems_placeholder"}),parent:"UI",title:"Gems"}),_({absolute:!1,css:"col disable full-h g-4 pt-32",id:"GemsPage",parent:"Gems"}),jc(),Kc()},jc=()=>{b({click:()=>Ea({display:!1}),css:"close",id:"GemsClose",image:A({spriteName:"ui_close"}),parent:"Gems"}),b({click:()=>zc(),css:"all",id:"GemsAll",image:A({spriteName:"ui_gem_placeholder"}),parent:"Gems",title:"Filter All"}),b({click:()=>Hc(),css:"type",id:"GemsType",image:A({spriteName:Object.values(de)[_e]}),parent:"Gems",title:"Filter Type"}),_({absolute:!1,css:"row align g-12",id:"GemsActions",parent:"Gems"}),b({absolute:!1,click:()=>Nn({action:"previous"}),id:"GemsPagePrevious",parent:"GemsActions",text:"<"}),b({absolute:!1,click:()=>Nn({action:"next"}),id:"GemsPageNext",parent:"GemsActions",text:">"}),_({css:"index",id:"GemsPageIndex",parent:"GemsActions",text:"0/0"})},Vc=({gemId:e})=>{const t=L({gemId:e}),n=l({componentId:"Sprite",entityId:e});b({absolute:!1,click:()=>Wc({gemId:e}),css:"row align enable g-32 p-box",id:`Gem${e}`,parent:"GemsPage"}),_({absolute:!1,css:"sprite disable",id:`GemSprite${e}`,image:n._image,parent:`Gem${e}`}),_({absolute:!1,css:"disable",id:`GemId${e}`,parent:`Gem${e}`,text:t._name})},ge=()=>{const e=T();for(const t of e.gems){const n=V({elId:`Gem${t}`}),a=l({componentId:"State",entityId:t});n?a._store?W({elId:`Gem${t}`}):Xc({gemId:t}):a._store||Vc({gemId:t})}Zt()},Xc=({gemId:e})=>{const t=l({componentId:"Sprite",entityId:e}),n=c({elId:`GemSprite${e}`});n.style.backgroundImage=`url("${t._image}")`},Zt=()=>{const e=ya(),t=c({elId:"GemsPageIndex"});t.innerText=`${ae+1}/${e||1}`},Nn=({action:e})=>{const t=c({elId:"GemsPage"}),n=ya();t.children.length&&(e==="previous"?ae=Math.max(0,ae-1):e==="next"&&(ae=Math.min(ae+1,n-1)),Zt(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY}))},ya=()=>{const e=c({elId:"GemsPage"}),t=Array.from(e.children),n=Jt?t:t.filter(i=>{const p=i.id.replace("Gem",""),E=Object.values(de)[_e];return G({gemId:p})===ga[E]});t.forEach(i=>i.style.display="none");const a=ae*yt,o=a+yt;return n.slice(a,o).forEach(i=>i.style.display="flex"),Math.ceil(n.length/yt)},zc=()=>{Jt=!0,ae=0,ge(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},Hc=()=>{const e=Object.values(de).length;Jt=!1,ae=0,_e=(_e+1)%e;const t=ga[Object.values(de)[_e]];ea({gemType:t})||(_e=0);const n=c({elId:"GemsType"});n.style.backgroundImage=`url("${A({spriteName:Object.values(de)[_e]})}")`,ge(),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},Wc=({gemId:e})=>{const t=c({elId:"GemView"});t&&(t.style.display==="flex"&&K({display:!1}),K({display:!0,gemId:e}))},Kc=()=>{const e=c({elId:"GemsPage"});e.addEventListener("mouseenter",t=>{const n=t.target;if(n&&n!==e){const a=n.id.replace("Gem","");F({gemId:a,mode:a===I?"request":"hover"})}},!0),e.addEventListener("mouseleave",t=>{const n=t.target;if(n&&n!==e){const a=n.id.replace("Gem","");if(a===I)return;F({gemId:a,mode:"hover",remove:!0})}},!0)},Ea=({display:e})=>{const t=c({elId:"Gems"}),n=c({elId:"GemsIcon"});t.style.display=e?"flex":"none",n.style.display=e?"none":"flex",e&&(ge(),Zt()),r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},Jc=()=>{b({click:()=>rt({display:!0}),css:"admin-icon enable",id:"AdminIcon",image:A({spriteName:"ui_admin_placeholder"}),parent:"UI",title:"Admin"})},Gn=({display:e})=>{const t=c({elId:"AdminIcon"});t.style.display=e?"flex":"none",r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},Zc=()=>{_({css:"quests frame col hidden enable w-20 g-8 p-8 t-10",id:"Quests",parent:"UI"}),b({click:()=>Ot({display:!0}),css:"quests-icon enable",id:"QuestsIcon",image:A({spriteName:"ui_quests_placeholder"}),parent:"UI",title:"Quests"}),b({click:()=>Ot({display:!1}),css:"close",id:"QuestsClose",image:A({spriteName:"ui_close"}),parent:"Quests"})},eu=({name:e,progress:t,total:n,text:a})=>{const o=J({questName:e});_({absolute:!1,id:`Quest-${e}`,parent:"Quests"}),_({css:"icon",id:`QuestIcon-${e}`,image:A({spriteName:o.image}),parent:`Quest-${e}`}),Ut({absolute:!1,css:"quest btn t-12",id:`Quest-${e}`,parent:`Quest-${e}`,text:`${a}: ${t}/${n}`,value:t/n*100})},tu=({name:e})=>{W({elId:`Quest-${e}`})},Et=()=>{const e=T();for(const t of e.quests){const n=V({elId:`Quest-${t._name}`});if(t._done){n&&tu({name:t._name});continue}const a=J({questName:t._name}),o=a.type==="mine"?a.mine.amount:a.type==="carry"?a.carry:a.type==="gem"?a.gems:a.type==="forge"?a.forge.amount:0;n?nu({name:t._name,progress:t._progress,text:a.text,total:o}):eu({name:t._name,progress:t._progress,text:a.text,total:o})}},nu=({name:e,progress:t,total:n,text:a})=>{We({elId:`Quest-${e}`,text:`${a}: ${t}/${n}`,value:t/n*100})},Ot=({display:e})=>{const t=c({elId:"Quests"}),n=c({elId:"QuestsIcon"});t.style.display=e?"flex":"none",n.style.display=e?"none":"flex",r({data:{audioName:"main_select"},target:"engine",type:d.AUDIO_PLAY})},c=({elId:e})=>document.getElementById(e)??g({message:`Element ${e} does not exist`,where:c.name}),V=({elId:e})=>document.getElementById(e)!==null,Ce=({parent:e,className:t})=>{const a=[...c({elId:e}).querySelectorAll(`.${t}`)];return a.length?a:g({message:`No element with class ${t} found`,where:Ce.name})},au=()=>{Sl(),aa({display:!0})},ou=()=>{aa({display:!1}),sa({display:!0}),bc()},su=()=>{sa({display:!1}),jm()};var u=(e=>(e.ADMIN_CREATE="ADMIN_CREATE",e.ADMIN_TOAST="ADMIN_TOAST",e.ADMIN_UPDATE_GEMS="ADMIN_UPDATE_GEMS",e.ADMIN_UPDATE_LABS="ADMIN_UPDATE_LABS",e.ADMIN_UPDATE_STORAGE="ADMIN_UPDATE_STORAGE",e.ADMIN_UPDATE_WORKSHOP="ADMIN_UPDATE_WORKSHOP",e.BUILD_CREATE="BUILD_CREATE",e.GEM_CREATE="GEM_CREATE",e.GEM_DESTROY="GEM_DESTROY",e.GEM_STOP="GEM_STOP",e.GEM_TOAST="GEM_TOAST",e.GEM_UPDATE="GEM_UPDATE",e.GEM_WORK="GEM_WORK",e.INFO="INFO",e.MODE_BASE="MODE_BASE",e.MODE_PATH="MODE_PATH",e.MODE_REQUEST="MODE_REQUEST",e.POSITION_UPDATE="POSITION_UPDATE",e.QUEST_CREATE="QUEST_CREATE",e.QUEST_END="QUEST_END",e.QUEST_UPDATE="QUEST_UPDATE",e.SCROLL_UPDATE="SCROLL_UPDATE",e.SPRITE_UPDATE="SPRITE_UPDATE",e.TILEMAP_CREATE="TILEMAP_CREATE",e.TILEMAP_DESTROY="TILEMAP_DESTROY",e.TILE_CREATE="TILE_CREATE",e.TILE_DESTROY="TILE_DESTROY",e.TILE_GROUND="TILE_GROUND",e))(u||{});const ht=({data:e,entityId:t,type:n})=>{n===M.GAME_LAUNCH?ou():n===M.GAME_LOADING_ERROR||n===M.GAME_LOADING_OFF||n===M.GAME_LOADING_ON?Nl({display:n===M.GAME_LOADING_ON}):n===M.GAME_RUN?su():n==="ADMIN_CREATE"&&t?Yl():n==="ADMIN_UPDATE_GEMS"?be():n==="ADMIN_UPDATE_LABS"?ca():n==="ADMIN_UPDATE_STORAGE"?(ia(),Lt()):n==="ADMIN_UPDATE_WORKSHOP"?Lt():n==="ADMIN_TOAST"&&e.name&&e.amount?el({amount:e.amount,name:e.name}):n==="BUILD_CREATE"&&e?Km({buildName:e}):n==="GEM_CREATE"&&t?nl({gemId:t}):n==="GEM_UPDATE"&&t?(pa({gemId:t}),be(),ge()):n==="GEM_WORK"&&t?F({gemId:t,mode:"work"}):n==="GEM_DESTROY"&&t?al({gemId:t}):n==="GEM_STOP"&&t?F({gemId:t,mode:"base"}):n==="GEM_TOAST"&&t&&e.name&&e.amount?ol({amount:e.amount,gemId:t,name:e.name}):n===M.GEM_STORE_DEPLOY&&t?(r({entityId:t,target:"render",type:"GEM_CREATE"}),ge()):n===M.GEM_STORE&&t?(ge(),r({entityId:t,target:"render",type:"GEM_DESTROY"})):n===M.GEM_MOVE_REQUEST&&t?r({target:"render",type:"MODE_REQUEST"}):n===M.GEM_CARRY_REQUEST&&t?(r({entityId:t,target:"render",type:"GEM_WORK"}),r({target:"render",type:"MODE_REQUEST"})):n===M.GEM_FLOOR_REQUEST&&t?r({entityId:t,target:"render",type:"GEM_WORK"}):n===M.GEM_LIFT_REQUEST&&t?r({entityId:t,target:"render",type:"GEM_WORK"}):n===M.GEM_MINE_REQUEST&&t?r({entityId:t,target:"render",type:"GEM_WORK"}):n===M.GEM_SHAFT_REQUEST&&t?r({entityId:t,target:"render",type:"GEM_WORK"}):n===M.GEM_TUNNEL_REQUEST&&t?r({entityId:t,target:"render",type:"GEM_WORK"}):n==="INFO"&&e.text?Cc({alert:e.alert,text:e.text,type:e.type}):n==="MODE_BASE"?(et({mode:"base"}),te({mode:"base"}),An({mode:"base"})):n==="MODE_REQUEST"?(et({mode:"disable"}),te({mode:"request"}),An({mode:"request"})):n==="MODE_PATH"?te({mode:"path"}):n==="POSITION_UPDATE"&&t?Hm({elId:t}):n==="QUEST_CREATE"?(Et(),Ot({display:!0})):n==="QUEST_END"||n==="QUEST_UPDATE"?Et():n==="SCROLL_UPDATE"?Vm():n==="SPRITE_UPDATE"&&t?Rn({elId:t}):n==="TILEMAP_CREATE"&&t?Fm({tileMapId:t}):n==="TILEMAP_DESTROY"&&t?Qm({tileMapId:t}):n==="TILE_CREATE"&&t?Bm({tileId:t}):n==="TILE_DESTROY"&&t?te({mode:"destroy",tileId:t}):n==="TILE_GROUND"&&t?te({mode:"ground",tileId:t}):g({message:`Unknown event type: ${n} ${t} ${e}`,where:ht.name})},g=({message:e,where:t,emit:n=!1})=>{const a={message:e,where:t};throw n&&r({data:{alert:!0,text:e,type:"error"},target:"render",type:u.INFO}),a};var M=(e=>(e.GAME_LAUNCH="GAME_LAUNCH",e.GAME_LOADING_ERROR="GAME_LOADING_ERROR",e.GAME_LOADING_OFF="GAME_LOADING_OFF",e.GAME_LOADING_ON="GAME_LOADING_ON",e.GAME_RUN="GAME_RUN",e.GEM_CARRY_REQUEST="GEM_CARRY_REQUEST",e.GEM_FLOOR_REQUEST="GEM_FLOOR_REQUEST",e.GEM_LIFT_REQUEST="GEM_LIFT_REQUEST",e.GEM_MINE_REQUEST="GEM_MINE_REQUEST",e.GEM_MOVE_REQUEST="GEM_MOVE_REQUEST",e.GEM_SHAFT_REQUEST="GEM_SHAFT_REQUEST",e.GEM_STORE="GEM_STORE",e.GEM_STORE_DEPLOY="GEM_STORE_DEPLOY",e.GEM_TUNNEL_REQUEST="GEM_TUNNEL_REQUEST",e))(M||{});const r=({data:e,entityId:t,target:n,type:a})=>{n==="engine"?Ze({data:e,entityId:t,type:a}):n==="render"?ht({data:e,entityId:t,type:a}):n==="all"?(Ze({data:e,entityId:t,type:a}),ht({data:e,entityId:t,type:a})):g({message:`Unknown emit target: ${n}`,where:r.name})},fa=Object.assign({"/src/assets/sprites/build/build_admin.png":Oa,"/src/assets/sprites/build/build_forge_oryon.png":Ca,"/src/assets/sprites/build/build_forge_vulkan.png":Ua,"/src/assets/sprites/gem/gem_carry.png":va,"/src/assets/sprites/gem/gem_carry_error.png":wa,"/src/assets/sprites/gem/gem_carry_mk1.png":ka,"/src/assets/sprites/gem/gem_carry_mk1_error.png":Qa,"/src/assets/sprites/gem/gem_floor.png":qa,"/src/assets/sprites/gem/gem_floor_error.png":Va,"/src/assets/sprites/gem/gem_lift.png":za,"/src/assets/sprites/gem/gem_lift_error.png":Wa,"/src/assets/sprites/gem/gem_mine.png":Ja,"/src/assets/sprites/gem/gem_mine_error.png":eo,"/src/assets/sprites/gem/gem_mine_mk1.png":no,"/src/assets/sprites/gem/gem_mine_mk1_error.png":oo,"/src/assets/sprites/gem/gem_shaft.png":ro,"/src/assets/sprites/gem/gem_shaft_error.png":_o,"/src/assets/sprites/gem/gem_tunnel.png":lo,"/src/assets/sprites/gem/gem_tunnel_error.png":uo,"/src/assets/sprites/gem/gem_tunnel_mk1.png":go,"/src/assets/sprites/gem/gem_tunnel_mk1_error.png":Eo,"/src/assets/sprites/lab/lab_forge_oryon.png":Mo,"/src/assets/sprites/lab/lab_forge_oryon_speed.png":To,"/src/assets/sprites/lab/lab_forge_vulkan.png":So,"/src/assets/sprites/lab/lab_forge_vulkan_speed.png":No,"/src/assets/sprites/lab/lab_gem_carry.png":Lo,"/src/assets/sprites/lab/lab_gem_carry_item_amount.png":Ro,"/src/assets/sprites/lab/lab_gem_carry_item_capacity.png":ho,"/src/assets/sprites/lab/lab_gem_carry_item_speed.png":Yo,"/src/assets/sprites/lab/lab_gem_count.png":Do,"/src/assets/sprites/lab/lab_gem_floor.png":Po,"/src/assets/sprites/lab/lab_gem_lift.png":$o,"/src/assets/sprites/lab/lab_gem_lift_item_capacity.png":Fo,"/src/assets/sprites/lab/lab_gem_max.png":Bo,"/src/assets/sprites/lab/lab_gem_mine_dig_amount.png":jo,"/src/assets/sprites/lab/lab_gem_mine_dig_speed.png":Xo,"/src/assets/sprites/lab/lab_gem_mine_dig_strength.png":Ho,"/src/assets/sprites/lab/lab_gem_mine_item_capacity.png":Ko,"/src/assets/sprites/lab/lab_gem_move_speed.png":Zo,"/src/assets/sprites/lab/lab_gem_shaft.png":ts,"/src/assets/sprites/lab/lab_gem_tunnel.png":as,"/src/assets/sprites/lab/lab_mk1_carry.png":ss,"/src/assets/sprites/lab/lab_mk1_mine.png":is,"/src/assets/sprites/lab/lab_mk1_tunnel.png":ms,"/src/assets/sprites/lab/lab_points.png":cs,"/src/assets/sprites/lab/lab_run.png":ps,"/src/assets/sprites/map/map_map1.png":gs,"/src/assets/sprites/mech/mech_mk1_carry.png":Es,"/src/assets/sprites/mech/mech_mk1_mine.png":Ms,"/src/assets/sprites/mech/mech_mk1_tunnel.png":Ts,"/src/assets/sprites/menu/menu_close.png":Ss,"/src/assets/sprites/menu/menu_destroy.png":Ns,"/src/assets/sprites/menu/menu_gems.png":Ls,"/src/assets/sprites/menu/menu_home.png":Rs,"/src/assets/sprites/menu/menu_labs.png":hs,"/src/assets/sprites/menu/menu_save.png":Ys,"/src/assets/sprites/menu/menu_storage.png":Ds,"/src/assets/sprites/menu/menu_workshop.png":Ps,"/src/assets/sprites/resource/resource_cerulyn.png":$s,"/src/assets/sprites/resource/resource_claryn.png":Fs,"/src/assets/sprites/resource/resource_damsyn.png":Bs,"/src/assets/sprites/resource/resource_firmyn.png":js,"/src/assets/sprites/resource/resource_forge_oryon.png":Xs,"/src/assets/sprites/resource/resource_forge_vulkan.png":Hs,"/src/assets/sprites/resource/resource_geolyn.png":Ks,"/src/assets/sprites/resource/resource_lumyn.png":Zs,"/src/assets/sprites/resource/resource_mk1_carry.png":tr,"/src/assets/sprites/resource/resource_mk1_mine.png":ar,"/src/assets/sprites/resource/resource_mk1_tunnel.png":sr,"/src/assets/sprites/resource/resource_stone.png":ir,"/src/assets/sprites/resource/resource_viridyn.png":mr,"/src/assets/sprites/tile/tile_cerulyn1.png":cr,"/src/assets/sprites/tile/tile_cerulyn2.png":pr,"/src/assets/sprites/tile/tile_claryn2.png":gr,"/src/assets/sprites/tile/tile_damsyn2.png":Er,"/src/assets/sprites/tile/tile_floor.png":Mr,"/src/assets/sprites/tile/tile_geolyn1.png":Tr,"/src/assets/sprites/tile/tile_geolyn2.png":Sr,"/src/assets/sprites/tile/tile_ground0_destroy.png":Nr,"/src/assets/sprites/tile/tile_ground1.png":Lr,"/src/assets/sprites/tile/tile_ground1_destroy.png":Rr,"/src/assets/sprites/tile/tile_ground2.png":hr,"/src/assets/sprites/tile/tile_ground2_destroy.png":Yr,"/src/assets/sprites/tile/tile_lock.png":Dr,"/src/assets/sprites/ui/ui_admin_placeholder.png":Pr,"/src/assets/sprites/ui/ui_close.png":$r,"/src/assets/sprites/ui/ui_gem_placeholder.png":Fr,"/src/assets/sprites/ui/ui_gems_placeholder.png":Br,"/src/assets/sprites/ui/ui_quests_placeholder.png":jr,"/src/assets/sprites/ui/ui_scroll_bottom.png":Xr,"/src/assets/sprites/ui/ui_scroll_left.png":Hr,"/src/assets/sprites/ui/ui_scroll_right.png":Kr,"/src/assets/sprites/ui/ui_scroll_top.png":Zr}),Ma=Object.assign({"/src/assets/audio/bgm/bgm_game1.mp3":ti,"/src/assets/audio/bgm/bgm_game2.mp3":ai,"/src/assets/audio/bgm/bgm_game3.mp3":si,"/src/assets/audio/bgm/bgm_game4.mp3":ii,"/src/assets/audio/bgm/bgm_game5.mp3":mi,"/src/assets/audio/bgm/bgm_game6.mp3":ci,"/src/assets/audio/bgm/bgm_game7.mp3":pi,"/src/assets/audio/bgm/bgm_game8.mp3":gi,"/src/assets/audio/bgm/bgm_game9.mp3":Ei,"/src/assets/audio/bgm/bgm_menu1.mp3":Mi,"/src/assets/audio/main/main_action.mp3":Ti,"/src/assets/audio/main/main_confirm.mp3":Si,"/src/assets/audio/main/main_error.mp3":Ni,"/src/assets/audio/main/main_select.mp3":Li,"/src/assets/audio/main/main_start.mp3":Ri,"/src/assets/audio/main/main_stop.mp3":hi,"/src/assets/audio/main/main_success.mp3":Yi,"/src/assets/audio/main/main_unlock.mp3":Di,"/src/assets/audio/main/main_warning.mp3":Pi}),ru=Object.assign({}),Aa=new Map,Ta=new Map,iu=()=>{let e=!1,t=null;return{getAudioUrl:i=>{const p=Ta.get(i);return p?p.url:(g({message:`Audio ${i} not found in cache`,where:"getAudioUrl"}),"")},getSpriteUrl:i=>{const p=Aa.get(i);return p?p.url:(g({message:`Sprite ${i} not found in cache`,where:"getSpriteUrl"}),"")},isLoadingComplete:()=>!e&&!t,startLoading:()=>{if(!(e||t))return e=!0,r({target:"all",type:M.GAME_LOADING_ON}),t=ba().then(i=>(e=!1,t=null,i?(_u(),mu(),r({target:"all",type:M.GAME_LOADING_OFF})):r({target:"all",type:M.GAME_LOADING_ERROR}),i)),t}}},ba=async()=>{const[e,t,n]=await Promise.all([Sa(),Ia(),Na()]);return e&&t&&n?!0:(g({message:"Some assets failed to load",where:ba.name}),!1)},Sa=async()=>{const e=Object.entries(fa).map(([n,a])=>{const o=new Image;return new Promise(s=>{o.onload=()=>s(!0),o.onerror=()=>{g({message:`Failed to load sprite: ${n}`,where:Sa.name}),s(!1)},o.src=a.default})});return(await Promise.all(e)).every(n=>n)},_u=()=>{Object.entries(fa).forEach(([e,t])=>{var o;const n=e.replace("/src/assets/sprites/",""),a=((o=n.split("/").pop())==null?void 0:o.split(".")[0])||"";Aa.set(a,{path:n,url:t.default})})},Ia=async()=>{const e=Object.entries(Ma).map(([n,a])=>{const o=new Audio;return new Promise(s=>{o.oncanplaythrough=()=>s(!0),o.onerror=()=>{g({message:`Failed to load audio: ${n}`,where:Ia.name}),s(!1)},o.src=a.default,o.load()})});return(await Promise.all(e)).every(n=>n)},mu=()=>{Object.entries(Ma).forEach(([e,t])=>{var o;const n=e.replace("/src/assets/audio/",""),a=((o=n.split("/").pop())==null?void 0:o.split(".")[0])||"";Ta.set(a,{path:n,url:t.default})})},Na=async()=>{const e=Object.entries(ru).map(([n,a])=>{var i;const o=((i=n.split("/").pop())==null?void 0:i.split(".")[0])||"gameFont",s=a.default;return new Promise(p=>{new FontFace(o,`url(${s})`).load().then(y=>{document.fonts.add(y),p(!0)}).catch(y=>{y({message:`Failed to load font: ${n}`,where:Na.name}),p(!1)})})});return(await Promise.all(e)).every(n=>n)},O={deltaTime:1/60,forgeOryonTime:0,forgeVulkanTime:0,labTime:0,requests:[]},lu=()=>{setInterval(()=>pu(),O.deltaTime*1e3)},cu=({id:e})=>O.requests.push({id:e,progress:0}),en=({id:e})=>O.requests.find(t=>t.id===e),uu=({id:e})=>O.requests=O.requests.filter(t=>t.id!==e),Ga=({id:e})=>{const t=en({id:e});t?t.progress+=O.deltaTime:g({message:`Cycle ${e} not found`,where:Ga.name})},La=({id:e})=>{const t=en({id:e});t?t.progress=0:g({message:`Cycle ${e} not found`,where:La.name})},pu=()=>{if(Y({key:"gamePlay"})){const e=T();for(const t of O.requests)e.requests.includes(t.id)||uu({id:t.id});for(const t of e.requests){const n=en({id:t});if(!n)cu({id:t});else if(Ga({id:t}),xn({gemId:t})){const a=l({componentId:"State",entityId:t});if(!a._request||a._action==="idle")continue;const o=Zn({gemId:t});n.progress*o>=1&&(La({id:t}),a._action==="move"?Hn({gemId:t}):a._action==="work"&&xm({gemId:t}))}}if(O.labTime+=O.deltaTime,O.labTime>=1){O.labTime=0;for(const t of e.labs)t._run&&Ym({name:t._name})}e.builds.forges.vulkan&&(O.forgeVulkanTime+=O.deltaTime,O.forgeVulkanTime*e.stats._forgeVulkanSpeed>=1&&(O.forgeVulkanTime=0,Mt({buildName:D.BUILD_FORGE_VULKAN}))),e.builds.forges.oryon&&(O.forgeOryonTime+=O.deltaTime,O.forgeOryonTime*e.stats._forgeOryonSpeed>=1&&(O.forgeOryonTime=0,Mt({buildName:D.BUILD_FORGE_ORYON}))),Y({key:"gamePause"})||r({target:"render",type:u.SCROLL_UPDATE})}};let Ye;const du=()=>{Ye=iu(),Ye.startLoading()},gu=()=>{Ye.isLoadingComplete()||g({message:"Loading manager is not complete",where:xa.name}),U({key:"gameLaunch",value:!0}),Qt({}),lu(),Hi()},xa=({saveData:e})=>{r({target:"all",type:M.GAME_LOADING_ON}),e?ml({saveData:e}):_l(),r({target:"engine",type:d.ENGINE_PLAY})};au();du();
